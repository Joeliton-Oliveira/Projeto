function CarteirinhaEstudantilController($log,$scope,$window,$http,$rootScope,$state,$timeout,$translate,$ionicHistory,$ionicModal,SessionData,CarteirinhaEstudantilService,$location){var vm=this;let fotoString;vm.existeImagemDocCustomBase64=!1,vm.imagemDocCustomBase64,CarteirinhaEstudantilService.obterDataVencimentoPeriodo().then(result=>{vm.dataVencimento=result.data.dataVencimento}),vm.situacaoAluno=SessionData.aluno.list[SessionData.aluno.selecionado].situacaoAluno,fetch(SessionData.aluno.list[SessionData.aluno.selecionado].foto).then(r=>r.blob()).then(foto=>{var reader=new FileReader;reader.readAsDataURL(foto),reader.onloadend=function(){var base64foto=reader.result;fotoString=base64foto.split(",")[1]}}),CarteirinhaEstudantilService.obterConfigAlunoResp().then(result=>{vm.observacao=result.data.observacaoCarteirinha});let paramsImagemDoc={codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,tipoDocumento:"CarteirinhaEstudantil"};CarteirinhaEstudantilService.obtemImagemDoc(paramsImagemDoc).then(result=>{vm.imagemDocCustomBase64="data:image/png;base64,"+btoa(result.imagemBase64.match(/\w{2}/g).map(function(a){return String.fromCharCode(parseInt(a,16))}).join("")),vm.existeImagemDocCustomBase64=!0}),vm.efetuarDownloadDados=(()=>{const dados={nomeCompleto:SessionData.aluno.list[SessionData.aluno.selecionado].nomeAluno,codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,curso:SessionData.aluno.list[SessionData.aluno.selecionado].codCurso+"-"+SessionData.aluno.list[SessionData.aluno.selecionado].nomeCurso,serie:SessionData.aluno.list[SessionData.aluno.selecionado].serie,periodo:SessionData.aluno.list[SessionData.aluno.selecionado].descrSemestre,turma:SessionData.aluno.list[SessionData.aluno.selecionado].turma,status:SessionData.aluno.list[SessionData.aluno.selecionado].situacaoAluno,vencimento:vm.dataVencimento,fotoAluno:vm.existeImagemDocCustomBase64?vm.imagemDocCustomBase64:fotoString,observacao:vm.observacao};console.log("DATOS",dados),CarteirinhaEstudantilService.efetuarDownloadRelatorioAluno(dados)})}function FrequenciaController($log,$http,$state,$timeout,$translate,Notification,SessionData){$log.debug("[FrequenciaController]\tvm=",this)}function TrabalhosController($log,$http,$scope,$rootScope,$state,$timeout,$translate,Notification,SessionData){switch($rootScope.view="submissao",$state.current.name){case"home.trabalhos":$state.go("home.trabalhos.submissao"),$rootScope.view="submissao";break;case"home.trabalhos.historico":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="historico"})},500)}}function TrabalhosConclusaoController($log,$http,$scope,$rootScope,$state,$timeout,$translate,Notification,SessionData,AonlineUtils,PosTCCService,Storage){$rootScope.view="dados",$('[data-toggle="tooltip"]').tooltip();var aluno,vm=this;function sucessoObterUrlTcc(result){$rootScope.possuiUrl=result.urltcc,Storage.set("possuiUrl",JSON.stringify($rootScope.possuiUrl)),function(state){switch(state.current.name){case"home.pos_tcc":$state.go("home.pos_tcc.dados"),$rootScope.view="dados";break;case"home.pos_tcc.patrocinadores":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="patrocinadores"})},100);break;case"home.pos_tcc.envio-de-arquivos":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="envio-de-arquivos"})},100)}}($state),AonlineUtils.showLoading(!1)}function callbackErro(result){$log.debug(result),AonlineUtils.showLoading(!1)}vm.aluno=null,$rootScope.possuiUrl=null,vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],aluno=vm.aluno,void PosTCCService.urlTCC(aluno).then(sucessoObterUrlTcc,callbackErro))}function CobrancaController($log,$http,$state,$timeout,$translate,Notification,SessionData){$log.debug("[CobrancaController]\tvm=",this)}function ContratoController($log,$http,$state,$timeout,$translate,Notification,SessionData){$log.debug("[ContratoController]\tvm=",this)}function MatriculaController($log,SessionData,MatriculaService,$ionicLoading,$state,$q,$scope,$ionicHistory,$ionicNavBarDelegate,$translate){let vm=this,aluno=SessionData.aluno.list[0];vm.steps=[],vm.pageDescription=$translate.instant("Home.view.Matricula"),vm.scrolling=!0,vm.fixButton=!1,$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),$ionicNavBarDelegate.title($translate.instant("Home.view.Matricula")),$ionicHistory.nextViewOptions({disableBack:!0});let configMatriculaProm=MatriculaService.obterConfigMatricula(aluno),termoMatriculaProm=MatriculaService.termoMatricula();$q.all([configMatriculaProm,termoMatriculaProm]).then(function(result){vm.configMatricula=result[0],vm.termoMatricula=result[1],"N"==vm.termoMatricula.continuar&&vm.steps.push({id:0,view:"termo",state:"home.matricula.termo",icon:"ion-thumbsup",description:$translate.instant("Aluno.Matricula.Termo")}),"S"==vm.configMatricula.config.disciplinas_habilit&&vm.steps.push({id:vm.steps.length,view:"disciplinas",state:"home.matricula.disciplinas",icon:"ion-calendar",description:$translate.instant("Aluno.Matricula.Disciplinas")}),"S"==vm.configMatricula.config.respfinan_habilit&&vm.steps.push({id:vm.steps.length,view:"respfinan",state:"home.matricula.respfinan",icon:"ion-person-stalker",description:$translate.instant("Aluno.Matricula.Responsavel.Financeiro")}),"S"==vm.configMatricula.config.cadastro_aluno_habilit&&vm.steps.push({id:vm.steps.length,view:"cadastro",state:"home.matricula.cadastro",icon:"ion-person",description:$translate.instant("DadosPessoais")}),"S"==vm.configMatricula.config.autorizacao_habilit&&vm.steps.push({id:vm.steps.length,view:"autorizacao",state:"home.matricula.autorizacao",icon:"ion-android-checkbox",description:$translate.instant("Aluno.Matricula.Autorizacao")}),"S"==vm.configMatricula.config.contrato_habilit&&vm.steps.push({id:vm.steps.length,view:"contrato",state:"home.matricula.contrato",icon:"ion-document",description:$translate.instant("Aluno.Matricula.Contrato")}),"S"==vm.configMatricula.config.requerim_habilit&&vm.steps.push({id:vm.steps.length,view:"requerimento",state:"home.matricula.requerimento",icon:"ion-social-usd",description:$translate.instant("Aluno.Matricula.Requerimento")}),vm.nextButton={},vm.cancelButton={},vm.finalButton={},vm.additionalButton={},$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){"/matricula"==toState.url&&$state.go(vm.steps[0].state)}),$state.go(vm.steps[0].state),$ionicLoading.hide()},function(){$state.go("home.avisos",{},{reload:!1})}),$log.debug("[FrequenciaController]\tvm=",vm)}function MatriculaTermoController($scope){this.matriculaController=$scope.vm.parentScope.vm}function Matricula2DisciplinasController($log,SessionData,MatriculaService,$ionicLoading,$state,$q,$scope,$ionicHistory,$ionicNavBarDelegate,$translate){}angular.module("custom.controllers",["menu","metadata.service","aol.service","ui.calendar","ui.utils.masks","alunoCard","avisos","documentos","avisoDetail","ocorrencias","ocorrenciaDetail","boletim","horarios","agenda","servico","boletoDeckModule","boletoDetailModule","minhaTurmaListModule","minhaTurmaModule","frequenciaListModule","tarefa","cobrancaListModule","contratoListModule","termoListModule","wizard","info","card","pgtocobrancas","pgtocartaocobrancas","matriculaTermoModule","acordoCadastro","acordoConsulta","historicoCabecalhoModule","historicoListModule","ngFileUpload","ngFileSaver"]),angular.module("custom.controllers").controller("HomeController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","MenuTree","SessionData","Aluno.AvaliacaoInstitucional","serviceAlunos","$location","Storage","CartaoService","UserService","UtilService",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,menuTree,SessionData,Aluno_AvaliacaoInstitucional,serviceAlunos,$location,Storage,CartaoService,UserService,UtilService){function handleAlunosPicture(list){list.map(aluno=>{aluno.originalPic=angular.copy(aluno.foto),aluno.foto=function(aluno){var imgURL="";if(aluno&&void 0!==aluno.foto&&null!==aluno.foto&&"null"!==aluno.foto&&aluno.foto.length>0)try{imgURL=function(string){if(!string)return!1;return null!==string.match(/(http(s)?:\/\/)/g)}(aluno.foto)?aluno.foto:URL.createObjectURL(function(strHexadecimal){var hexString=atob(strHexadecimal),aBuffer=new ArrayBuffer(hexString.length/2),byteBuffer=new Uint8Array(aBuffer);for(let i=0;i<hexString.length;i+=2)byteBuffer[i/2]=parseInt(hexString.slice(i,i+2),16);return new Blob([byteBuffer],{type:"image/png"})}(aluno.foto))}catch(err){imgURL=""}if(""==imgURL)switch(aluno.sexo){case"M":imgURL="img/avatar_M.png";break;case"F":imgURL="img/avatar_F.png";break;default:imgURL="img/nophoto.png"}return imgURL}(aluno)})}var aluno,alunoSelecionado,alunosResp,agenda;$scope.getCarrinhoItemsQuantity=function(){if(SessionData.carrinho.length>0)return SessionData.carrinho.length},$scope.navbar="S"===Storage.get("ocultarNavbar"),$scope.sidebar="S"===Storage.get("ocultarSidebar"),null==Storage.get("enablePix")&&CartaoService.obtemInfoPix().then(result=>{result.habilitaAluno&&"S"==result.habilitaAluno.toUpperCase()?Storage.set("enablePix",!0):Storage.set("enablePix",!1)}).catch(error=>{$log.debug(error)}),$scope.showCart=function(){return"/home/servico-solicitacao"===$location.url()},void 0!==$rootScope.isLeftSideMenuOpened&&""!==$rootScope.isLeftSideMenuOpened||($rootScope.isLeftSideMenuOpened=!0),$scope.toggleButtonLeftSideMenu=function(){$rootScope.isLeftSideMenuOpened?(angular.element("#toggle-button-left-side-bar").css("left","50px"),angular.element("#ion-side-menu-content").css("transform","translate3d(50px, 0px, 0px)"),angular.element("#ion-side-menu-content").css("width",$(window).width()-50+"px"),$rootScope.sideBarMenuItemClass="side-bar-menu-item-closed",$rootScope.sideBarMenuIconClass="side-bar-menu-icon-closed"):(angular.element("#toggle-button-left-side-bar").css("left","275px"),angular.element("#ion-side-menu-content").css("transform","translate3d(275px, 0px, 0px)"),angular.element("#ion-side-menu-content").css("width",$(window).width()-275+"px"),$rootScope.sideBarMenuItemClass="side-bar-menu-item-opened",$rootScope.sideBarMenuIconClass="side-bar-menu-icon-opened"),$rootScope.isLeftSideMenuOpened=!$scope.isLeftSideMenuOpened},$rootScope.getWindowWidth=function(){return $(window).width()},$scope.id="HomeController",handleAlunosPicture(SessionData.aluno.list),handleAlunosPicture(SessionData.alunosResponsavel.list),$rootScope.SessionData=SessionData,$scope.isDropDownOpen=!1,$scope.getAlunoPicture=function(aluno){if(aluno.foto)return aluno.foto;switch(aluno.sexo){case"F":return"img/avatar_F.png";case"M":return"img/avatar_M.png"}return"img/avatar_M.png"},$scope.toggleUserMenu=function(){$scope.isDropDownOpen=!$scope.isDropDownOpen},$scope.selecionarAluno=function(aluno){!0?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}):$ionicLoading.hide(),$scope.toggleUserMenu(),serviceAlunos.selecionarAluno(aluno)},$scope.showCalendarButton=function(){var show=!1;return"home.agenda"==$state.current.name&&(show=!0),show},SessionData.isEmpty("aluno")||(alunoSelecionado=(aluno=SessionData.aluno).list[aluno.selecionado]),SessionData.isEmpty("alunosResponsavel")||(alunosResp=SessionData.alunosResponsavel.list),SessionData.isEmpty("agenda")||(agenda=SessionData.agenda),$scope.agenda=agenda,$scope.aluno=aluno,$scope.alunoSelecionado=alunoSelecionado,$scope.alunosResp=alunosResp,null==alunoSelecionado||angular.equals(alunoSelecionado,{})||serviceAlunos.loadFotoAluno(alunoSelecionado),$scope.alunosResp&&($scope.alterarAluno=!($scope.alunosResp.length>1)),aluno&&angular.element("#idSubHeader").html(aluno.list[0].user.name),$scope.ativaAltoContraste=function(){$rootScope.isAtivoAltoContraste?($rootScope.isAtivoAltoContraste=!1,$rootScope.$broadcast("altoContraste")):($rootScope.isAtivoAltoContraste=!0,$rootScope.$broadcast("altoContraste"))}}]),angular.module("custom.controllers").controller("AlunoAvisosController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","AvisoService","$log","DownloadArquivo",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,AvisoService,$log,DownloadArquivo){var alunoAvisosCtrl=this;alunoAvisosCtrl.id="AlunoAvisosController";const alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado];function loading(value){alunoAvisosCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}function contarAvisosNaoLidos(){let contador=0;AvisoService.listarAvisos().then(function(result){for(let i=0;i<result.length;i++)0==result[i].lido&&contador++;$scope.numeroAvisosNaoLidos=contador})}function listarAvisos(){AvisoService.listarAvisos().then(function(result){for(let i=0;i<result.length;i++)result[i].dataFormatada=moment(result[i].data).format("DD/MM/YYYY");if(result&&result.length){$scope.listaAvisos=result;for(var i=0;i<$scope.listaAvisos.length;i++){try{$scope.listaAvisos[i].data=$scope.listaAvisos[i].data.substring(0,10),$scope.listaAvisos[i].data.replace("-","/")}catch(err){}$scope.listaAvisos[i].descricao=$sce.trustAsHtml($scope.listaAvisos[i].descricao),$scope.listaAvisos[i].imagem=getImage($scope.listaAvisos[i].imgAviso),vm.listaAuxiliar=angular.copy($scope.listaAvisos)}$rootScope.menuLeftLoading||loading(!1),$rootScope.menuLeftLoading=!1}loading(!1)}).catch(function(err){Notification.error(err),alunoAvisosCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}function getImage(base64){return null!=base64?(new Image).src="data:image/png;base64,"+base64:null}$scope.apareceListaNaoLidos=!1,$scope.apareceListaGeral=!0,$scope.numeroAvisosNaoLidos=contarAvisosNaoLidos(),vm=this,loading(!0),alunoAvisosCtrl.loading=!0,$scope.getWindowWidth=function(){return window.innerWidth},listarAvisos(),$scope.revelar=function(){0==$scope.apareceListaNaoLidos?$scope.apareceListaNaoLidos=!0:$scope.apareceListaNaoLidos=!1,0==$scope.apareceListaGeral?$scope.apareceListaGeral=!0:$scope.apareceListaGeral=!1,contarAvisosNaoLidos(),listarAvisos()},AvisoService.listarUltAtividades().then(function(result){$scope.listaUltAtividades=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),$ionicModal.fromTemplateUrl("./views/logged/modal.aluno.aviso.detalhe.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.downloadAnexo=function(codAviso,codAnexo,nomeAnexo){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1});let params={};params.url=Configs.getApiServer()+"/pessoas/aluno/"+alunoSelecionado.codAluno+"/cod_aviso/"+codAviso+"/cod_anexo/"+codAnexo+"/baixar_anexo_aviso",params.method="GET",DownloadArquivo.downloadArquivo(params)},$scope.detalharAviso=function(aviso){$scope.avisoSelecionado=aviso,aviso.lido||function(aviso){const params={aviso:aviso,pessoa:SessionData.user.id};AvisoService.enviarLeituraAviso(params).then(retorno=>{listarAvisos()}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})}(aviso.codAviso),AvisoService.obterDadosAnexo(aviso.codAviso).then(function(result){$scope.listaDeAnexos=result,$scope.modal.show()}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})},vm.verificarDatas=function(){vm.dataInicial=""==vm.dataInicial?null:vm.dataInicial,vm.dataFinal=""==vm.dataFinal?null:vm.dataFinal},$scope.pesquisar=function(){if($scope.listaAvisos=angular.copy(vm.listaAuxiliar),(vm.textoPesquisa||vm.dataInicial||vm.tipoAviso)&&(vm.textoPesquisa&&($scope.listaAvisos=$scope.listaAvisos.filter(element=>element.tituloClean.toUpperCase().includes(vm.textoPesquisa.toUpperCase()))),vm.dataInicial&&vm.dataFinal&&($scope.listaAvisos=$scope.listaAvisos.filter(element=>moment(element.data).format("DD-MM-YYYY")>=moment(vm.dataInicial).format("DD-MM-YYYY")&&moment(element.data).format("DD-MM-YYYY")<=moment(vm.dataFinal).format("DD-MM-YYYY"))),vm.tipoAviso)){let tipo="lido"==vm.tipoAviso;$scope.listaAvisos=$scope.listaAvisos.filter(element=>element.lido==tipo)}}}]),angular.module("custom.controllers").controller("Aluno403Controller",["$ionicLoading",function($ionicLoading){$ionicLoading.hide()}]),angular.module("custom.controllers").controller("CarteirinhaEstudantilController",["$log","$scope","$window","$http","$rootScope","$state","$timeout","$translate","$ionicHistory","$ionicModal","SessionData","CarteirinhaEstudantilService","$location",CarteirinhaEstudantilController]),angular.module("custom.controllers").controller("AlunoAceiteContratoController",["$scope","$rootScope","$state","Notification","$ionicLoading","MatriculaService","SessionData","FileSaver","$ionicPopup","$translate","Storage",function($scope,$rootScope,$state,Notification,$ionicLoading,MatriculaService,SessionData,FileSaver,$ionicPopup,$translate,Storage){let alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado],codAluno=alunoSelecionado.codAluno;$scope.contrato={},$scope.contratoAceito={};var vm=this;let lgpd=Storage.get("_contratoLgpd")?JSON.parse(Storage.get("_contratoLgpd")):null;function loading(flag){flag?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}):$ionicLoading.hide()}function init(){if(!Storage.get("exibirContrato")||vm.contratoLgpd&&"S"==vm.contratoLgpd.necessita_aceite_lgpd.toUpperCase())if(vm.contratoLgpd&&"S"==vm.contratoLgpd.necessita_aceite_lgpd.toUpperCase()){loading(!0);let params={id_termo:vm.contratoLgpd.id_termo_lgpd,sistema:"AOnlineResp"};MatriculaService.obterTermoLgpd(params).then(response=>{vm.contratoLgpd.html=function(base64){const text=atob(base64);if((text.indexOf("PT-BR")||text.indexOf("UTF-8")||text.indexOf("utf-8")||text.indexOf("utf8")||text.indexOf("pt-br"))>-1)return text;{const length=text.length,bytes=new Uint8Array(length);for(let i=0;i<length;i++)bytes[i]=text.charCodeAt(i);return(new TextDecoder).decode(bytes)}}(response?response.html:""),loading(!1)},error=>{throwException(error)})}else $state.go("home.avisos");else loading(!0),MatriculaService.gerarContratoAlunoLogin(codAluno).then(function(result){result.erroContrato?($scope.mensagemErro=result.mensagemErro,Notification.error($translate.instant("Aluno.Aceite.Contrato.Login.Problema.Geracao")+result.mensagemErro)):$scope.contrato=result,MatriculaService.verificaExibeContratoLogin(codAluno).then(function(result){Storage.set("exibirContrato",result.valor),loading(!1)},function(result){throwException(result)})},function(result){void 0!==result&&throwException(result)})}function base64ToArrayBuffer(data){for(var binaryString=window.atob(data),binaryLen=binaryString.length,bytes=new Uint8Array(binaryLen),i=0;i<binaryLen;i++){var ascii=binaryString.charCodeAt(i);bytes[i]=ascii}return bytes}function throwException(result){let errorMsg;errorMsg=result&&result.mensagemDetalhada?result.mensagemDetalhada:$translate.instant("Aluno.Aceite.Contrato.Login.Servidor.Indisponivel"),loading(!1),Notification.error(errorMsg)}lgpd&&(vm.contratoLgpd=lgpd),init(),$scope.acceptContract=function(){loading(!0),MatriculaService.aceitarContratoAlunoLogin(codAluno,$scope.contrato.imagem).then(function(result){Notification.success($translate.instant("Aluno.Aceite.Contrato.Login.Confirmacao")),$scope.contratoAceito.id=result.valor,init(),loading(!1)},function(result){throwException(result)})},$scope.printContract=function(){if(loading(!0),$scope.contratoAceito.id)MatriculaService.obterContratoImagemAluno($scope.contratoAceito.id).then(function(result){let date=new Date,fileName=$translate.instant("Aluno.Matricula.Contrato")+" - "+$scope.contratoAceito.id+" - "+date.getTime()+".pdf",arquivo=new Blob([base64ToArrayBuffer(result.contratoPDF)],{type:"application/pdf"});FileSaver.saveAs(arquivo,fileName),loading(!1)},function(result){throwException(result)});else if($scope.contrato&&$scope.contrato.contratoEhBinario){let fileType="application/octet-stream",fileExtension=$scope.contrato.extensaoContrato?$scope.contrato.extensaoContrato:"";switch(fileExtension=fileExtension.startsWith(".")?fileExtension:"."+fileExtension){case".pdf":fileType="application/pdf";break;case".doc":fileType="application/msword";break;case".docx":fileType="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;default:fileType="application/octet-stream"}let date=new Date,fileName=$translate.instant("Aluno.Matricula.Contrato")+" - "+date.getTime()+fileExtension,arquivo=new Blob([base64ToArrayBuffer($scope.contrato.imagemBin)],{type:fileType});FileSaver.saveAs(arquivo,fileName),loading(!1)}else{let myblob=new Blob([$scope.contrato.imagem],{type:"text/html;charset=UTF-8",encoding:"UTF-8"}),date=new Date,fileName=$translate.instant("Aluno.Matricula.Contrato")+" - "+date.getTime()+".html";FileSaver.saveAs(myblob,fileName)}loading(!1)},$scope.refuseContract=function(){$ionicPopup.confirm({template:$translate.instant("Aluno.Aceite.Contrato.Login.NaoAceito.Mensagem"),cancelText:$translate.instant("Aluno.Acordo.Wizard.Cancelar")}).then(function(res){res&&$rootScope.logout()})},vm.aceitarTermoLgpd=function(){vm.aceitarLgpd?(loading(!0),SessionData.aluno.list.forEach(aluno=>{let params={idTermoLGPD:vm.contratoLgpd.id_termo_lgpd,pessoa:aluno.usuarioLogado.id,aluno:aluno.codAluno,resp:null,html:vm.contratoLgpd.html,sistema:"AOnlineResp"};MatriculaService.incluirTermoLGPD(params).then(response=>{"OK"==response.conteudo&&(Storage.set("_contratoLgpd",null),Notification.success("Termo aceite com sucesso."),Storage.get("exibirContrato")&&null==Storage.get("_contratoLgpd")?$state.go("home.aceiteContrato"):$state.go("home.avisos")),loading(!1)},error=>{throwException(error)})})):Notification.warning("Necessário aceitar o termo antes.")},vm.recusarTermoLgpd=function(){loading(!0);let params={idTermoLGPD:vm.contratoLgpd.id_termo_lgpd,pessoa:alunoSelecionado.usuarioLogado.id,aluno:alunoSelecionado.codAluno,resp:null,html:vm.contratoLgpd.html,sistema:"AOnlineResp"};MatriculaService.recusarTermoLGPD(params).then(response=>{if("OK"==response.conteudo){$ionicPopup.confirm({template:$translate.instant("Aluno.Aceite.Contrato.Login.NaoAceito.Mensagem"),cancelText:$translate.instant("Aluno.Acordo.Wizard.Cancelar")}).then(function(res){res&&$rootScope.logout()})}loading(!1)},error=>{throwException(error)})}}]),angular.module("custom.controllers").controller("AlunoDocumentosController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","DocumentoService","DownloadArquivo","AlunoCadastroService","Upload",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,DocumentoService,DownloadArquivo,AlunoCadastroService,Upload){$scope.SessionData=SessionData;var documentosCtrl=this;function loading(value){documentosCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}function atualizaDocs(){AlunoCadastroService.getListaDocumentosPendentesEEntregues(SessionData.aluno.list[0].codAluno).then(function(result){$scope.alunoSituacaoDocumentos=result,$scope.codDocumento=void 0,$scope.nomeAnexo=null,loading(!1)}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}documentosCtrl.id="AlunoDocumentosController",AlunoCadastroService.getListaDocumentosPendentesEEntregues(SessionData.aluno.list[0].codAluno).then(function(result){$scope.alunoSituacaoDocumentos=result,loading(!1)}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.uploadDocumento=function(file){$scope.codDocumento=void 0,null!=file&&($scope.nomeAnexo=file.name),Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},AlunoCadastroService.uploadDocumento(data).then(function(result){$scope.codDocumento=result.codArquivo,$("#btEnviarArquivo").prop("disabled",!1)}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0}),loading(!1)},$scope.incluirDocumento=function(){null!=$scope.codDocumento?(data={codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codArquivo:$scope.codDocumento,idDocumentoPessoa:$scope.documentoSelecionado.id_documento_pessoa,idDocumentoProcesso:$scope.documentoSelecionado.id},AlunoCadastroService.incluirDocumento(data).then(function(result){Notification.success("Upload de arquivo realizado com sucesso."),$scope.codDocumento=result,atualizaDocs()}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),loading(!0),$scope.modalEnviarArquivo.hide()):Notification.error("Para concluir a ação, é necessário carregar o documento.")},$scope.enviarDocumento=function(file,row){$scope.documentoSelecionado=row,$scope.codDocumento=void 0,$scope.nomeAnexo=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},AlunoCadastroService.uploadDocumento(data).then(function(result){$scope.codDocumento=result.codArquivo,row.nomeArquivo=result.nomeArquivo,loading(!0),null!=$scope.codDocumento?(data={codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codArquivo:$scope.codDocumento,idDocumentoPessoa:$scope.documentoSelecionado.id_documento_pessoa,idDocumentoProcesso:$scope.documentoSelecionado.id},AlunoCadastroService.incluirDocumento(data).then(function(result){Notification.success("Upload de arquivo realizado com sucesso."),$scope.codDocumento=result,loading(!1),atualizaDocs()}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})):Notification.error("Para concluir a ação, é necessário carregar o documento.")}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0}),loading(!0)},$scope.baixarDocumento=function(id_documento_pessoa){let params={},codPessoa=SessionData.aluno.list[SessionData.aluno.selecionado].id;params.url=Configs.getApiServer()+"/pessoas/codPessoa/"+codPessoa+"/id_documento_pessoa/"+id_documento_pessoa+"/download_documento_pessoa",params.method="GET",DownloadArquivo.downloadArquivo(params)},$scope.abrirPopUpEnvioArquivo=function(row){$scope.documentoSelecionado=row,$scope.modalEnviarArquivo.show()},$ionicModal.fromTemplateUrl("modal-enviarArquivo",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalEnviarArquivo=modal})}]),angular.module("custom.controllers").controller("AjusteBoletoController",["$scope","AjusteBoletoService","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","DownloadArquivo","Upload",function($scope,AjusteBoletoService,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,DownloadArquivo,Upload){$scope.SessionData=SessionData,$scope.desabilitarConfirm=!0,$scope.desabilitarDownload=!0,carregarListaBoletos();var ajusteBoletoCtrl=this;function loading(value){ajusteBoletoCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}function carregarListaBoletos(){AjusteBoletoService.getListaBoletosDoAluno().then(function(response){$scope.listaBoletosAluno=response,loading(!1)},function(response){console.log(response)})}ajusteBoletoCtrl.id="AjusteBoletoController",loading(!0),$scope.verificarProrrogacao=function(codBoleto){codBoleto?(loading(!0),$scope.codBoleto=codBoleto,AjusteBoletoService.getVerificaMensagemProrrogaBoleto(codBoleto).then(function(response){loading(!1),$scope.arrastoBoleto=response,$scope.arrastoBoleto.exibeBoletoNovo?($scope.desabilitarConfirm=!1,$scope.desabilitarDownload=!0):($scope.desabilitarConfirm=!0,$scope.desabilitarDownload=!1),$scope.modalArrasto.show()},function(response){Notification.error(response)})):Notification.error($translate.instant("Aluno.Ajuste.Boleto.Erro.CodigoInvalido"))},$scope.downloadBoleto=function(){AjusteBoletoService.downloadBoleto($scope.codBoleto)},$scope.prorrogarVencimentoBoleto=function(){loading(!0),AjusteBoletoService.getProrrogaVencimentoBoleto($scope.codBoleto).then(function(response){loading(!1),$scope.codBoleto=response.valor,$scope.desabilitarConfirm=!0,$scope.desabilitarDownload=!1,carregarListaBoletos(),Notification.success($translate.instant("Aluno.Ajuste.Boleto.Sucesso"))},function(response){Notification.error($translate.instant("Aluno.Ajuste.Boleto.Erro.Ajuste"))})},$ionicModal.fromTemplateUrl("modal-arrasto",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalArrasto=modal})}]),angular.module("custom.controllers").controller("DisciplinasMatriculadasController",["$scope","DisciplinasMatriculadasService","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","DownloadArquivo",function($scope,DisciplinasMatriculadasService,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,DownloadArquivo){DisciplinasMatriculadasService.obterDisciplinasMatriculadas().then(function(response){$scope.listaDisciplinas=response,loading(!1)},function(response){console.log(response)}),$scope.acessarPlanoDidatico=function(discip){$scope.dadosDisciplina=angular.copy(discip),$state.go("home.disciplinas-planodidatico",{disciplina:discip})},$scope.acessarPublicacoes=function(discip){$state.go("home.disciplinas-publicacoes",{disciplina:discip})};var ctrl=this;function loading(value){ctrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}ctrl.id="DisciplinasMatriculadasController",loading(!0),$scope.acessarCriteriosAvaliacao=function(disciplina){$state.go("home.disciplinas-criterios-de-avaliacao",{dadosDisciplina:disciplina})},$scope.acessarDiarioClasse=function(disciplina){$state.go("home.diarioclasse-detalhes",{disciplina:disciplina})},$scope.downloadEmenta=function(disciplina){loading(!0);let params={};params.url=Configs.getApiServer()+"/matricula/codDisciplina/"+disciplina.codDisciplina+"/obter-ementa",params.method="GET",DownloadArquivo.downloadArquivo(params)}}]),angular.module("custom.controllers").controller("PlanoDidaticoController",["$scope","DisciplinasMatriculadasService","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","$stateParams",function($scope,DisciplinasMatriculadasService,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,$stateParams){var disciplina;null===$stateParams.disciplina.turma||void 0===$stateParams.disciplina.turma?$state.go("home.disciplinas",{},{reload:!0}):(disciplina=$stateParams.disciplina,DisciplinasMatriculadasService.obterPlanosDidaticos(disciplina).then(function(response){$scope.planosDidatico=response[0],$scope.planosDidatico&&function(disciplina){DisciplinasMatriculadasService.obterDetalhePlanosDidaticos(disciplina,$scope.planosDidatico.DISCIPLINA).then(function(response){$scope.listarDetalhePlanosDidatico=response,loading(!1)},function(response){console.log(response)})}(disciplina),loading(!1)},function(response){console.log(response)}),$scope.dadosDisciplina=angular.copy($stateParams.disciplina));var ctrl=this;function loading(value){ctrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}ctrl.id="PlanoDidaticoController",$scope.voltarParaDisciplina=function(){$state.go("home.disciplinas")},loading(!0),$scope.currentPage=0,$scope.pageSize=10,$scope.data=[],$scope.numberOfPages=(()=>null!=$scope.listarDetalhePlanosDidatico?Math.ceil($scope.listarDetalhePlanosDidatico.length/$scope.pageSize):1)}]),angular.module("custom.controllers").controller("AlunoOcorrenciasController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData){var vm=this;vm.id="AlunoOcorrenciasController",$scope.id=vm.id,vm.sessionData=SessionData,vm.aluno=vm.sessionData.aluno,vm.responsavel="responsavel"===SessionData.perfil,$log.debug("[AlunoOcorrenciasController]\tvm=",vm),$log.debug("[AlunoOcorrenciasController]\t$rootScope=",$rootScope),$log.debug("[AlunoOcorrenciasController]\t$scope=",$scope),$ionicModal.fromTemplateUrl("views/logged/_aluno.ocorrencia.detail.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalOcorrencia=modal}),vm.openOcorrenciaDetail2=function(ocorrencia){vm.ocorrenciaItem=ocorrencia,$log.debug("[AlunoOcorrenciasController.openOcorrenciaDetail]\tvm=",vm),$log.debug("[AlunoOcorrenciasController.openOcorrenciaDetail]\tocorrencia=",ocorrencia),vm.modalOcorrencia.show()},$scope.closeOcorrenciaDetail2=function(){$log.debug("[AlunoOcorrenciasController]\tvm.closeOcorrenciaDetail2()"),vm.modalOcorrencia.hide()}}]),angular.module("custom.controllers").controller("AlunoBoletimController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData){var vm=this;vm.teste,vm.cell={},vm.chart={},vm.chart.options={},vm.chart.options.lengend={},vm.sessionData=SessionData,vm.aluno=vm.sessionData.aluno,vm.listarSubPeriodos=listarSubPeriodos,vm.openProvasDetail=function(cell,provas,subPeriodo){console.log(provas),vm.cell=cell,vm.provas=provas,vm.qtdProvas=vm.provas.length,listarSubPeriodos(vm.provas),vm.subPeriodoSelecionado=subPeriodo,filtrarProvas(subPeriodo),vm.modalProvas.show()},vm.openFaltasDetail=function(cell){vm.cell=cell,graficoFaltas(vm.cell),vm.modalFaltas.show()},vm.openBoletimDetail2=function(cell){vm.cell=cell,graficoFaltas(vm.cell.boletimAluno),$log.debug("[AlunoBoletimController.openBoletimDetail2]\tvm=",vm),vm.modalBoletim.show()},vm.graficoFaltas=graficoFaltas,vm.filtrarProvas=filtrarProvas,vm.filtroSubperiodo=!1,$log.debug("[AlunoBoletimController]\tvm=",vm),$ionicModal.fromTemplateUrl("views/logged/_boletim.detail.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalBoletim=modal}),$ionicModal.fromTemplateUrl("js/custom-components/boletim-provas/boletim-provas.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalProvas=modal}),$ionicModal.fromTemplateUrl("js/custom-components/boletim-faltas/boletim-faltas.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalFaltas=modal}),$scope.closeModalBoletim=function(modal){"faltas"===modal?vm.modalFaltas.hide():"provas"===modal?vm.modalProvas.hide():vm.modalBoletim.hide()};var chartGenerateLabels=function(chart){var labels=[];for(external_chart=chart,i=0;i<chart.data.labels.length;i++){var txt=chart.data.labels[i]+" ("+vm.chart.data[i]+")";labels.push({text:txt,fillStyle:Chart.defaults.global.colors[i],strokeStyle:Chart.defaults.global.colors[i]})}return $log.debug("chartGenerateLabels] chart=",chart),labels};function listarSubPeriodos(provas){for(vm.subPeriodos=[],i=0;i<provas.length;i++)if(pos=vm.subPeriodos.map(e=>e.descSubPeriodo).indexOf(provas[i].periodo.subPeriodo.descricao),-1===pos&&null!==provas[i].periodo.subPeriodo.descricao){var subPeriodo={};subPeriodo.codSubPeriodo=provas[i].periodo.subPeriodo.codSubPeriodo,subPeriodo.descSubPeriodo=provas[i].periodo.subPeriodo.descricao,vm.subPeriodos.push(subPeriodo),vm.filtroSubperiodo=!0}}function filtrarProvas(subPeriodo){var provasFiltradas=[];if(null!==subPeriodo&&null!==subPeriodo.codSubPeriodo)for(i=0;i<vm.provas.length;i++)vm.provas[i].periodo.subPeriodo.codSubPeriodo===subPeriodo.codSubPeriodo.toString()&&provasFiltradas.push(vm.provas[i]),null===vm.provas[i].periodo.subPeriodo.codSubPeriodo&&provasFiltradas.push(vm.provas[i]);else provasFiltradas=vm.provas;vm.provasFiltradas=provasFiltradas}function graficoFaltas(boletim){vm.chart.options={title:{display:!0,text:boletim.faltasSubPeriodo.faltasAcumuladas+" "+$translate.instant("Aluno.boletim.Faltas").toLowerCase()},legend:{display:!0,position:"bottom",labels:{generateLabels:chartGenerateLabels}}},Chart.defaults.global.colors=["#085970","#7DAA07","#B40808","#46BFBD","#FDB45C","#949FB1","#4D5360"],vm.chart.labels=[$translate.instant("Aluno.boletim.AulasAssistidas"),$translate.instant("Aluno.boletim.AulasRestantes"),$translate.instant("Aluno.boletim.Faltas")];var aulasAssistidas=boletim.boletim.turmaDisciplina.aulasMinistradas-boletim.faltasSubPeriodo.faltasAcumuladas;aulasAssistidas=aulasAssistidas<0?0:aulasAssistidas;var aulasRestantes=boletim.boletim.turmaDisciplina.aulasPrevistas-boletim.boletim.turmaDisciplina.aulasMinistradas;aulasRestantes=aulasRestantes<0?0:aulasRestantes,vm.chart.aulas=[boletim.boletim.turmaDisciplina.aulasPrevistas,boletim.boletim.turmaDisciplina.aulasMinistradas,boletim.faltasSubPeriodo.faltasAcumuladas],vm.chart.data=[aulasAssistidas,aulasRestantes,boletim.faltasSubPeriodo.faltasAcumuladas]}}]),angular.module("custom.controllers").controller("AlunoBoletimHomeController",["$scope","$http","$rootScope","SessionData","AlunoBoletimV2Service","Configs","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$log","AlunoCadastroService","UtilService","$ionicLoading","$filter","$window","RelatorioService",function($scope,$http,$rootScope,SessionData,AlunoBoletimV2Service,Configs,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$log,AlunoCadastroService,UtilService,$ionicLoading,$filter,$window,RelatorioService){angular.element($window);const alunoSessao=SessionData.aluno.list[SessionData.aluno.selecionado];switch($rootScope.view="notas",$rootScope.modalResumoVisivel=!1,$rootScope.notasContentIsVisible=!0,$rootScope.frequenciaLoading=!1,$state.current.name){case"home.boletim":$state.go("home.boletim.resumo"),$rootScope.view="resumo";break;case"home.boletim.resumo":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="resumo"})},500);break;case"home.boletim.notas":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="notas"})},600);case"home.boletim.faltas":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="faltas"})},500)}$scope.handleBarHeight=(frequencia=>frequencia>85?85:frequencia),$scope.handleFrequenciaPercent=(frequencia=>0!==frequencia?`${frequencia.toFixed(1)}%`:`${frequencia.toFixed(0)}%`),$scope.handleNotaHistograma=function(nota=null,faixa){null==nota&&(nota=$rootScope.notaProvaSelecionada);return parseInt(Number(nota))==faixa[3]||10==parseInt(Number(nota))&&(9==faixa[3]||10==faixa[3])},$scope.handleFaltaDataString=function(dataString){let arr=dataString.split(" ")[0].split("/");return`${arr[0]}/${arr[1]}`},$scope.handleNotasDecimals=function(nota){return isNaN(nota)?"---":parseFloat(nota)},$scope.closeModalNotas=function(){$rootScope.modalNotasVisivel=!1},$scope.handleCardContent=function(index,event,contentTarget){const faltasContent=bindDomElement(`#faltasDetailContent${index}`),notasContent=bindDomElement(`#notasDetailContent${index}`),notasBullet=bindDomElement(`#notasBullet${index}`),faltasBullet=bindDomElement(`#faltasBullet${index}`),cardContentName=bindDomElement(`#selectedCardContent${index}`);function switchCardContent(elToHide,elToShow,currentContentName,bulletToDisable,bulletToHighlight){elToHide.hide(),elToShow.fadeIn(),cardContentName.html(currentContentName),removeElClass(bulletToDisable,"active"),addElClass(bulletToHighlight,"active")}"Faltas"===contentTarget?switchCardContent(notasContent,faltasContent,contentTarget,notasBullet,faltasBullet):switchCardContent(faltasContent,notasContent,contentTarget,faltasBullet,notasBullet)},$scope.updateHistograma=function(codProva,disciplina,nota=null){if($rootScope.notaProvaSelecionada=nota,nota){disciplina.disciplina&&(disciplina.codDisciplina=disciplina.disciplina),$rootScope.histogramaLoading=!0,$rootScope.frequenciaLoading=!0;let ano=disciplina.periodo.ano?disciplina.periodo.ano:alunoSessao.ano,semestre=disciplina.periodo.semestre?disciplina.periodo.semestre:alunoSessao.semestre,turma=disciplina.turma?disciplina.turma:alunoSessao.turma;AlunoBoletimV2Service.getHistograma(ano,alunoSessao.codAluno,disciplina.codDisciplina,codProva,turma,semestre).then(function(res){disciplina.listaHistograma=res.listaHistograma,$rootScope.frequenciaLoading=!1,$rootScope.histogramaLoading=!1},function(err){$rootScope.frequenciaLoading=!1,$rootScope.histogramaLoading=!1})}else disciplina.listaHistograma=[]}}]),angular.module("custom.controllers").controller("AlunoBoletimV2Controller",["$scope","$http","$rootScope","SessionData","AlunoBoletimV2Service","Configs","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$log","$q","AlunoCadastroService","UtilService","$ionicLoading","$filter","$window","RelatorioService","$ionicSideMenuDelegate","$ionicGesture",function($scope,$http,$rootScope,SessionData,AlunoBoletimV2Service,Configs,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$log,$q,AlunoCadastroService,UtilService,$ionicLoading,$filter,$window,RelatorioService,$ionicSideMenuDelegate,$ionicGesture){var vm=this;const appWindow=angular.element($window),alunoSessao=SessionData.aluno.list[SessionData.aluno.selecionado];function loading(value){vm.loading=value,$scope.loading=vm.loading,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}switch($scope.handleNotaHistograma=function(nota,faixa){return parseInt(Number(nota))==faixa[3]||10==parseInt(Number(nota))&&(9==faixa[3]||10==faixa[3])},$scope.handleNormalizeString=function(string){return"string"==typeof string||string instanceof String?string.toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.substring(1)).join(" "):string},$scope.handleDateReturn=function(date){return null===date||"null"===date||void 0===date||"Invalid Date"===date?"---":new Date(date)},$scope.handleFaltaDataString=function(dataString){let arr=dataString.split(" ")[0].split("/");return`${arr[0]}/${arr[1]}`},$scope.handleDisciplinaModalDate=function(dataString){return dataString||"---"},$scope.handleFrequenciaPercent=(frequencia=>0!==frequencia?`${frequencia.toFixed(1)}%`:`${frequencia.toFixed(0)}%`),$scope.handleNotasDecimals=function(nota){return nota&&!isNaN(nota)?parseFloat(nota):nota},$scope.handleFaltasModalLabel=function(faltas){return faltas>1?"s":""},loading(!0),$rootScope.view="notas",$rootScope.modalResumoVisivel=!1,$scope.disciplinas=[],$state.current.name){case"home.boletim":$state.go("home.boletim.notas");break;case"home.boletim.resumo":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="resumo"})},500);break;case"home.boletim.notas":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="notas"})},600)}function removeElClass(el,cls){el.removeClass(cls)}function addElClass(el,cls){el.addClass(cls)}function bindDomElement(id){return angular.element(id)}$scope.filterForEnsinoMedio=!1,$scope.filtroSubperiodo=!1,$scope.subperiodo=[],$scope.subperiodoLabel="Subperíodo",$scope.filterDisplay=!1,$scope.handleFilterDisplay=function(){$scope.filterDisplay=!$scope.filterDisplay},$scope.handleFilter=function(periodo,filtroInicial=!1){$scope.subperiodoLabel=periodo.descricao,$scope.disciplinas=angular.copy($scope.preservedOriginalResponse);let result=[],resProvas=[];filtroInicial?$scope.disciplinas.forEach(function(disciplina){disciplina.aulasRestantes=disciplina.aulasPrevistas>=disciplina.aulasMinistradas?disciplina.aulasPrevistas-disciplina.aulasMinistradas:"--",disciplina.aulasAssistidas=disciplina.aulasMinistradas>=disciplina.faltas[0].faltasAcumuladas?disciplina.aulasMinistradas-disciplina.faltas[0].faltasAcumuladas:"--",disciplina.periodo.subPeriodoCorrente.codSubPeriodo==periodo.codSubPeriodo&&(disciplina.provas&&disciplina.provas.map(function(prova){prova.periodo.subPeriodo.codSubPeriodo==periodo.codSubPeriodo&&resProvas.push(prova)}),disciplina.provas=resProvas,resProvas=[],result.includes(disciplina)||result.push(disciplina))}):$scope.disciplinas.forEach(function(disciplina){disciplina.aulasRestantes=disciplina.aulasPrevistas>=disciplina.aulasMinistradas?disciplina.aulasPrevistas-disciplina.aulasMinistradas:"--",disciplina.aulasAssistidas=disciplina.aulasMinistradas>=disciplina.faltas[0].faltasAcumuladas?disciplina.aulasMinistradas-disciplina.faltas[0].faltasAcumuladas:"--",disciplina.provas&&disciplina.provas.map(function(prova){prova.periodo.subPeriodo.codSubPeriodo==periodo.codSubPeriodo&&null==resProvas.find(p=>p.codigoProva==prova.codigoProva)&&resProvas.push(prova)}),disciplina.provas=angular.copy(resProvas),result.includes(disciplina)||result.push(disciplina),resProvas=[]}),filtroInicial?($scope.subperiodoLabel="Todos",$scope.disciplinas=Object.assign($scope.preservedOriginalResponse)):$scope.disciplinas=result},$scope.clearFilter=function(){$scope.subperiodoLabel="Todos",$scope.disciplinas=Object.assign($scope.preservedOriginalResponse)},$scope.handleExpandableCards=function(index,event,disciplina){function obtemFreqHist(){$rootScope.frequenciaLoading=!0;let ano=disciplina.periodo.ano?disciplina.periodo.ano:alunoSessao.ano,semestre=disciplina.periodo.semestre?disciplina.periodo.semestre:alunoSessao.semestre,turma=disciplina.turma?disciplina.turma:alunoSessao.turma;AlunoBoletimV2Service.getFrequencia(ano,alunoSessao.codAluno,alunoSessao.id,disciplina.disciplina,turma,semestre).then(function(res){if(res){$rootScope.frequenciaLoading=!1;let frequencia=res[0];frequencia.faltasDiarias=function(arr){let tempArr=[];return arr.forEach(function(item){let count=function(dataFalta,arr){let count=0;return arr.forEach(function(falta,n){falta.dataAula==dataFalta&&count++}),count}(item.dataAula,arr);0===tempArr.filter(obj=>obj.dataAula===item.dataAula).length&&tempArr.push({...item,qtd:count})}),tempArr}(frequencia.faltasDiarias),disciplina.frequencia=frequencia,disciplina.aulasRestantes=disciplina.aulasPrevistas-disciplina.aulasMinistradas,disciplina.aulasRestantes<0&&(disciplina.aulasRestantes=0),disciplina.chartData=[disciplina.aulasMinistradas-disciplina.faltas[0].faltasAcumuladas,disciplina.faltas[0].faltasAcumuladas,disciplina.aulasPrevistas-disciplina.aulasMinistradas]}},function(err){console.log(err)})}if(appWindow.width()<1024)obtemFreqHist(),disciplina.provas&&disciplina.provas.length>0&&null!==disciplina.provas[0].nota&&$scope.updateHistograma(disciplina.provas[0].codigoProva,disciplina,disciplina.provas[0].nota),$scope.openModalNotas(disciplina);else{const cardHeader=bindDomElement(`#expandableCard${index}`),cardDetail=bindDomElement(`#cardDetail${index}`),cardIcon=bindDomElement(`#cardIcon${index}`);setTimeout(function(){$scope.$apply(function(){$rootScope.histograma=disciplina.listaHistograma})},500),cardDetail.hasClass("expandable")?(removeElClass(cardHeader,"card-is-open"),removeElClass(cardDetail,"expandable"),removeElClass(cardIcon,"icon-arrow-up"),addElClass(cardIcon,"icon-arrow-down")):($rootScope.histograma=disciplina.listaHistograma,angular.element(".card-details").removeClass("expandable"),angular.element(".card-default-component").removeClass("card-is-open"),obtemFreqHist(),disciplina.provas&&disciplina.provas.length>0&&$scope.updateHistograma(disciplina.provas[0].codigoProva,disciplina,disciplina.provas[0].nota),cardHeader.addClass("card-is-open"),cardDetail.addClass("expandable"),cardIcon.removeClass("icon-arrow-down").addClass("icon-arrow-up"))}},$scope.handleCardContent=function(index,event,contentTarget){const faltasContent=bindDomElement(`#faltasDetailContent${index}`),notasContent=bindDomElement(`#notasDetailContent${index}`),notasBullet=bindDomElement(`#notasBullet${index}`),faltasBullet=bindDomElement(`#faltasBullet${index}`),cardContentName=bindDomElement(`#selectedCardContent${index}`);function switchCardContent(elToHide,elToShow,currentContentName,bulletToDisable,bulletToHighlight){elToHide.hide(),elToShow.fadeIn(),cardContentName.html(currentContentName),removeElClass(bulletToDisable,"active"),addElClass(bulletToHighlight,"active")}"Faltas"===contentTarget?switchCardContent(notasContent,faltasContent,contentTarget,notasBullet,faltasBullet):switchCardContent(faltasContent,notasContent,contentTarget,faltasBullet,notasBullet)},$scope.closeModalResumo=function(){$rootScope.modalResumoVisivel=!1},$rootScope.closeModalFaltas=function(){$rootScope.modalFaltasVisivel=!1},$scope.closeModal=function(id){angular.element(id).fadeOut(),$scope.isFiltroActive=!1},$scope.showModal=function(modal){angular.element(`#${modal}`).fadeIn()},$scope.hideModal=function(modal){angular.element(`#${modal}`).fadeOut()},$scope.fecharFiltro=function(){$scope.isFiltroActive=!1},$scope.openModalResumo=function(item){item.provas=item.provas.sort((p1,p2)=>p1.ordemProva-p2.ordemProva),$rootScope.disciplinaSelecionada=item,$rootScope.modalResumoVisivel=!0},$scope.detalhesDisciplina=function(disciplina){disciplina.provas=disciplina.provas.sort((p1,p2)=>p1.ordemProva-p2.ordemProva),$rootScope.disciplina=disciplina,$rootScope.modalNotasVisivel=!0,$rootScope.modalResumoVisivel=!1,AlunoBoletimV2Service.getHistograma(alunoSessao.ano,alunoSessao.codAluno,disciplina.disciplina,disciplina.provas[0].codigoProva,alunoSessao.turma,alunoSessao.semestre).then(function(res){$rootScope.histograma=res.listaHistograma},function(err){console.log(err)})},$scope.openModalNotas=function(disciplina){$rootScope.fromNotasController=!1,$rootScope.disciplina=disciplina,$rootScope.modalNotasVisivel=!0,$scope.faltasContentModal=function(){console.log("faltasContentModal")},setTimeout(function(){angular.element("#notasModalBullet").click(()=>{$scope.$apply(function(){$rootScope.notasContentIsVisible=!0})}),angular.element("#faltasModalBullet").click(()=>{$scope.$apply(function(){$rootScope.notasContentIsVisible=!1})});const modalBoletim=angular.element(document.querySelector("#modalBoletim"));modalBoletim&&($ionicSideMenuDelegate.canDragContent(!1),$ionicGesture.on("swipeleft",function(e){$scope.$apply(function(){$rootScope.notasContentIsVisible=!1})},modalBoletim),$ionicGesture.on("swiperight",function(e){$scope.$apply(function(){$rootScope.notasContentIsVisible=!0})},modalBoletim))},1500)},$scope.notaSelecionada=function(index){$scope.selectedRow=index},$scope.updateHistograma=function(codProva,disciplina,nota=null){if(nota){if(disciplina){disciplina.codDisciplina=disciplina.disciplina;let ano=disciplina.periodo.ano?disciplina.periodo.ano:alunoSessao.ano,semestre=disciplina.periodo.semestre?disciplina.periodo.semestre:alunoSessao.semestre,turma=disciplina.turma?disciplina.turma:alunoSessao.turma;$rootScope.histogramaLoading=!0,AlunoBoletimV2Service.getHistograma(ano,alunoSessao.codAluno,disciplina.codDisciplina,codProva,turma,semestre).then(function(res){disciplina.listaHistograma=res.listaHistograma,disciplina.listaHistograma.notaSelecionada=nota,$rootScope.histogramaLoading=!1},function(err){console.log(err),$rootScope.histogramaLoading=!1})}}else disciplina.listaHistograma=[]},$rootScope.chartFaltas={data:[],colors:["#27AE60","#D72121","#FF7A00"],labels:["Aulas Assistidas","Faltas","Aulas Restantes"],options:{responsive:!0,elements:{arc:{borderWidth:0}},maintainAspectRatio:!1,cutoutPercentage:50,title:{display:!1},legend:{display:!1}}},RelatorioService.verificaReportServiceEntry("Boletim",alunoSessao.codAluno).then(function(result){vm.exibeRelatorio=result}).catch(function(err){console.log(err)}),$scope.imprimirRelatorio=function(pagina,aluno=alunoSessao.codAluno){RelatorioService.downloadReportService(pagina,aluno)},loading(!0),AlunoBoletimV2Service.getDisciplinas(alunoSessao.id,alunoSessao.codAluno).then(function(disciplinas){var listSubPeriodo;disciplinas&&disciplinas.length>0&&((listSubPeriodo=disciplinas[0].periodo.listSubPeriodo)&&(vm.subPeriodos=[],$scope.subperiodo=[],listSubPeriodo.map(subperiodo=>{$scope.subperiodo.includes(subperiodo)||$scope.subperiodo.push({codSubPeriodo:subperiodo.codSubPeriodo,descricao:subperiodo.descricao}),$scope.filtroSubperiodo=!0}),$scope.subperiodo.length>0&&($scope.filtroSubperiodo=!0)),disciplinas.map(disciplina=>{disciplina.aulasRestantes=disciplina.aulasPrevistas>=disciplina.aulasMinistradas?disciplina.aulasPrevistas-disciplina.aulasMinistradas:"--",disciplina.aulasAssistidas=disciplina.aulasMinistradas>=disciplina.faltas[0].faltasAcumuladas?disciplina.aulasMinistradas-disciplina.faltas[0].faltasAcumuladas:"--",disciplina.provas&&(disciplina.provas=disciplina.provas.sort((p1,p2)=>p1.ordemProva-p2.ordemProva))})),$scope.preservedOriginalResponse=disciplinas,$scope.disciplinas=angular.copy($scope.preservedOriginalResponse),$scope.disciplinas&&$scope.disciplinas.length>0?AlunoBoletimV2Service.getProvasBoletim(alunoSessao.id,alunoSessao.codAluno).then(function(res){if(loading(!1),null!==res[0].periodo.subPeriodoCorrente)if(res[0].periodo.subPeriodoCorrente){let initialQuery={codSubPeriodo:res[0].periodo.subPeriodoCorrente.codSubPeriodo,descricao:res[0].periodo.subPeriodoCorrente.descricao};$scope.handleFilter(initialQuery,!0)}else $scope.clearFilter(),loading(!1)},function(err){loading(!1)}):loading(!1)},function(err){loading(!1)}),$scope.disciplinaEmCurso=!1,$scope.totalAulas=30,$scope.isFiltroActive=!1}]),angular.module("custom.controllers").controller("AlunoBoletimV2NotasController",["$scope","AlunoBoletimV2Service","$rootScope","$http","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$log","AlunoCadastroService","UtilService","$ionicLoading","$window","RelatorioService",function($scope,AlunoBoletimV2Service,$rootScope,$http,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$log,AlunoCadastroService,UtilService,$ionicLoading,$window,RelatorioService){var ctrl=this;const alunoSessao=SessionData.aluno.list[SessionData.aluno.selecionado];angular.element($window);function loading(value){ctrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}$scope.handleNormalizeString=function(string){return"string"==typeof string||string instanceof String?string.toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.substring(1)).join(" "):string},$scope.handleNotasDecimals=function(nota){return parseFloat(nota)},$scope.inicializar=function(){$scope.disciplinas=[],$scope.disciplinaEmCurso=!1,$scope.open=!1,$rootScope.modalNotasVisivel=!1,$scope.ano=[],$scope.semestre=[],loading(!0),AlunoBoletimV2Service.getUltimasNotas(alunoSessao.user.id,alunoSessao.codAluno,10).then(function(res){$scope.disciplinas=res,loading(!1)},function(err){console.log(err)})},$scope.toggleFiltro=function(){$scope.open=!$scope.open},$scope.detalhesDisciplina=function(disciplina){$rootScope.disciplina=disciplina;let alunoSessao=SessionData.aluno.list[0];AlunoBoletimV2Service.getHistograma(disciplina.periodo.ano,alunoSessao.codAluno,disciplina.disciplina,disciplina.provas[0].codigoProva,disciplina.codTurma,disciplina.periodo.semestre).then(function(res){$rootScope.histograma=res.listaHistograma},function(err){console.log(err)})},$scope.filtrar=function(options){$scope.disciplinas=$scope.disciplinas.filter(disciplina=>disciplina.periodo.ano==Number(options.ano)&&disciplina.periodo.semestre==Number(options.semestre)),$scope.toggleFiltro()},$scope.openModalNotas=function(disciplina){if(loading(!0),AlunoBoletimV2Service.getProvasDisciplina(alunoSessao.codAluno,disciplina.codDisciplina,disciplina.codTurma,disciplina.periodo.ano,disciplina.periodo.semestre).then(function(provas){provas=AlunoBoletimV2Service.ordenaProvas(provas),disciplina.provas=provas,loading(!1)},function(err){console.log(err)}),disciplina&&""!==disciplina.nota){let ano=disciplina.periodo.ano?disciplina.periodo.ano:alunoSessao.ano,semestre=disciplina.periodo.semestre?disciplina.periodo.semestre:alunoSessao.semestre,turma=disciplina.codTurma?disciplina.codTurma:alunoSessao.turma;AlunoBoletimV2Service.getHistograma(ano,alunoSessao.codAluno,disciplina.codDisciplina,disciplina.codigoProva,turma,semestre).then(res=>{$rootScope.histograma=res.listaHistograma,disciplina.listaHistograma=res.listaHistograma,disciplina.notaMaxProva=res.notaMaxProva},err=>{})}$rootScope.fromNotasController=!0,$rootScope.disciplina=disciplina,$rootScope.modalNotasVisivel=!0},RelatorioService.verificaReportServiceEntry("Boletim",alunoSessao.codAluno).then(function(result){ctrl.exibeRelatorio=result}).catch(function(err){console.log(err)}),$scope.imprimirRelatorio=function(pagina,aluno=alunoSessao.codAluno){RelatorioService.downloadReportService(pagina,aluno)},$scope.inicializar()}]),angular.module("custom.controllers").controller("AlunoCalendarioAulasController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Aluno.HorariosAula",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Aluno_HorariosAula){var vm=this;vm.sessionData=SessionData,vm.aluno=vm.sessionData.aluno;var alunoSelecionado=vm.aluno.list[vm.aluno.selecionado];function Aluno_HorariosAula_handleSuccess(data){for($log.debug("[Aluno_HorariosAula_handleSuccess]\tdata=",data),vm.horariosAula=data.content,$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.horariosAula:",vm.horariosAula),i=0;i<vm.horariosAula.length;i++){var h=vm.horariosAula[i],hano=h.turmaDisciplina.turma.periodo.ano,hsemestre=h.turmaDisciplina.turma.periodo.semestre;$log.debug("[Aluno_HorariosAula_handleSuccess]\ti=",i,"horarioAula[i]:",h),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"] = "+vm.tableData.ano.list[hano]+" ?"),void 0===vm.tableData.ano.list[hano]&&(vm.tableData.ano.list[hano]={semestre:{list:{},selecionado:0}}),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"]:",vm.tableData.ano.list[hano]),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"].semestre.list["+hsemestre+"] = ",vm.tableData.ano.list[hano].semestre.list[hsemestre]+" ?"),void 0===vm.tableData.ano.list[hano].semestre.list[hsemestre]&&(vm.tableData.ano.list[hano].semestre.list[hsemestre]={diaSemana:{list:{}}}),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"].semestre.list["+hsemestre+"]:",vm.tableData.ano.list[hano].semestre.list[hsemestre]),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"].semestre.list["+hsemestre+"].diaSemana.list["+h.diaSemana+"] = ",vm.tableData.ano.list[hano].semestre.list[hsemestre].diaSemana.list[h.diaSemana]+" ?"),void 0===vm.tableData.ano.list[hano].semestre.list[hsemestre].diaSemana.list[h.diaSemana]&&(vm.tableData.ano.list[hano].semestre.list[hsemestre].diaSemana.list[h.diaSemana]={list:[]}),vm.tableData.ano.list[hano].semestre.list[hsemestre].diaSemana.list[h.diaSemana].list.push({horaIni:h.horaIni,horaFim:h.horaFim,nomeDisciplina:h.turmaDisciplina.disciplina.nome,codDisciplina:h.turmaDisciplina.disciplina.codDisciplina,nomeUnidadeFisica:h.nomeUnidadeFisica,dependencia:h.dependencia,icone:h.turmaDisciplina.disciplina.icone,turma:h.turmaDisciplina.turma.turma,nomeDocente:h.turmaDisciplina.disciplina.nomeDocente}),$log.debug("[Aluno_HorariosAula_handleSuccess]\tvm.tableData.ano.list["+hano+"].semestre.list["+hsemestre+"].diaSemana.list["+h.diaSemana+"]:",vm.tableData.ano.list[hano].semestre.list[hsemestre].diaSemana.list[h.diaSemana])}vm.tableData.selectAno(vm.tableData.getAnos()[0]),vm.tableData.selectSemestre(vm.tableData.getSemestres()[0])}function Aluno_HorariosAula_handleFailure(reason){Notification.error("[Aluno_HorariosAula_handleFailure]\treason:"+reason)}vm.tableData={dayOfWeek:"0",ano:{list:{},selecionado:0}},window.tableData=vm.tableData,$log.debug("[AlunoCalendarioAulasController]\nChamando resource: Aluno.HorariosAula..."),$log.debug("Day of week: "+vm.tableData.dayOfWeek),vm.horariosAula=Aluno_HorariosAula.query({codPessoa:alunoSelecionado.id,codAluno:encodeURIComponent(alunoSelecionado.codAluno),diaSemana:vm.tableData.dayOfWeek},Aluno_HorariosAula_handleSuccess,Aluno_HorariosAula_handleFailure),vm.tableData.getAnos=function(){return Object.keys(this.ano.list)},vm.tableData.getSemestres=function(){var sems=[];this.getAnos();return void 0!==this.ano.list[this.ano.selecionado]&&(sems=Object.keys(this.ano.list[this.ano.selecionado].semestre.list)),sems},vm.tableData.getDiasSemana=function(){var dias=[],ano=this.ano;if(void 0!==this.ano.list[ano.selecionado]){var sem=this.ano.list[ano.selecionado].semestre,dia=sem.list[sem.selecionado];void 0!==sem.list[sem.selecionado]&&(dias=Object.keys(dia.diaSemana.list))}return dias},vm.tableData.selectAno=function(ano){vm.tableData.ano.selecionado=ano,$log.debug("[selectAno]\tano=",ano)},vm.tableData.selectSemestre=function(semestre){var ano=vm.tableData.ano;if(void 0!==ano){var semestres=vm.tableData.ano.list[ano.selecionado];if(void 0!==semestres){var sem=semestres.semestre;void 0!==sem&&(sem.selecionado=semestre)}}$log.debug("[selectSemestre]\tsememestre="+semestre)},vm.tableData.getNomeDiaSemana=function(dia){var nome="";return dia>=1&&dia<=7&&(nome=["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"][dia-1]),$log.debug("[getNomeDiaSemana]\tdia=",dia,"\tnome=",nome),nome},vm.tableData.getDiaSemana=function(dia){var diaSemana={},ano=this.ano,sem=this.ano.list[ano.selecionado];return void 0!==sem&&(diaSemana=sem.semestre.list[sem.semestre.selecionado].diaSemana.list[dia]),$log.debug("[getDiaSemana]\tdiaSemana=",diaSemana),diaSemana},vm.tableData.getDisciplinas=function(dia){var ds=[],diaSemana=this.getDiaSemana(dia);return void 0!==diaSemana&&(ds=diaSemana.list),$log.debug("[getDisciplinas]\tdia=",dia,"ds=",ds,"diaSemana=",diaSemana),ds},vm.tableData.haveData=function(){$log.debug("[tableData.haveData]\ttableData.ano:",vm.tableData.ano),$log.debug("[tableData.haveData]\t tableData.ano.list:",tableData.ano.list);var ret=!1;return void 0!==vm.tableData.ano&&void 0!==vm.tableData.ano.list&&Object.keys(vm.tableData.ano.list).length>0&&(ret=!0),$log.debug("[tableData.haveData]\treturn:",ret),ret},vm.tableData.listHorarios=function(diaDaSemana){vm.clearListaHorarios(),vm.horariosAula=Aluno_HorariosAula.query({codPessoa:alunoSelecionado.id,codAluno:encodeURIComponent(alunoSelecionado.codAluno),diaSemana:diaDaSemana},Aluno_HorariosAula_handleSuccess,Aluno_HorariosAula_handleFailure)},vm.clearListaHorarios=function(){vm.horariosAula=void 0,vm.tableData.ano.list={}},$ionicModal.fromTemplateUrl("views/logged/_aluno.aviso.detail.view.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalAviso=modal}),vm.openAvisoDetail2=function(aviso){vm.avisoItem=aviso,$log.debug("[HomeAppController.openAvisoDetail]\tvm=",vm),$log.debug("[HomeAppController.openAvisoDetail]\taviso=",aviso),vm.modalAviso.show()},$scope.closeAvisoDetail2=function(){$log.debug("[HomeAppController]\tvm.closeAvisoDetail2()"),vm.modalAviso.hide()},$log.debug("[AlunoCalendarioAulasController]\tvm=",vm)}]),angular.module("custom.controllers").controller("AlunoMinhaTurmaController",["$log","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData",function($log,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData){$log.debug("[MinhaTurmaController]\tvm_list=",this,"SessionData=",SessionData);var alunos=SessionData.aluno;this.aluno=alunos.list[alunos.selecionado]}]),angular.module("custom.controllers").controller("AgendaController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Event.Aluno",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Event_Aluno){this.id="AgendaController",$scope.AgendaController_id="AgendaController",$log.debug("[AgendaController]\tvm=",this,"$scope=",$scope)}]),angular.module("custom.controllers").controller("AgendaCalendarController",["$log","$scope","$q","Configs","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Event.Aluno","uiCalendarConfig","agendaEventService","$ionicLoading",function($log,$scope,$q,Configs,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Event_Aluno,uiCalendarConfig,agendaEventService,$ionicLoading){var ctrl=this;function loading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}ctrl.id="AgendaCalendarController",$scope.AgendaCalendarController_id="AgendaCalendarController",$scope.eventSources=[],$log.debug("[AgendaCalendarController]\tctrl=",ctrl),$log.debug("[AgendaCalendarController]\t$scope=",$scope),ctrl.sessionData=SessionData,ctrl.aluno=ctrl.sessionData.aluno,ctrl.agenda=ctrl.sessionData.agenda,ctrl.alunoSelecionado=ctrl.aluno.list[ctrl.aluno.selecionado];var agendaCalendar=uiCalendarConfig.calendars.agendaCalendar;xUiCalendarConfig=uiCalendarConfig,ctrl.dayClick=function(date,jsEvent,view){$log.debug("[dayClick]\tuiCalendarConfig=",uiCalendarConfig),$log.debug("[dayClick]\tdate=",date,"jsEvent=",jsEvent,"view=",view);ctrl.agenda.selectedDate=date;var agendaCalendar=uiCalendarConfig.calendars.agendaCalendar;agendaCalendar.fullCalendar("select",date),agendaCalendar.fullCalendar("gotoDate",date),$log.debug("[dayClick]\tuiCalendarConfig.calendars[calendar]=",uiCalendarConfig.calendars.agendaCalendar),$log.debug("[dayClick]\tagenda.selectedDate=",ctrl.agenda.selectedDate.format()),$state.go("home.agenda-list")},ctrl.alertEventOnClick=function(event,jsEvent,view){$log.debug("[alertEventOnClick] arguments=",arguments);ctrl.agenda.selectedDate=event.start,agendaCalendar.fullCalendar("select",event.start),agendaCalendar.fullCalendar("gotoDate",event.start),agendaEventService.setEvent(event),$state.go("home.agenda-event")},ctrl.alertOnDrop=function(){},ctrl.alertOnResize=function(){},ctrl.getEvents=function(start,end,timezone,callback){var dataInicio=start.toISOString()+"T00:00:00.000-03:00",dataFinal=end.toISOString()+"T00:00:00.000-03:00";ctrl.legendas=[],ctrl.agenda.events=[];var canceler=$q.defer();Event_Aluno.query({codPessoa:ctrl.alunoSelecionado.id,start:dataInicio,end:dataFinal,codAluno:encodeURIComponent(ctrl.alunoSelecionado.codAluno),timezone:timezone},function(result){ctrl.eventos=result.content,$scope.eventSources=ctrl.eventos,agendaCalendar=uiCalendarConfig.calendars.agendaCalendar;for(var events=angular.copy(ctrl.eventos),eventos=new Array,i=0;i<events.length;i++){var evento={allDay:events[i].allDay,backgroundColor:events[i].backgroundColor,borderColor:events[i].borderColor,className:events[i].className,color:events[i].color,descricao:events[i].descricao,durationEditable:events[i].durationEditable,editable:events[i].editable,eventId:events[i].eventId,eventSource:events[i].eventSource,icone:events[i].icone,id:events[i].id,links:events[i].links,nomeSubdisciplina:events[i].nomeSubdisciplina,overlap:events[i].overlap,redenring:events[i].redenring,resourceEditable:events[i].resourceEditable,startEditable:events[i].startEditable,textColor:events[i].textColor,timeZone:events[i].timeZone,url:events[i].url,title:events[i].title,start:events[i].startStr,end:events[i].endStr,tipoEvento:events[i].tipoEvento,hoverInfo:events[i].hoverInfo};eventos.push(evento)}if(ctrl.agenda.events=eventos,ctrl.agenda.events[0]&&ctrl.agenda.events[0].start){loading(!0),$http.pendingRequests[0]&&$http.pendingRequests[0].url.includes("events")&&canceler.resolve();let sData=new Date(ctrl.agenda.events[0].start);const monthNames=["janeiro","fevereiro","marco","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];var url=Configs.getApiServer()+"/pessoas/"+ctrl.alunoSelecionado.id+"/alunos/"+encodeURIComponent(ctrl.alunoSelecionado.codAluno)+"/mes/"+encodeURI(monthNames[sData.getMonth()])+"/ano/"+sData.getFullYear()+"/legenda-calendario",req={method:"GET",url:url,timeout:canceler.promise,headers:{"Content-Type":"application/json"}};$http(req).then(function(response){ctrl.legendas=angular.copy(response.data),loading(!1)},function(response){Notification.error("Erro ao obter revisões")}),callback(eventos)}},function(reason){$log.debug("[Event_Aluno_handleFailure]\treason=",reason),Notification.error("[Event_Aluno_handleFailure]\treason="+reason),$ionicLoading.hide()})},ctrl.eventRender=function(event,element,view){element.attr({title:event.hoverInfo,"tooltip-append-to-body":!0}),$compile(element)($scope)},$timeout(function(){uiCalendarConfig.calendars.agendaCalendar.fullCalendar("gotoDate",$scope.events[0].start)}),ctrl.uiConfig={calendar:{theme:!0,header:{left:"prev,next,today",center:"title",right:"month,agendaWeek,agendaDay"},buttonText:{today:"Hoje",month:"Mês",week:"Semana",day:"Dia"},slotEventOverlap:!1,nowIndicator:!0,disableDragging:!0,selectable:!1,unselectAuto:!0,height:"auto",slotLabelFormat:"H:mm",groupByDateAndResource:!0,eventDrop:ctrl.alertOnDrop,eventResize:ctrl.alertOnResize,dayClick:ctrl.dayClick,eventClick:ctrl.alertEventOnClick,eventOverlap:!1,displayEventEnd:!0,locale:"pt-br",defaultDate:ctrl.agenda.selectedDate,slotDuration:"00:20:00",timeFormat:"H:mm",ignoreTimezone:!1,navLinks:!0,editable:!1,eventLimit:!1,eventRender:ctrl.eventRender,eventSources:[{events:ctrl.getEvents}]}},$log.debug("[showCalendarButton]\tctrl.agenda=",ctrl.agenda)}]),angular.module("custom.controllers").controller("AgendaListController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Event.Aluno","uiCalendarConfig",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Event_Aluno,uiCalendarConfig){$log.debug("[AgendaListController]\tvm_list=",this,"SessionData=",SessionData),this.date=SessionData.agenda.selectedDate.format(),this.agenda=SessionData.agenda,this.getWindowWidth=function(){return $(window).width()}}]),angular.module("custom.controllers").controller("AgendaEventController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Event.Aluno","uiCalendarConfig","agendaEventService",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Event_Aluno,uiCalendarConfig,agendaEventService){var vm=this;if(vm.id="AgendaEventController",$scope.AgendaEventController_id="AgendaEventController",vm.event=agendaEventService.getEvent(),null!=vm.event.start){var startData=vm.event.start._i;vm.event.start=startData}if(null!=vm.event.end){var endData=vm.event.end._i;vm.event.end=endData}$log.debug("[AgendaEventController]\t$scope=",$scope,"vm=",vm,"SessionData=",SessionData),vm.title=$translate.instant("Home.view.calendario.agendaEvento")}]),angular.module("custom.controllers").controller("ServicoListController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Aluno.Secretaria.Servicos","uiCalendarConfig","$ionicLoading","Configs","ServicoService",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,ServicosSolicitados,uiCalendarConfig,$ionicLoading,Configs,ServicoService){var vm=this;vm.servicos={},$log.debug("[ServicoListController]\tvm_list=",vm,"SessionData=",SessionData);var alunos=SessionData.aluno,alunoSelecionado=alunos.list[alunos.selecionado];function loading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200}):$ionicLoading.hide()}function getRequestedServices(){var req={method:"GET",url:Configs.getApiServer()+"/pessoas/alunos/"+encodeURIComponent(encodeURIComponent(alunoSelecionado.codAluno))+"/servicos-solicitados-com-anexos",headers:{"Content-Type":"application/json"},params:{page:0,size:99999}};$timeout(function(){loading(!0),$http(req).then(handleSuccess,handleFailure)},1e3)}function handleSuccess(result){$timeout(function(){vm.servicos.result=result.data,loading(!1),$log.debug("[ServicosSolicitados_handleSuccess]\tresult=",result)})}function handleFailure(reason){$timeout(function(){$log.debug("[ServicosSolicitados_handleFailure]\treason=",reason),Notification.error("[ServicosSolicitados_handleFailure]\treason="+reason),loading(!1)})}getRequestedServices(),$scope.$on("callListServicos",function(){getRequestedServices()})}]),angular.module("custom.controllers").controller("ServicoSolicitacaoController",["$log","$scope","$rootScope","$state","$ionicModal","SessionData","ServicoService","$ionicLoading","$http","Upload","Configs","Notification","AonlineUtils","Storage",function($log,$scope,$rootScope,$state,$ionicModal,SessionData,ServicoService,$ionicLoading,$http,Upload,Configs,Notification,AonlineUtils,Storage){function loading(value){servicoSolicitacaoCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}function getParameterAndValues(paramList){var requiredStructure=[];return angular.forEach(paramList,function(value,index){value.valor?requiredStructure.push({param:value.parametroServico,valorParam:value.valor}):requiredStructure.push({param:value.parametroServico,valorParam:null})}),requiredStructure}$scope.validatedRequest=null,$scope.isDisabled=!1,$scope.escolhasDetalhes=null,$rootScope.listaServicosAdicionados=SessionData.carrinho,servicoSolicitacaoCtrl=this,servicoSolicitacaoCtrl.id="ServicoSolicitacaoController",$scope.anexoInvalido=!0,$scope.filtroServicosAdicionados="",$rootScope.listaServicosAdicionados||($rootScope.listaServicosAdicionados=[]),$scope.filtroServicos="",AonlineUtils.showLoading(!0),ServicoService.listarServicos().then(function(result){AonlineUtils.showLoading(!1),$scope.listaServicos=result,$scope.mapaSolicitacao={};for(var i=0;i<result.length;i++)null==$scope.mapaSolicitacao[result[i].grupo]?($scope.mapaSolicitacao[result[i].grupo]=[],$scope.mapaSolicitacao[result[i].grupo].push(result[i])):$scope.mapaSolicitacao[result[i].grupo].push(result[i]);$scope.tamanhoMapa=Object.keys($scope.mapaSolicitacao).length}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),$rootScope.totalValor=0,$rootScope.listaServicosAdicionados.forEach(function(aux){$rootScope.totalValor=$rootScope.totalValor+aux.custoUnitario*aux.quantidade}),$scope.concluirSolicitacao=function(){$rootScope.listaServicosAdicionados=$rootScope.listaServicosAdicionados},$scope.removerServicoAdicionado=function(servico){index=$rootScope.listaServicosAdicionados.indexOf(servico),$rootScope.listaServicosAdicionados.splice(index,1),$rootScope.totalValor=$rootScope.totalValor-servico.custoUnitario*servico.quantidade,$scope.validatedRequest&&$scope.validatedRequest.itemSolicitacaoServicoAnexos&&$scope.validatedRequest.itemSolicitacaoServicoAnexos.splice(index,1),SessionData.carrinho=$rootScope.listaServicosAdicionados},$scope.abrirServico=function(servico){loading(!0),$scope.dataServiceFields={},$scope.dataServiceFields.arquivoAnexos=[],$scope.dynamicServiceFields=[];var req={method:"POST",url:Configs.getApiServer()+"/pessoas/obtem_servico_solicitavel",headers:{"Content-Type":"application/json"},data:{codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codServico:$scope.servicoPreencher.servico}};$http(req).then(function(response){response.data.maxQtdeSolic=1,$scope.fileName="",$scope.dynamicServiceFields=response.data;var hasDocumentNecessario=!1;if(null!=$scope.dynamicServiceFields.documentosNecessariosList&&$scope.dynamicServiceFields.documentosNecessariosList.length>=1)for(var i=0;i<$scope.dynamicServiceFields.documentosNecessariosList.length;i++)$scope.dynamicServiceFields.documentosNecessariosList[i].ativo&&(hasDocumentNecessario=!0,console.log("Existe Ativo"));$scope.dynamicServiceFields.hasDocumentNecessario=hasDocumentNecessario;var req={method:"GET",url:Configs.getApiServer()+"/pessoas/obtem_texto_autorizacao_solicitacao_servico"};$http(req).then(function(response){$scope.dynamicServiceFields._serviceAuthText=response.data.conteudo;var req={method:"POST",url:Configs.getApiServer()+"/pessoas/obtem_observacoes_servico",headers:{"Content-Type":"application/json"},data:{codServico:$scope.servicoPreencher.servico}};$http(req).then(function(response){$scope.dynamicServiceFields.obsDetalhe=response.data.obsDetalhe,$scope.dynamicServiceFields.obsFinal=response.data.obsFinal,$scope.dynamicServiceFields.obsConfirmacao=response.data.obsConfirmacao,$scope.dynamicServiceFields.obsAnexo=response.data.obsAnexo,loading(!1)},function(response){Notification.error(response),loading(!1)}),loading(!1)},function(response){Notification.error(response),loading(!1)}),$scope.modalSolicitar.hide(),$scope.modalPreencher.show(),loading(!1)},function(response){Notification.error(response),loading(!1)})},$scope.listaOpcoesCampo=function(campo){return $scope.listaOpcoes=[],ServicoService.listarCamposServico(campo).then(function(result){$scope.listaOpcoes=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.listaOpcoes},$scope.irServicoList=function(){$state.go("home.servico-list")},$scope.preencherServico=function(servico){$scope.servicoPreencher=servico},$scope.avancarServico=function(servico){$scope.servicoPreencher=servico,$scope.abrirServico(servico)},$scope.obtem_revisao_prova=function(){var url=Configs.getApiServer()+"/pessoas/cod_aluno/"+SessionData.aluno.list[SessionData.aluno.selecionado].codAluno+"/lista_provas_aluno";$http({method:"GET",url:url,headers:{"Content-Type":"application/json"}}).then(function(response){$scope.revisaoProva=response.data},function(response){Notification.error("Erro ao obter revisões")})},$scope.comboboxParams=[],$scope.obtem_servico_parametro=function(parametro){var params=[],inputList=$("#dynamicForm input,select");$.each(inputList,function(index,value){"parametro"===value.id&&(""==!value.value?params.push(value.value):params.push(null))});var req={method:"POST",url:Configs.getApiServer()+"/pessoas/obtem_combo_parametro/",headers:{"Content-Type":"application/json"},data:{codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codServico:$scope.servicoPreencher.servico,parametro:parametro,parametrosConsulta:params}};$http(req).then(function(response){$scope.comboboxParams[parametro]=response.data},function(response){Notification.error("Erro ao obter parâmetro")})},$scope.atualizaDropDown=function(){var inputList=$("#dynamicForm input,select");$.each(inputList,function(index,value){"parametro"===value.id&&""==value.value&&$scope.obtem_servico_parametro(value.name)})},$scope.atualizaHtml=function(){var select=$(".selectMenuSolicitacao"),escolhas=[];$.each(select,function(index,val){val.value?escolhas.push(val.value):val.children&&val.children[1]&&val.children[1].value&&("text"==val.children[1].type||"number"==val.children[1].type||"time"==val.children[1].type||"date"==val.children[1].type||"datetime-local"==val.children[1].type)?escolhas.push(val.children[1].value):escolhas.push("")}),$scope.escolhasDetalhes=escolhas;var req={method:"POST",url:Configs.getApiServer()+"/pessoas/atualiza_html/",headers:{"Content-Type":"application/json"},data:{codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codServico:$scope.servicoPreencher.servico,escolhas:escolhas}};$http(req).then(function(response){resultado=response.data,$scope.dynamicServiceFields.docAutorizacao=resultado.aut},function(response){Notification.error("Erro ao obter html")})},$scope.getCatListaServicos=function(){var aux=[];return angular.forEach($scope.listaServicos,function(item,index){aux.indexOf(item.tipo)<0&&aux.push(item.tipo)}),aux},$scope.uploadMultiAnexosServico=function(file,field){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}),$scope.fileName=file.name,field.fileName=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1],req={method:"POST",url:Configs.getApiServer()+"/pessoas/envia_anexo_servico/",headers:{"Content-Type":"application/json"},data:{codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codServico:$scope.servicoPreencher.servico,contentType:file.type,fileData:base64Data,filename:file.name,codArquivoAnterior:field.codArquivo?field.codArquivo:""}};$http(req).then(function(resp){$ionicLoading.hide(),$scope.dataServiceFields.codArquivo=resp.data.codArquivo;var arquivoAnexo={};arquivoAnexo.codArquivo=resp.data.codArquivo,arquivoAnexo.tipoDocumento=field.documento,$scope.dataServiceFields.arquivoAnexos.push(arquivoAnexo),field.codArquivo=resp.data.codArquivo,$scope.anexoInvalido=!1,field.anexoInvalido=!1},function(resp){$ionicLoading.hide(),Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0,field.anexoInvalido=!0})}})},$scope.uploadAnexoServico=function(file){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}),$scope.fileName=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1],req={method:"POST",url:Configs.getApiServer()+"/pessoas/envia_anexo_servico/",headers:{"Content-Type":"application/json"},data:{codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codServico:$scope.servicoPreencher.servico,contentType:file.type,fileData:base64Data,filename:file.name,codArquivoAnterior:$scope.dataServiceFields.codArquivo?$scope.dataServiceFields.codArquivo:""}};$http(req).then(function(resp){$ionicLoading.hide(),$scope.dataServiceFields.codArquivo=resp.data.codArquivo;var arquivoAnexo={};arquivoAnexo.codArquivo=resp.data.codArquivo,$scope.dataServiceFields.arquivoAnexos.push(arquivoAnexo),codArquivo=resp.data.codArquivo,$scope.anexoInvalido=!1},function(resp){$ionicLoading.hide(),Notification.error("Formato de arquivo não permitido! "+resp.status),$scope.anexoInvalido=!0})}})},$scope.validaServico=function(dynamicserviceForm){$scope.atualizaHtml(),$scope.isDisabled=!0,$log.debug(dynamicserviceForm);var arquivoAnexos=$scope.dataServiceFields.arquivoAnexos;$scope.dataServiceFields.arquivoAnexos=[];var tiposParametroServico=[];$.each($scope.dynamicServiceFields.listaParametros,function(index,value){tiposParametroServico[value.parametro]=value.tipoParam});var obs=$scope.dataServiceFields.obsVisivel;$scope.dataServiceFields.obsVisivel=null;var provaRevisao=$scope.dataServiceFields.revisaoProva;$scope.dataServiceFields.revisaoProva=null,detalheSolicitacoes=[],$.each($scope.dynamicServiceFields.listaParametros,function(index,value){var item={descrValor:value.parametro,parametroServico:value.parametro,servico:$scope.servicoPreencher.servico,valor:null};$.each($scope.escolhasDetalhes,function(indexD,valueD){index==indexD&&(item.valor=valueD)});var tipoParametroServico=tiposParametroServico[index];if(null!=tipoParametroServico&&"TIME"==tipoParametroServico){var parametroServicoDate=new Date(item.valor);item.valor=parametroServicoDate.toLocaleTimeString()}detalheSolicitacoes.push(item)});var itemSolicitacaoServicos={codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,arquivoAnexos:arquivoAnexos,codLanc:$scope.dynamicServiceFields.codLanc,codServico:$scope.servicoPreencher.servico,custoUnitario:$scope.dynamicServiceFields.custoUnitario,deferido:{},descricao:$scope.dynamicServiceFields.descricao,detalheSolicitacaos:detalheSolicitacoes,obs:obs,obsConfirmacao:$scope.dynamicServiceFields.obsConfirmacao,obsFinal:$scope.dynamicServiceFields.obsFinal,obsVisivel:!!$scope.dynamicServiceFields.obsVisivel,prazoEntrega:$scope.dynamicServiceFields.prazoEntrega,provaRevisao:provaRevisao,revisaoProva:$scope.dynamicServiceFields.revisaoProva},resp={servico:itemSolicitacaoServicos.codServico,descricao:itemSolicitacaoServicos.descricao,custoUnitario:itemSolicitacaoServicos.custoUnitario,tipo:$scope.dynamicServiceFields.tipoServico,quantidade:$scope.dynamicServiceFields.maxQtdeSolic?$scope.dynamicServiceFields.maxQtdeSolic:0,autorizacaoAceita:$scope.dynamicServiceFields.autorizacaoAceita?$scope.dynamicServiceFields.autorizacaoAceita.toString():"false",itemSolicitacaoServicos:itemSolicitacaoServicos,obsFinal:itemSolicitacaoServicos.obs};$scope.adicionaValidaItemSolicitacao(resp),$scope.modalPreencher.hide()},$scope.adicionaValidaItemSolicitacao=function(resp){var _docAutorizacao=$scope.dynamicServiceFields.docAutorizacao,solicitacaoServico=(resp.autorizacaoAceita,resp.itemSolicitacaoServicos.arquivoAnexos,resp.servico,resp.itemSolicitacaoServicos.obs,$scope.dynamicServiceFields.listaParametros,resp.itemSolicitacaoServicos.provaRevisao,resp.quantidade,resp.itemSolicitacaoServicos.codAluno,SessionData.aluno.list[SessionData.aluno.selecionado].codCurso,new Date,new Date,SessionData.aluno.list[SessionData.aluno.selecionado].nomeAluno,$scope.dynamicServiceFields.codigoLanc,resp.servico,resp.custoUnitario,resp.descricao,resp.itemSolicitacaoServicos.detalheSolicitacoes,$scope.dynamicServiceFields.exigeAutorizacao,SessionData.user.id,resp.itemSolicitacaoServicos.obs,resp.itemSolicitacaoServicos.obsVisivel,$scope.servicoPreencher.pagamentoPreExecucao,$scope.dynamicServiceFields.prazoEntrega,resp.itemSolicitacaoServicos.provaRevisao,resp.quantidade,$scope.dynamicServiceFields.revisaoProva,resp.valorTotal,SessionData.user.id,resp.quantidade,SessionData.aluno.list[SessionData.aluno.selecionado].nomeCurso,resp.itemSolicitacaoServicos.obs,SessionData.user.id,resp.valorTotal,{solicitacaoServico:{solicitacao:null,codAluno:resp.itemSolicitacaoServicos.codAluno,codDocente:null,codAtendimento:null,data:null,obs:resp.itemSolicitacaoServicos.obs,valorTotal:null,itemSolicitacaoServicos:[],infoAluno:null,codCurso:SessionData.aluno.list[SessionData.aluno.selecionado].codCurso,nomeCurso:null,usuario:SessionData.user.id,respFinan:null,dataVencimento:null,pessoaLogadaAOL:SessionData.user.id},codServico:resp.servico,quantidade:void 0===resp.quantidade||null==resp.quantidade||0==resp.quantidade?1:resp.quantidade,provaRevisao:resp.itemSolicitacaoServicos.provaRevisao,autorizacaoAceita:resp.autorizacaoAceita,termoAutorizacao:_docAutorizacao,observacao:resp.itemSolicitacaoServicos.obs,arquivoAnexos:resp.itemSolicitacaoServicos.arquivoAnexos,parametros:getParameterAndValues(resp.itemSolicitacaoServicos.detalheSolicitacaos)});$scope.validatedRequest&&$scope.validatedRequest&&$scope.validatedRequest.itemSolicitacaoServicoAnexos&&$scope.validatedRequest.itemSolicitacaoServicoAnexos.length>0&&(solicitacaoServico.idNaSessao=$scope.validatedRequest.itemSolicitacaoServicoAnexos[0].idNaSessao);var req={method:"POST",url:Configs.getApiServer()+"/pessoas/adiciona_valida_item_solicitacao/",headers:{"Content-Type":"application/json"},data:solicitacaoServico};$http(req).then(function(response){200==response.status&&($rootScope.$broadcast("validatedRequestItem",response.data),$rootScope.listaServicosAdicionados.push(resp),SessionData.carrinho=$rootScope.listaServicosAdicionados,$rootScope.totalValor=$rootScope.totalValor+resp.custoUnitario*resp.quantidade),$scope.isDisabled=!1},function(resp){$scope.isDisabled=!1})},$scope.$on("validatedRequestItem",function(event,data){if($scope.validatedRequest){var lastItem=data.itemSolicitacaoServicoAnexos.length-1;$scope.validatedRequest.itemSolicitacaoServicoAnexos.push(data.itemSolicitacaoServicoAnexos[lastItem])}else $scope.validatedRequest=data}),$scope.concluirSolicitacaoServico=function(){if($scope.validatedRequest){loading(!0);var requestParams={method:"POST",url:Configs.getApiServer()+"/pessoas/grava_solicitacao_e_obtem_protocolo",headers:{"Content-Type":"application/json"},data:$scope.validatedRequest};$http(requestParams).then(function(response){if(200==response.status){var requestParamsListRequiredServices={method:"POST",url:Configs.getApiServer()+"/pessoas/lista_servicos_solicitados_detalhe",headers:{"Content-Type":"application/json"},data:response.data};$rootScope.servSolicitadoDetail=response.data,$http(requestParamsListRequiredServices).then(function(result){loading(!1),$state.go("home.concluir-solicitacao-servico").then(function(){$rootScope.listaServicosAdicionados=[],$scope.validatedRequest.itemSolicitacaoServicoAnexos=[],SessionData.carrinho=[],$rootScope.$broadcast("validatedReceivetItem",result.data)},function(error){loading(!1)})})}else response.data&&response.data.mensagemDetalhada&&Notification.error(response.data.mensagemDetalhada),loading(!1)},function(resp){resp.status&&401!=resp.status&&500!=resp.status&&Notification.error("Erro ao carregar arquivo: "+resp.status),loading(!1)})}else Notification.error("Não foi possível validar a solicitação.")},$ionicModal.fromTemplateUrl("modal-solicitarServico",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalSolicitar=modal}),$ionicModal.fromTemplateUrl("modal-preencherServico",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalPreencher=modal}),Storage.get("codServico")&&$scope.avancarServico({servico:Storage.get("codServico")})}]),angular.module("custom.controllers").controller("AlunosResponsavelController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$location","serviceAlunos","appModalService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$location,serviceAlunos,appModalService){var vm=this;vm.id="AlunosResponsavelController",vm.loadFotosAlunos=function(alunos){if(!alunos)return;for(var i=0;i<alunos.length;i++)serviceAlunos.loadFotoAluno(alunos[i])},vm.selecionarAluno=function(aluno){serviceAlunos.selecionarAluno(aluno),$scope.alunosList.show=!1,$state.go($state.$current.self.name,{},{reload:$state.$current,inherity:!0,notify:!1}),vm.closeModal()},$scope.id=vm.id,$scope.exibirSubHeader=!0,vm.alunosResp=SessionData.alunosResponsavel.list,null!==vm.alunosResp&&vm.loadFotosAlunos(vm.alunosResp)}]),angular.module("custom.controllers").controller("FinanceiroController",["$log","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Financeiro.Boletos",function($log,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,FinanceiroBoletos){$log.debug("[FinanceiroController]\tvm_list=",this,"SessionData=",SessionData);var alunos=SessionData.aluno;this.aluno=alunos.list[alunos.selecionado]}]),angular.module("custom.controllers").controller("FrequenciaController",["$log","$http","$state","$timeout","$translate","Notification","SessionData",FrequenciaController]),angular.module("custom.controllers").controller("AtividadesController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum){switch($rootScope.view="home",$scope.exibeAbaCompl=SessionData.aluno.list[SessionData.aluno.selecionado].transacoes.find(element=>"historico-complementares"==element),$scope.exibeAbaComplTipo=SessionData.aluno.list[SessionData.aluno.selecionado].transacoes.find(element=>"historico-compl-tipo"==element),$scope.exibeAbaExtensao=SessionData.aluno.list[SessionData.aluno.selecionado].transacoes.find(element=>"historico-extensao"==element),$state.current.name){case"home.historico.home":$state.go("home.historico.home"),$rootScope.view="home";break;case"home.historico.atividades-complementares":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="atividades-complementares"})},500);break;case"home.historico.exigiveis-por-tipo":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="exigiveis-por-tipo"})},600);break;case"home.historico.atividades-extensao":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="atividades-extensao"})},500);break;default:$state.go("home.historico.home"),$rootScope.view="home"}}]),angular.module("custom.controllers").controller("AtividadesComplementaresController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","AtividadesComplementaresService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,AtividadesComplementaresService){function obterAtividades(aluno){AtividadesComplementaresService.obterAtividades(aluno).then(sucessoObterAtividades)}function sucessoObterAtividades(retorno){vm.atividade=retorno,AonlineUtils.showLoading(!1)}vm=this,vm.aluno=null,vm.atividade={listaAtividadesComplementares:[]},vm.obterAtividades=obterAtividades,vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],void obterAtividades(vm.aluno))}]),angular.module("custom.controllers").controller("AtividadesExtensaoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","AtividadesExtensaoService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,AtividadesExtensaoService){function obterAtividadesExtensao(aluno){AtividadesExtensaoService.obterAtividadesExtensao(aluno).then(sucessoObterAtividades)}function sucessoObterAtividades(retorno){vm.atividade=retorno,AonlineUtils.showLoading(!1)}vm=this,vm.aluno=null,vm.atividade={listaAtividadesExtensao:[]},vm.obterAtividadesExtensao=obterAtividadesExtensao,vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],void obterAtividadesExtensao(vm.aluno))}]),angular.module("custom.controllers").controller("FichaMedicaController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","FichaMedicaService","AonlineUtils",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,FichaMedicaService,AonlineUtils){var vm=this;function iniciar(){AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],obterFichaMedica(vm.aluno)}function cancelar(){vm.editarFicha=!1,vm.fichaMedicaAlterada={}}function obterFichaMedica(aluno){FichaMedicaService.obterFichaMedica(aluno.codAluno).then(sucessoObterFicha)}function avaliarCondicao(campo){return null!=campo&&""!=campo?"S":"N"}function sucessoObterFicha(result){AonlineUtils.showLoading(!1),vm.fichaMedica=result}function sucessoSalvarFicha(retorno){Notification.success($translate.instant("Aluno.View.FichaMedica.msg.alteracao")),cancelar(),iniciar()}vm.aluno=null,vm.editarFicha=!1,vm.fichaMedica={},vm.fichaMedicaAlterada={},vm.cancelar=cancelar,vm.editar=function(fichaMedica){vm.editarFicha=!0,vm.fichaMedicaAlterada=angular.copy(fichaMedica),fichaMedicaAlterada=vm.fichaMedicaAlterada,vm.fazUsoMedicamento="S"==fichaMedicaAlterada.usa_medicamento?"S":"N",vm.fazUsoAnalsegico=avaliarCondicao(fichaMedicaAlterada.analgesico),vm.fazTratamento=avaliarCondicao(fichaMedicaAlterada.tratamento),vm.possuiAlergia=avaliarCondicao(fichaMedicaAlterada.manifestacao_alergica),vm.possuiProblemasCronicos=avaliarCondicao(fichaMedicaAlterada.problemas_cronicos),vm.fichaMedicaAlterada.fator_rh_class_css="inpt",vm.fichaMedicaAlterada.tipo_sanguineo_class_css="inpt";var fichaMedicaAlterada},vm.obterFichaMedica=obterFichaMedica,vm.removerValores=function(...campos){campos.forEach(campo=>vm.fichaMedicaAlterada[campo]=null)},vm.salvar=function(fichaMedicaAtual,fichaMedicaAlterada){AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],fichaMedicaAlterada.pessoa=vm.aluno.id,FichaMedicaService.salvarFichaMedica(fichaMedicaAtual,fichaMedicaAlterada).then(sucessoSalvarFicha)},vm.iniciar=iniciar()}]),angular.module("custom.controllers").controller("AtividadesExigiveisPorTipoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","AtividadesComplementaresService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,AtividadesComplementaresService){function obterAtividades(aluno){AtividadesComplementaresService.obterAtividadesPorTipo(aluno).then(sucessoObterAtividades)}function sucessoObterAtividades(retorno){vm.listaAtividades=retorno,AonlineUtils.showLoading(!1)}vm=this,vm.aluno=null,vm.listaAtividades=[],vm.obterAtividades=obterAtividades,vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],void obterAtividades(vm.aluno))}]),angular.module("custom.controllers").controller("NotaFiscalController",["$log","$sce","FinanceiroService","AonlineUtils",function($log,$sce,FinanceiroService,AonlineUtils){var vm=this;AonlineUtils.showLoading(!0),FinanceiroService.listarNotasFiscaisEletronicas().then(result=>{vm.listaNotas=angular.copy(result);for(var i=0;i<vm.listaNotas.length;i++)"string"==typeof $sce.trustAsHtml(vm.listaNotas[i].LINK)&&(vm.listaNotas[i].LINK=$sce.trustAsHtml(vm.listaNotas[i].LINK));AonlineUtils.showLoading(!1)},err=>{$log.debug(err)}),vm.openLink=function(link){AonlineUtils.showLoading(!0),"string"==typeof $sce.trustAsHtml(link)?window.open($sce.trustAsHtml(link),"_blank"):window.open(link,"_blank"),AonlineUtils.showLoading(!1)},vm.downloadNota=function(idCobrancaNf){AonlineUtils.showLoading(!0),FinanceiroService.obterLinkNota(idCobrancaNf).then(rerult=>{window.open(rerult.link,"_blank"),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}}]),angular.module("custom.controllers").controller("CriteriosDeAvaliacaoController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","AonlineUtils","$stateParams","DisciplinasMatriculadasService",function($log,$http,$scope,$state,$timeout,$translate,Notification,SessionData,AonlineUtils,$stateParams,DisciplinasMatriculadasService){var vm=this;if($stateParams.dadosDisciplina){AonlineUtils.showLoading(!0),vm.dadosDisciplina=$stateParams.dadosDisciplina,console.log("dadosDisciplina:",vm.dadosDisciplina);var promise1=DisciplinasMatriculadasService.obterCriterioAvaliacao(vm.dadosDisciplina).then(result=>{vm.dadosAvaliacoes=result.sort(function(a,b){return a.ordem-b.ordem})},err=>{console.log(err)}),promise2=DisciplinasMatriculadasService.listarAvaliacoesDocente(vm.dadosDisciplina).then(result=>{vm.dadosFormulaCriterio=angular.copy(result[0])},err=>{console.log(err)});Promise.all([promise1,promise2]).then(()=>{AonlineUtils.showLoading(!1)}),vm.getWindowWidth=function(){return window.innerWidth}}else $state.go("home.disciplinas")}]),angular.module("custom.controllers").controller("IndiceRendimentoController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","$ionicLoading","AonlineUtils","AvaliaService",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,$ionicLoading,AonlineUtils,AvaliaService){var vm=this;AonlineUtils.showLoading(!0),AvaliaService.obterIndiceRendimento().then(response=>{vm.listaIndice=response,AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("TrabalhosController",["$log","$http","$scope","$rootScope","$state","$timeout","$translate","Notification","SessionData",TrabalhosController]),angular.module("custom.controllers").controller("TrabalhosSubmissaoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","SessionData","$log","TrabalhosService","AonlineUtils","Upload","$ionicModal","$location","$anchorScroll",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,SessionData,$log,TrabalhosService,AonlineUtils,Upload,$ionicModal,$location,$anchorScroll){$('[data-toggle="tooltip"]').tooltip();var vm=this;function iniciar(){var aluno;AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],vm.exibirBtnSalvar=!0,aluno=vm.aluno,TrabalhosService.obterTrabalhos(aluno).then(sucessoObterTrabalhosSubmissao,callbackErro),$ionicModal.fromTemplateUrl("./views/logged/novas-telas/aluno.trabalhos.submissao.modal.html",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!1}).then(function(modal){vm.modalEnviarArquivo=modal})}function fecharModal(){vm.modalEnviarArquivo.hide(),vm.exibirBtnSalvar=!0}function sucessoObterTrabalhosSubmissao(result){AonlineUtils.showLoading(!1),vm.listaTrabalhos=result}function sucessoUploadArquivo(result){vm.codArquivo=result.data.codArquivo,vm.exibirBtnSalvar=!1,AonlineUtils.showLoading(!1)}function sucessoIncluirTrabalho(result){iniciar(),Notification.success($translate.instant("trabalho.msg.salvar"))}function callbackErro(result){$log.debug(result),AonlineUtils.showLoading(!1)}vm.aluno=null,vm.listaTrabalhos=[],vm.codArquivo=null,vm.exibirBtnSalvar=null,vm.trabalhoSelecionado={},vm.currentPage=0,vm.pageSize=5,vm.changePage=function(sentido){AonlineUtils.showLoading(!0),$anchorScroll(),$location.hash("trabalho"),$timeout(()=>{AonlineUtils.showLoading(!1),vm.currentPage="-"!=sentido?vm.currentPage+1:vm.currentPage-1},500)},vm.numberOfPages=function(){return null!=vm.listaTrabalhos?Math.ceil(vm.listaTrabalhos.length/vm.pageSize):1},vm.numberPageFormart=function(sizeList,pageSize){let number=vm.listaTrabalhos.length/vm.pageSize;if(number%1!=0&&!isNaN(number%1))return parseInt(number);return number-1},vm.abrirModal=function(trabalho){vm.arquivoAnexo=null,vm.fileName=null,vm.exibirBtnSalvar=!0,vm.trabalhoSelecionado=trabalho,vm.modalEnviarArquivo.show()},vm.fecharModal=fecharModal,vm.uploadArquivo=function(file){AonlineUtils.showLoading(!0),vm.fileName=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){let base64Data=urls.split("base64,")[1];TrabalhosService.uploadArquivo(file,base64Data).then(sucessoUploadArquivo)}})},vm.incluirTrabalho=function(trabalho,codArquivo){AonlineUtils.showLoading(!0),TrabalhosService.incluirTrabalho(trabalho,codArquivo).then(sucessoIncluirTrabalho,callbackErro),fecharModal()},vm.downloadTrabalho=function(trabalho){AonlineUtils.showLoading(!0),TrabalhosService.downloadTrabalhoSubmissao(trabalho)},vm.iniciar=iniciar()}]),angular.module("custom.controllers").controller("TrabalhosHistoricoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","SessionData","TrabalhosService","AonlineUtils","$location","$anchorScroll",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,SessionData,TrabalhosService,AonlineUtils,$location,$anchorScroll){$('[data-toggle="tooltip"]').tooltip();var aluno,vm=this;function sucessoObterHistoricoTrabalhos(result){AonlineUtils.showLoading(!1),vm.listaTrabalhos=result}function callbackErro(result){$log.debug(result)}vm.aluno=null,vm.listaTrabalhos=[],vm.currentPage=0,vm.pageSize=5,vm.changePage=function(sentido){AonlineUtils.showLoading(!0),$anchorScroll(),$location.hash("trabalho"),$timeout(()=>{AonlineUtils.showLoading(!1),vm.currentPage="-"!=sentido?vm.currentPage+1:vm.currentPage-1},500)},vm.numberOfPages=function(){return null!=vm.listaTrabalhos?Math.ceil(vm.listaTrabalhos.length/vm.pageSize):1},vm.numberPageFormart=function(sizeList,pageSize){let number=vm.listaTrabalhos.length/vm.pageSize;if(number%1!=0&&!isNaN(number%1))return parseInt(number);return number-1},vm.downloadTrabalho=function(trabalho,aluno){AonlineUtils.showLoading(!0),TrabalhosService.downloadTrabalhoHistorico(trabalho,aluno)},vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],aluno=vm.aluno,void TrabalhosService.obterHistoricoTrabalhos(aluno).then(sucessoObterHistoricoTrabalhos,callbackErro))}]),angular.module("custom.controllers").controller("TrabalhosConclusaoController",["$log","$http","$scope","$rootScope","$state","$timeout","$translate","Notification","SessionData","AonlineUtils","PosTCCService","Storage",TrabalhosConclusaoController]),angular.module("custom.controllers").controller("TrabalhosConclusaoDadosController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","SessionData","$log","PosTCCService","AonlineUtils","Storage",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,SessionData,$log,PosTCCService,AonlineUtils,Storage){function sucessoObterTrabalho(result){vm.dadosTrabalho=result}function sucessoObterAreas(result){vm.listaAreas=result}function callbackErro(result){$log.debug(result)}vm=this,vm.aluno=null,vm.listaAreas=[],vm.dadosTrabalho={},$rootScope.possuiUrl=angular.fromJson(Storage.get("possuiUrl")),vm.listaAcordion=["infoProject","refBibl","atvFutura"],vm.clickAcordion=function(itemClicado){angular.forEach(vm.listaAcordion,function(item){item!==itemClicado&&$("#"+item).hasClass("in")&&($("#"+item).removeClass("in"),$("#id"+item).attr("aria-expanded","false"))})},vm.editarTrabalho=function(){$state.go("home.pos_tcc-editar")},vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],void function(aluno){let dados=PosTCCService.obterTrabalhoDeConclusao(aluno).then(sucessoObterTrabalho,callbackErro),areas=PosTCCService.obterAreasPesquisas(aluno).then(sucessoObterAreas,callbackErro);Promise.all([dados,areas]).then(()=>{AonlineUtils.showLoading(!1)})}(vm.aluno))}]),angular.module("custom.controllers").controller("TrabalhosConclusaoPatrocinadoresController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","SessionData","$log","AonlineUtils","PosTCCService","$anchorScroll","$location","Storage",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,SessionData,$log,AonlineUtils,PosTCCService,$anchorScroll,$location,Storage){var aluno;function sucessoObterPatrocinadores(result){vm.listaPatrocinadores=result,AonlineUtils.showLoading(!1)}function callbackErro(result){$log.debug(result)}vm=this,vm.aluno=null,vm.listaPatrocinadores=[],$rootScope.possuiUrl=angular.fromJson(Storage.get("possuiUrl")),vm.currentPage=0,vm.pageSize=5,vm.changePage=function(sentido){AonlineUtils.showLoading(!0),$anchorScroll(),$location.hash("patrocinador"),$timeout(()=>{AonlineUtils.showLoading(!1),vm.currentPage="-"!=sentido?vm.currentPage+1:vm.currentPage-1},500)},vm.numberOfPages=function(){return null!=vm.listaPatrocinadores?Math.ceil(vm.listaPatrocinadores.length/vm.pageSize):1},vm.numberPageFormart=function(sizeList,pageSize){let number=vm.listaPatrocinadores?vm.listaPatrocinadores.length/vm.pageSize:null;if(number%1!=0&&!isNaN(number%1))return parseInt(number);return number-1},vm.editarTrabalho=function(){$state.go("home.pos_tcc-editar")},vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],aluno=vm.aluno,void PosTCCService.obterPatrocinadores(aluno).then(sucessoObterPatrocinadores,callbackErro))}]),angular.module("custom.controllers").controller("TrabalhosConclusaoEnvioArquivosController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","AonlineUtils","PosTCCService","Storage","$stateParams",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,AonlineUtils,PosTCCService,Storage,$stateParams){var aluno;function sucessoObterArquivoTCC(result){vm.trabalhoAnexo=result,vm.trabalhoAnexo.arquivoDownload="data:"+result.tipo+";base64,"+result.arquivo,AonlineUtils.showLoading(!1)}function callbackErro(result){$log.debug(result),AonlineUtils.showLoading(!1)}vm=this,vm.aluno=null,vm.urlTcc=null,vm.trabalhoAnexo={},$rootScope.possuiUrl=angular.fromJson(Storage.get("possuiUrl")),vm.editarTrabalho=function(){$state.go("home.pos_tcc-editar")},vm.copiarLink=function(){if(!Clipboard.isSupported())return void Notification.warning($translate.instant("navegador.sem.suporte"));vm.clipboard=new Clipboard("#copy-button"),Notification.success($translate.instant("link.copiado"))},vm.iniciar=(vm.urlTcc=$stateParams.urlTcc||$rootScope.possuiUrl,AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],aluno=vm.aluno,void(vm.urlTcc?PosTCCService.obterTrabalhoDeConclusao(aluno).then(sucessoObterArquivoTCC,callbackErro):PosTCCService.obterArquivoTCC(aluno).then(sucessoObterArquivoTCC,callbackErro)))}]),angular.module("custom.controllers").controller("TrabalhosConclusaoEditarController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","AonlineUtils","PosTCCService","Upload",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,AonlineUtils,PosTCCService,Upload){var vm=this;vm.aluno=null,vm.step=null,vm.formInvalid=!1,vm.listaAreas=[],vm.patrocinador={},vm.arquivo={},vm.referenciaAtividadeFutura={},vm.dadosTrabalho={},vm.areas={};const listaOptionsDadosTrabalho=["divulg_autorizada","exige_nao_divulga","exige_contrato","outro"];function changeStep(step){vm.step=step;let domStep=".collapse_"+step;$(".collapse").collapse("hide"),$(domStep).collapse("toggle"),$(domStep).on("hide.bs.collapse",function(){vm.step=""})}function sucessoObterDadosTrabalho(result){vm.dadosTrabalho=function(opcoes,dados){for(opcao of opcoes)if("N"!==dados[opcao]){dados.opcaoSelecionada=opcoes.indexOf(opcao);break}return dados}(listaOptionsDadosTrabalho,result),null==vm.dadosTrabalho.area_igual&&(vm.dadosTrabalho.area_igual="N")}function sucessoObterUrlTcc(result){vm.possuiUrl=result.urltcc}function sucessoObterVinculos(result){vm.listaVinculosEmp=result,vm.dadosTrabalho=preencherValorCombos(vm.dadosTrabalho,"vinc_empregaticio",result)}function sucessoObterEmpresas(result){vm.listaEmpresas=result,vm.dadosTrabalho=preencherValorCombos(vm.dadosTrabalho,"tipo_empresa",result)}function sucessoObterExpectativaAtuacao(result){vm.listaExpectativaAtuacao=result,vm.dadosTrabalho=preencherValorCombos(vm.dadosTrabalho,"expec_atuacao",result)}function preencherValorCombos(trabalho,field,lista){return null==trabalho[field]&&lista.length>0&&(trabalho[field]=lista[0].descricao),trabalho}function sucessoObterAreasAluno(result){for(indice in result)if(!isNaN(indice)){let variavel="area"+(1+parseInt(indice));vm.areas[variavel]=result[parseInt(indice)].area_trab}}function sucessoObterAreas(result){vm.listaAreas=result}function alterarPatrocinador(lista,patrocinador,identificador){return lista=lista.map(function(patroc){return patroc[identificador]==patrocinador[identificador]?angular.copy(patrocinador):patroc})}function sucessoObterPatrocinadores(result){vm.listaPatrocinadores=result}function closeModalPatrocinadores(modal){modal.hide()}function sucessoObterArquivoTCC(result){result.arquivo&&(vm.arquivo.fileName=result.nome_arq,vm.arquivo.file={type:result.tipo,name:result.nome_arq},vm.arquivo.base64Data=result.arquivo,vm.arquivo.dataUpload=result.data,vm.arquivo.titulo=result.titulo)}function sucessoSalvar(){Notification.success($translate.instant("trabalho.msg.salvar")),AonlineUtils.showLoading(!1),$timeout(()=>{$state.go("home.pos_tcc")},1e3)}function callbackErro(result){$log.debug(result),AonlineUtils.showLoading(!1)}vm.changeStep=changeStep,vm.anterior=function(step){changeStep(step)},vm.proximo=function(invalido,step){if(invalido)return void(vm.formInvalid=!0);vm.formInvalid=!1,changeStep(step)},vm.adicionarPatrocinador=function(patrocinador){vm.listaPatrocinadores=patrocinador.chave?alterarPatrocinador(vm.listaPatrocinadores,patrocinador,"chave"):function(lista,patrocinador){patrocinador.novo=!0,patrocinador.chaveTemp?lista=alterarPatrocinador(lista,patrocinador,"chaveTemp"):(patrocinador.chaveTemp=(new Date).getTime(),patrocinador.aluno=angular.copy(vm.aluno.codAluno),lista.push(angular.copy(patrocinador)));return lista}(vm.listaPatrocinadores,patrocinador),vm.patrocinador={}},vm.editarPatrocinador=function(patrocinador){vm.patrocinador=angular.copy(patrocinador),vm.patrocinador.editado=!0},vm.excluirPatrocinador=function(lista,patrocinador,modal){patrocinador.chaveTemp?vm.listaPatrocinadores=lista.filter(function(patroc){return patroc.chaveTemp!=patrocinador.chaveTemp}):vm.listaPatrocinadores=lista.map(function(patroc){return patroc.chave==patrocinador.chave&&(patroc.excluir=!0),patroc});closeModalPatrocinadores(modal)},vm.filterPatrocinador=function(patrocinador){return void 0===patrocinador.excluir},vm.openModalPatrocinadores=function(modal,patrocinador){modal.show(),vm.patrocinadorExcluir=patrocinador},vm.closeModalPatrocinadores=closeModalPatrocinadores,vm.uploadArquivo=function(file){vm.arquivo.fileName=file.name,vm.arquivo.dataUpload=new Date,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){let base64Data=urls.split("base64,")[1];vm.arquivo.file=file,vm.arquivo.base64Data=base64Data,vm.arquivo.titulo=null}})},vm.concluirCadastro=function(invalido,dados,areas,patrocinadores,arquivo,aluno,etapa){if(invalido)return;AonlineUtils.showLoading(!0);let salvarArquivoPromise,tccPromise=function(dados,aluno){return dados.aluno=aluno.codAluno,PosTCCService.inserirAlterarTCC(dados)}(dados=function(opcoes,dados){for(opcao of opcoes)opcoes.indexOf(opcao)==dados.opcaoSelecionada?dados[opcao]="S":dados[opcao]="N";return dados}(listaOptionsDadosTrabalho,dados),aluno),areaPromise=function(areas,aluno){return areas.aluno=aluno.codAluno,PosTCCService.inserirAlterarAreasTCC(areas)}(areas,aluno),excluirPatrocinadorPromise=function(patrocinadores){let listaExclusao=patrocinadores.filter(function(p){return p.chave&&(p.excluir||p.editado)});return PosTCCService.excluirPatrocinador(listaExclusao)}(patrocinadores),salvarPatrocinadorPromise=function(patrocinadores){let listaInsercao=patrocinadores.filter(function(p){return!p.excluir&&(p.novo||p.editado)});return PosTCCService.inserirPatrocinador(listaInsercao)}(patrocinadores);vm.possuiUrl||(salvarArquivoPromise=function(aluno,arquivo){return PosTCCService.enviarArquivoTCC(aluno,arquivo.titulo,arquivo.file,arquivo.base64Data)}(aluno,arquivo));let listaPromises=[tccPromise,areaPromise,excluirPatrocinadorPromise,salvarPatrocinadorPromise];5==etapa&&listaPromises.push(salvarArquivoPromise);Promise.all(listaPromises).then(sucessoSalvar,callbackErro)},vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],vm.step="one",vm.possuiUrl=!0,void function(aluno){let promise1=function(aluno){return PosTCCService.urlTCC(aluno).then(sucessoObterUrlTcc,callbackErro)}(aluno),promise2=function(aluno){PosTCCService.obterTrabalhoDeConclusao(aluno).then(sucessoObterDadosTrabalho,callbackErro)}(aluno),promise3=PosTCCService.obterGrandesAreas().then(sucessoObterAreas,callbackErro),promise4=function(aluno){return PosTCCService.obterAreasPesquisas(aluno).then(sucessoObterAreasAluno,callbackErro)}(aluno),promise5=function(aluno){return PosTCCService.obterPatrocinadores(aluno).then(sucessoObterPatrocinadores,callbackErro)}(aluno),promise6=PosTCCService.obterTiposEmpresas().then(sucessoObterEmpresas,callbackErro),promise7=PosTCCService.obterExpectativaAtuacao().then(sucessoObterExpectativaAtuacao,callbackErro),promise8=PosTCCService.obterVinculoEmpregaticio().then(sucessoObterVinculos,callbackErro),promise9=function(aluno){return PosTCCService.obterArquivoTCC(aluno).then(sucessoObterArquivoTCC,callbackErro)}(aluno);Promise.all([promise1,promise2,promise3,promise4,promise5,promise6,promise7,promise8,promise9]).then(()=>{AonlineUtils.showLoading(!1),$ionicModal.fromTemplateUrl("modal-delete-patrocinador",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modalPatrocinadores=modal})},callbackErro)}(vm.aluno))}]),angular.module("custom.controllers").controller("TarefaListController",["$log","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","Aluno.Tarefas","uiCalendarConfig","$ionicLoading",function($log,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,Aluno_Tarefas,uiCalendarConfig,$ionicLoading){this.tarefas={},$log.debug("[TarefaListController]\tvm_list=",this,"SessionData=",SessionData);var alunos=SessionData.aluno;alunos.list[alunos.selecionado]}]),angular.module("custom.controllers").controller("CobrancaController",["$log","$http","$state","$timeout","$translate","Notification","SessionData",CobrancaController]),angular.module("custom.controllers").controller("AcordoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","AcordoFactory","$log","AcordoService","$ionicNavBarDelegate","$stateParams","AonlineUtils",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,AcordoFactory,$log,AcordoService,$ionicNavBarDelegate,$stateParams,AonlineUtils){var acordoCtrl=this;acordoCtrl.id="AcordoController",$scope.id=acordoCtrl.id,acordoCtrl.permiteRealizarAcordo=!1,acordoCtrl.permiteConsultarAcordo=!1,SessionData.aluno.list[SessionData.aluno.selecionado].transacoes.map(function(trancasao){switch(trancasao){case"acordo-realizaracordo":acordoCtrl.permiteRealizarAcordo=!0;break;case"acordo":acordoCtrl.permiteConsultarAcordo=!0}}),AonlineUtils.showLoading(!0),AcordoService.opcoesAcordoParaAluno().then(result=>{acordoCtrl.opcoesAcordo=result,AonlineUtils.showLoading(!1)}).catch(error=>{AonlineUtils.showLoading(!1)}),acordoCtrl.sessionData=SessionData,acordoCtrl.aluno=acordoCtrl.sessionData.aluno,acordoCtrl.responsavel="responsavel"===SessionData.perfil,acordoCtrl.getResource=function(abstractResource){return AcordoFactory.opcoesDoAcordo.usaPreAcordo?"Preacordo."+abstractResource:"Acordo."+abstractResource},acordoCtrl.verificarTitleTab=function(){return acordoCtrl.opcoesAcordo&&acordoCtrl.opcoesAcordo.usaPreAcordo?"Home.view.Pre.Acordo.consultar":"Home.view.Acordo.consultar"},acordoCtrl.verificarTitleTabNovo=function(){return acordoCtrl.opcoesAcordo&&acordoCtrl.opcoesAcordo.usaPreAcordo?"Home.view.Pre.Acordo.cadastrar":"Home.view.Acordo.cadastrar"}}]),angular.module("custom.controllers").controller("PagamentoCartaoController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","SessionData","CartaoService","$ionicNavBarDelegate",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,SessionData,CartaoService,$ionicNavBarDelegate){$ionicNavBarDelegate.title($translate.instant("Home.view.PgtoCartao"))}]),angular.module("custom.controllers").controller("PagamentoCartaoPagamentosController",["$log","$scope","$q","$ionicLoading","$translate","SessionData","CartaoService","$state","TypeEnum","$ionicNavBarDelegate",function($log,$scope,$q,$ionicLoading,$translate,SessionData,CartaoService,$state,TypeEnum,$ionicNavBarDelegate){let vm=this,user=SessionData.user,aluno=SessionData.aluno.list[0];$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),$ionicNavBarDelegate.showBackButton(!1),vm.cardHint={linkDescription:$translate.instant("Aluno.Cartao.Pagamentos.VerDetalhes"),tableDescription:$translate.instant("Aluno.Cartao.Pagamentos.VerDetalhes"),onClick:function(pagamento){$state.go("home.pgtocartao-consulta",{from:"pagamento",numPedido:pagamento.idPedidoPgto})}},vm.closeModal=function(){vm.modal.hide()},vm.pagamentos=[],vm.columnsPagamentos=[{name:"Aluno.Cartao.Pagamentos.Pedido",id:"idPedidoPgto",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard1.RespFinan",id:"titular",type:TypeEnum.STRING},{name:"Aluno.Cartao.Pagamentos.DataPedido",id:"dataInsercao",type:TypeEnum.STRING},{name:"Aluno.Cartao.Pagamentos.ValorTotal",id:"valorTotal",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Pagamentos.DataPgto",id:"dataProcessamento",type:TypeEnum.STRING}],CartaoService.listarPedidosPagamento(user,aluno).then(function(pagamentos){pagamentos.map(function(pagamento){let dataProcessamento=pagamento.dataProcessamento?pagamento.dataProcessamento.split("-")[0]:"",dataInsercao=pagamento.dataInsercao?pagamento.dataInsercao.split("-")[0]:"";""!=dataInsercao&&(dataInsercao=moment(dataInsercao.trim(),"DD/MM/YYYY").format("YYYY/MM")),vm.pagamentos.push({idPedidoPgto:pagamento.idPedidoPgto,titular:pagamento.titular,dataInsercao:dataInsercao,valorTotal:pagamento.valorTotal,dataProcessamento:dataProcessamento,situacaoFinal:pagamento.situacaoFinal,chargeBack:pagamento.chargeBack})}),$ionicLoading.hide()})}]),angular.module("custom.controllers").controller("PagamentoCartaoConsultaController",["$log","$scope","$state","$q","$ionicLoading","$ionicNavBarDelegate","TypeEnum","CartaoService","$stateParams","$ionicModal","$translate","$interval","SessionData",function($log,$scope,$state,$q,$ionicLoading,$ionicNavBarDelegate,TypeEnum,CartaoService,$stateParams,$ionicModal,$translate,$interval,SessionData){let vm=this,numPedido=$stateParams.numPedido,aluno=SessionData.aluno.list[0];if(vm.from=$stateParams.from,$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),$scope.$on("$ionicView.beforeEnter",function(event,viewData){viewData.enableBack=!0}),"ordem"==vm.from?$ionicNavBarDelegate.showBackButton(!1):$ionicNavBarDelegate.showBackButton(!0),$ionicModal.fromTemplateUrl("views/logged/cartao/aluno.pagamento.cartao.cobrancas.modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modal=modal}),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){vm.modal&&vm.modal.hide()}),vm.columnsCobrancas=[{name:"Aluno.Cartao.Wizard3.Descricao",id:"tipoCobranca",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.Cobranca",id:"cobranca",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.Aluno",id:"descricaoAluno",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.AnoMes",id:"anoMes",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.Vencimento",id:"dataDeVencimento",type:TypeEnum.DATE}],vm.columnsDadosPedido=[{name:"Aluno.Cartao.Wizard3.Numero",id:"idPedidoPgto",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.Data",id:"dataInsercao",type:TypeEnum.DATE},{name:"Aluno.Cartao.Wizard3.ValorTotal",id:"valorTotal",type:TypeEnum.CURRENCY}],vm.columnsDadosCartoes=[{name:"Aluno.Cartao.Wizard3.FinalCartao",id:"finalCartao",type:TypeEnum.CARD},{name:"Aluno.Cartao.Wizard3.Parcelas",id:"numeroParcelas",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.ValorPago",id:"valor",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard3.CodAutorizacao",id:"codAutorizacao",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.MotivoChargeBack",id:"motivoDevolucao",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.RelatorioChargeBack",id:"relatorio",type:TypeEnum.STRING}],vm.columnsSituacaoPagamento=[{name:"Aluno.Cartao.Wizard3.Situacao",id:"status",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.DataProcessamento",id:"dataProcessamento",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard3.NSU",id:"nsu",type:TypeEnum.STRING}],vm.cardHint={linkDescription:$translate.instant("Aluno.Cartao.Consulta.Detalhes"),tableDescription:$translate.instant("Aluno.Cartao.Consulta.Detalhes"),onClick:function(){vm.modal.show()}},vm.novoPagamento=function(){$state.go("home.pgtocartao")},vm.listarPagamentos=function(){$state.go("home.pgtocartao.pagamentos")},vm.downloadConsultaPagamento=function(){CartaoService.downloadConsultaPagamento(encodeURI(aluno.codAluno),numPedido)},vm.closeModal=function(){vm.modal.hide()},numPedido){let interval=null,recvPedido=function(){$q.all([CartaoService.listarStatusPedido(aluno.codAluno,numPedido),CartaoService.listarPedidosPagamentoCartao(aluno.codAluno,numPedido),CartaoService.listarCartoesPedido(aluno.codAluno,numPedido),CartaoService.listarCobrancasPedido(aluno.codAluno,numPedido)]).then(function(data){vm.cobrancas=[],vm.dadosPedido=[],vm.dadosCartoes=[],vm.situacaoPagamento=[],vm.statusPedido={status:data[0].status,texto:"Erro"==data[0].status?data[0].texto.split("<br />"):data[0].texto.split(".")},"Processando"!=vm.statusPedido.status&&interval&&$interval.cancel(interval);let listaPedidosPagamentoCartao=data[1];listaPedidosPagamentoCartao&&listaPedidosPagamentoCartao.map(function(pedido){vm.dadosPedido.push({idPedidoPgto:pedido.idPedidoPgto,dataInsercao:pedido.dataInsercao,titular:pedido.titular,valorTotal:pedido.valorTotal});let dataProcessamento=pedido.dataProcessamento?pedido.dataProcessamento.split("-"):[""];vm.situacaoPagamento.push({status:vm.statusPedido.status,dataProcessamento:dataProcessamento[0],nsu:pedido.nsu})});let listaCartoesPedido=data[2];listaCartoesPedido&&listaCartoesPedido.map(function(cartao){vm.dadosCartoes.push({bandeira:cartao.bandeira,finalCartao:cartao.finalCartao,numeroParcelas:cartao.numeroParcelas,valor:cartao.valor,codAutorizacao:cartao.codAutorizacao,chargeBack:cartao.chargeBack,motivoDevolucao:cartao.motivoDevolucao})});let cobrancas=data[3];cobrancas.map(function(cobran){vm.cobrancas.push({tipoCobranca:cobran.tipoCobranca,cobranca:cobran.cobranca,descricaoAluno:cobran.descricaoAluno,anoMes:cobran.ano+"/"+cobran.mes,dataDeVencimento:cobran.dataDeVencimento})}),vm.cardHint.description=cobrancas.length+" "+$translate.instant("Aluno.Cartao.Consulta.CobrancasSelecionadas"),$ionicLoading.hide()})};recvPedido(),interval=$interval(recvPedido,5e3)}else $ionicLoading.hide();vm.getWindowWidth=function(){return window.innerWidth},vm.print=function(){let printContents=document.getElementById("ionPageConsulta").innerHTML,headContents=document.head.innerHTML,popupWin=window.open("","_blank","width=300,height=300");popupWin.document.open(),popupWin.document.write("<html><head>"+headContents+'</head><body onload="window.print()">'+printContents+"</body></html>"),popupWin.document.close()}}]),angular.module("custom.controllers").controller("PagamentoCartaoListarController",["$log","$scope","$state","$ionicLoading","$ionicScrollDelegate","$q","SessionData","CartaoService","TypeEnum","PagamentoCartaoFactory","$timeout",function($log,$scope,$state,$ionicLoading,$ionicScrollDelegate,$q,SessionData,CartaoService,TypeEnum,PagamentoCartaoFactory,$timeout){let vm=this,aluno=SessionData.aluno.list[0];function showLoading(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})}function adjustScroll(){let scrollInstance=$ionicScrollDelegate._instances.filter(function(inst){if("listarContent"==inst.$element[0].id)return inst});scrollInstance.length>0&&scrollInstance[0].resize()}showLoading(),vm.alunos=[],CartaoService.listarCobrancasParaPagamento(aluno).then(function(cobrancas){if(cobrancas&&cobrancas.length>0){for(let i=0;i<cobrancas.length;i++)cobrancas[i].checked=!1,cobrancas[i].codNomeAluno=cobrancas[i].aluno+" - "+cobrancas[i].nome_compl,cobrancas[i].data_de_vencimento=new Date(cobrancas[i].data_de_vencimento),cobrancas[i].data_de_faturamento=new Date(cobrancas[i].data_de_faturamento),cobrancas[i].data_de_geracao=new Date(cobrancas[i].data_de_geracao),0==i?vm.alunos.push({aluno:cobrancas[0].aluno,cobrancas:[cobrancas[i]]}):vm.alunos[0].cobrancas.push(cobrancas[i]);if($scope.mapaExtrato={},null!==vm.alunos[0].cobrancas&&void 0!==vm.alunos[0].cobrancas){for(var i=0;i<vm.alunos[0].cobrancas.length;i++)null==$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo]?($scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo]=[],$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo].push(vm.alunos[0].cobrancas[i])):$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo].push(vm.alunos[0].cobrancas[i]);$scope.tamanhoMapa=Object.keys($scope.mapaExtrato).length,vm.alunos[0].mapaExtrato=angular.copy($scope.mapaExtrato)}$ionicLoading.hide()}else $ionicLoading.hide()}),vm.btNext=function(){showLoading();let cobrancas=vm.getCobrancasSelecionadas();cobrancas.length>0?(PagamentoCartaoFactory.setCobrancasSelecionadas(cobrancas),CartaoService.calculaValoresTotaisPagamento(cobrancas).then(function(calculos){$ionicLoading.hide(),calculos.calculoValores.encargoBolsa=calculos.calculoValores.encargoBolsaCalculado,calculos.calculoValores.valorDocumento=calculos.calculoValores.valorFinalAcordo,PagamentoCartaoFactory.setCalculos(calculos),$state.go("home.pgtocartao-pagamento")},function(error){$ionicLoading.hide()})):(Notification.error("Erro ao processar cobranças selecionadas. Tente novamente."),$ionicLoading.hide())},vm.updateCobranca=function(cobranca){cobranca&&(cobranca.checked=!cobranca.checked,vm.refreshResumo())},vm.columns=[{name:"Aluno.Cartao.Wizard1.Descricao",id:"descricaoCobranca",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard1.RespFinan",id:"titular",type:TypeEnum.STRING},{name:"Admin.view.nomeAluno",id:"codNomeAluno",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard1.AnoMes",id:"anoMes",type:TypeEnum.STRING},{name:"Aluno.Cartao.Wizard1.Vencimento",id:"data_de_vencimento",type:TypeEnum.DATE},{name:"Aluno.Cartao.Wizard1.Valor",id:"valor_diferenca",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Situacao",id:"status_pagamento",type:TypeEnum.STRING}],vm.columnsResumo=[{name:"Aluno.Cartao.Wizard1.ValorSelecionado",id:"valorSelecionado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Encargo",id:"encargoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.EncargoBolsa",id:"encargoBolsaCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Desconto",id:"descontoAdiantamentoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.ValorTotal",id:"valorFinalAcordo",type:TypeEnum.CURRENCY}],vm.itensResumo=[],$scope.$on("CardCreditSelection2",function(event,data){showLoading();let cobrancas=vm.getCobrancasSelecionadas();cobrancas.length>0?CartaoService.calculaValoresTotaisPagamento(cobrancas).then(function(calculos){calculos.calculoValores&&(vm.resumoPagamento=calculos.calculoValores,PagamentoCartaoFactory.setCalculos(calculos)),$ionicLoading.hide(),adjustScroll()},function(){console.log(event)}):($ionicLoading.hide(),adjustScroll())}),vm.getCalculatedValues=function(column){if(vm.resumoPagamento)return function(input=0){return parseFloat(input).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}(vm.resumoPagamento[column.id])},vm.refreshResumo=function(){showLoading();let cobrancas=vm.getCobrancasSelecionadas();cobrancas.length>0?CartaoService.calculaValoresTotaisPagamento(cobrancas).then(function(calculos){calculos.calculoValores&&(vm.itensResumo=[calculos.calculoValores],PagamentoCartaoFactory.setCalculos(calculos)),$ionicLoading.hide(),adjustScroll()}):(vm.itensResumo=[],$ionicLoading.hide(),adjustScroll())},vm.getWindowWidth=function(){return $(window).width()},vm.getCobrancasSelecionadas=function(){let cobrancas=[];for(let i=0;i<vm.alunos.length;i++)Object.values(vm.alunos[i].mapaExtrato).forEach(function(tipoCobranca){for(let j=0;j<tipoCobranca.length;j++)tipoCobranca[j].checked&&cobrancas.push({cobranca:tipoCobranca[j].cobranca,valorDiferenca:tipoCobranca[j].valor_diferenca,descricaoCobranca:tipoCobranca[j].descricaoCobranca,codResponsavelFinanceiro:tipoCobranca[j].resp,codAluno:tipoCobranca[j].aluno,num_cobranca:tipoCobranca[j].num_cobranca})});return cobrancas}}]),angular.module("custom.controllers").controller("PagamentoCartaoOrdemController",["$log","$scope","SessionData","$q","$ionicScrollDelegate","$state","$ionicLoading","TypeEnum","CartaoService","AlunoCadastroService","UtilService","Notification","$translate","PagamentoCartaoFactory","Storage","$ionicModal",function($log,$scope,SessionData,$q,$ionicScrollDelegate,$state,$ionicLoading,TypeEnum,CartaoService,AlunoCadastroService,UtilService,Notification,$translate,PagamentoCartaoFactory,Storage,$ionicModal){let listaFormaPagamentoProm,listaBandeirasCartaoProm,vm=this,user=SessionData.user,aluno=SessionData.aluno.list[SessionData.aluno.selecionado],cobrancas=PagamentoCartaoFactory.getCobrancasSelecionadas(),calculos=PagamentoCartaoFactory.getCalculos();if(vm.eventPgto=!1,angular.element('a[data-toggle="tooltip"]').tooltip({animated:"fade",placement:"bottom",html:!0}),$scope.showFormEnd=!1,Storage.get("paramsPgto")){let paramsPgto=JSON.parse(Storage.get("paramsPgto"));cobrancas=paramsPgto[0],(calculos=paramsPgto[1]).calculoValores.encargoBolsa=calculos.calculoValores.encargoBolsaCalculado,calculos.calculoValores.valorDocumento=calculos.calculoValores.valorFinalAcordo}if(!cobrancas&&!calculos)return void $state.go("home.pgtocartao.cobrancas");function showLoading(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})}function _listarCartoesSalvos(){let respCastoes=CartaoService.listarCartoesSalvos(user.id),respAutorizacoes=CartaoService.listarAutorizacoesDebito({aluno:aluno.codAluno});$q.all([respCastoes,respAutorizacoes]).then(result=>{vm.listaCartoes=angular.copy(result[0]),vm.listaAutorizacoesDeDebito=angular.copy(result[1]),$ionicLoading.hide()}).catch(err=>{$ionicLoading.hide()})}vm.exibirListaItens=!0,PagamentoCartaoFactory.setCalculos(null),showLoading(),vm.getWindowWidth=function(){return window.innerWidth},$("#docPortadorCartao").keydown(function(){try{$("#docPortadorCartao").unmask()}catch(e){console.log("Escolhendo,cpf ou cpnj")}$("#docPortadorCartao").val().length<11?$("#docPortadorCartao").mask("999.999.999-99"):$("#docPortadorCartao").mask("99.999.999/9999-99");var elem=this;setTimeout(function(){elem.selectionStart=elem.selectionEnd=1e4},0);var currentValue=$(this).val();$(this).val(""),$(this).val(currentValue)}),vm.flagPagarComCartaoSalvo=!1,$ionicModal.fromTemplateUrl("views/logged/cartao/modal.gestao.cartoes.view.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalCartoesSalvos){vm.modalCartoesSalvos=modalCartoesSalvos}),vm.openModalCartoesSalvos=function(){vm.isCartoesSalvos=!0,vm.showBackButton=!1,vm.modalCartoesSalvos.show(),vm.listaCartoes||(showLoading(),_listarCartoesSalvos())},$ionicModal.fromTemplateUrl("views/logged/cartao/modal.confrma.cancela.cartoes.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalConfirmaCancelaCartoes){vm.modalConfirmaCancelaCartoes=modalConfirmaCancelaCartoes}),vm.removerCartao=function(item,confirmado){if(!confirmado){if(vm.listaAutorizacoesDeDebito&&(vm.autorizacaoParaCancelar=vm.listaAutorizacoesDeDebito.filter(a=>a.id_cartao_salvo===item.id&&"S"===a.ativo)),vm.autorizacaoParaCancelar.length>0)return vm.autorizacaoParaCancelar=vm.autorizacaoParaCancelar[0],vm.cartaoParaCancelar=item,vm.modalConfirmaCancelaCartoes.show(),0;vm.autorizacaoParaCancelar=null}showLoading();let params={idCartao:item.id},reqs=[CartaoService.desativarCartao(params)];confirmado&&vm.autorizacaoParaCancelar&&reqs.push(CartaoService.desativarAutorizacao(vm.autorizacaoParaCancelar.id)),$q.all(reqs).then(result=>{Notification.info(result[0].conteudo),_listarCartoesSalvos(),vm.modalConfirmaCancelaCartoes.hide(),vm.modalCartoesSalvos.hide()}).catch(err=>{$ionicLoading.hide()})},vm.closeModalCartoes=function(){vm.isCartoesSalvos=!1,vm.isGestaoAlteracao=!1,vm.modalCartoesSalvos.hide()},vm.selecionarCartao=function(item){item.cartaoSalvoSelected?(vm.flagPagarComCartaoSalvo=!0,angular.element("#divNumeroCartao").hide(),angular.element("#divNomePortador").hide(),angular.element("#divDataValidade").hide(),angular.element("#divCPF").hide(),angular.element("#divMesValidade").hide(),angular.element("#divSalvarCartao").hide(),angular.element("#pagarNovoCartao").hide(),vm.validarExibicaoDebAutomatico(),vm.validarExibicaoPagamentoRecorrente(!1)):(angular.element("#divNumeroCartao").show(),angular.element("#divNomePortador").show(),angular.element("#divCPF").show(),angular.element("#divDataValidade").show(),angular.element("#divMesValidade").show(),angular.element("#divSalvarCartao").show(),angular.element("#pagarNovoCartao").show(),vm.flagPagarComCartaoSalvo=!1,vm.validarExibicaoDebAutomatico(),vm.validarExibicaoPagamentoRecorrente(!0)),$ionicScrollDelegate.resize()},vm.setAnoCartao=function(anoCartao){$scope.anoSelected=anoCartao},vm.setMesCartao=function(mesCartao){$scope.mesSelected=mesCartao},$scope.numeroCartao={number:"",type:{},mask:""},$scope.maskOptions={allowInvalidValue:!0},$scope.$watch("numeroCartao.number",function(newNumber){$scope.numeroCartao.type=function(creditCardNumber){var result="outros";/^3[47]/.test(creditCardNumber)?result="amex":/^3(?:0[0-5]|[68][0-9])[0-9]{11}/.test(creditCardNumber)&&(result="diners");return result}(newNumber),$scope.numeroCartao.mask={amex:"9999 999999 99999",diners:"9999 9999 9999 99",outros:"9999 9999 9999 9999"}[$scope.numeroCartao.type]}),$scope.limparCodigoSeguranca=function(){this.codigoSeguranca=this.cardForm.codigoSeguranca.$viewValue?this.cardForm.codigoSeguranca.$viewValue.replace(/[^\d]+/,""):null},$scope.alphaOnly=function(event){angular.element(event)[0].value=angular.element(event)[0].value.replace(/  +/g," ").trim()},vm.namePattern=/^[a-zA-Z]+\s[a-zA-Z ]+$/,$scope.btPagar=function(){if(showLoading(),vm.eventPgto=!0,vm.flagPagarComCartaoSalvo&&this.cardForm.codigoSeguranca.$invalid&&(angular.forEach(this.cardForm.$error,function(field){angular.forEach(field,function(errorField){errorField.$setTouched()})}),$ionicLoading.hide(),$ionicScrollDelegate.resize()),"S"===vm.configCartao.verificaFraude&&this.addressForm.$invalid)return Notification.error("Dados da fatura incompletos. Corrija seu cadastro ou informe novos dados."),angular.forEach(this.addressForm.$error,function(field){angular.forEach(field,function(errorField){errorField.$setTouched()})}),$ionicLoading.hide(),void(vm.eventPgto=!1);let pagamento;if(this.cardForm.$valid){let dadosPagamentoRecorrente;pagamento=calculos?{codPessoaLogada:parseInt(user.id),parcelas:this.formaPagamentoSelected.VALOR,nomePortador:this.nomePortador?this.nomePortador.toUpperCase():"",numCartao:this.numeroCartao.number?this.numeroCartao.number:this.cartaoSalvoSelected.final_cartao,mesValidadeCartao:vm.flagPagarComCartaoSalvo?null:this.mesSelected.valor,anoValidadeCartao:vm.flagPagarComCartaoSalvo?null:this.anoSelected.descricao.toString(),cvc2:this.codigoSeguranca,salvarCartao:vm.salvarCartao,docPortadorCartao:this.docPortadorCartao,deviceFingerPrint:vm.sessionId,origem:calculos.origem,dataCalculoValor:calculos.dataCalculoValor,valorDocumento:calculos.valorDocumento,itensCobrancaTD:cobrancas.map(function(cob){return{cobranca:cob.cobranca,descricao:cob.descricaoCobranca,valorCobrancaAPagar:cob.valorDiferenca}}),pais:$scope.alunoEndereco.end_pais,cep:$scope.alunoEndereco.cep,endereco:$scope.alunoEndereco.endereco,enderecoNumero:$scope.alunoEndereco.end_num,complemento:$scope.alunoEndereco.end_compl,cidade:$scope.alunoEndereco.nome_end_municipio,estado:$scope.alunoEndereco.uf_municipio_end,bairro:$scope.alunoEndereco.obj_bairro?$scope.alunoEndereco.obj_bairro.nome:"",telefone:$scope.alunoEndereco.telefonePayment,email:$scope.alunoEndereco.resp_email,token:this.cartaoSalvoSelected?this.cartaoSalvoSelected.token:null,autorizaDebAutMensalidade:vm.recorrencia}:{codPessoaLogada:parseInt(user.id),parcelas:this.formaPagamentoSelected.VALOR,nomePortador:this.nomePortador,numCartao:this.numeroCartao.number?this.numeroCartao.number:this.cartaoSalvoSelected.final_cartao,mesValidadeCartao:vm.flagPagarComCartaoSalvo?null:this.mesSelected.valor,anoValidadeCartao:vm.flagPagarComCartaoSalvo?null:this.anoSelected.descricao.toString(),cvc2:this.codigoSeguranca,docPortadorCartao:this.docPortadorCartao,salvarCartao:vm.salvarCartao,origem:cobrancas.origem,deviceFingerPrint:vm.sessionId,dataCalculoValor:cobrancas.dataCalculoValor,valorDocumento:cobrancas.valorDocumento,itensCobrancaTD:cobrancas.cartaoItensCobrancas.map(function(cob){return{cobranca:cob.cobranca,descricao:cob.descricaoCobranca,valorCobrancaAPagar:cob.valorDiferenca}}),pais:$scope.alunoEndereco.end_pais,cep:$scope.alunoEndereco.cep,endereco:$scope.alunoEndereco.endereco,enderecoNumero:$scope.alunoEndereco.end_num,complemento:$scope.alunoEndereco.end_compl,cidade:$scope.alunoEndereco.nome_end_municipio,estado:$scope.alunoEndereco.uf_municipio_end,bairro:$scope.alunoEndereco.obj_bairro?$scope.alunoEndereco.obj_bairro.nome:"",telefone:$scope.alunoEndereco.telefonePayment,email:$scope.alunoEndereco.resp_email,token:this.cartaoSalvoSelected?this.cartaoSalvoSelected.token:null,autorizaDebAutMensalidade:vm.recorrencia},vm.permitePagamentoRecorrente&&(dadosPagamentoRecorrente={aluno:cobrancas[0].codAluno,responsavel:cobrancas[0].codResponsavelFinanceiro,numCartao:this.numeroCartao.number?this.numeroCartao.number:this.cartaoSalvoSelected.final_cartao,nomeCartao:this.nomePortador,cvv:this.codigoSeguranca,mesValidadeCartao:this.mesSelected.valor,anoValidadeCartao:this.anoSelected.descricao.toString(),email:$scope.alunoEndereco.resp_email,rua:$scope.alunoEndereco.endereco,numeroEndereco:$scope.alunoEndereco.end_num,cep:$scope.alunoEndereco.cep,bairro:$scope.alunoEndereco.obj_bairro?$scope.alunoEndereco.obj_bairro.nome:"",cidade:$scope.alunoEndereco.nome_end_municipio,estado:$scope.alunoEndereco.uf_municipio_end,complemento:$scope.alunoEndereco.end_compl,pais:$scope.alunoEndereco.end_pais,docPortadorCartao:this.docPortadorCartao,telefone:$scope.alunoEndereco.telefonePayment}),CartaoService.pagarComCartaoCredito(pagamento).then(function(pedidoGerado){vm.eventPgto=!1,pedidoGerado.sucesso?(PagamentoCartaoFactory.clearCobrancasSelecionadas(),PagamentoCartaoFactory.setPedidoGerado(pedidoGerado),$state.go("home.pgtocartao-consulta",{from:"ordem",numPedido:pedidoGerado.idPedidoPgtoGerado})):Notification.error(pedidoGerado.msgErro)}).catch(function(){Notification.error($translate.instant("General.ErrorNotSpecified")),vm.eventPgto=!1}).finally(function(){$ionicLoading.hide(),vm.eventPgto=!1})}else angular.forEach(this.cardForm.$error,function(field){angular.forEach(field,function(errorField){errorField.$setTouched()})}),$ionicLoading.hide(),$ionicScrollDelegate.resize()},null!=calculos&&null!=calculos?angular.isArray(calculos.calculoValores)?vm.itensResumo=calculos.calculoValores:vm.itensResumo=[calculos.calculoValores]:vm.itensResumo=[cobrancas],vm.columnsResumo=[{name:"Aluno.Cartao.Wizard1.ValorSelecionado",id:"valorSelecionado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Encargo",id:"encargoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.EncargoBolsa",id:"encargoBolsa",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Desconto",id:"descontoAdiantamentoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.ValorTotal",id:"valorDocumento",type:TypeEnum.CURRENCY}],calculos?(calculos.cobrancasConcatenadas=calculos.cobrancasSelecionadasConcatenadas,listaFormaPagamentoProm=CartaoService.listarFormaPagamento(calculos),listaBandeirasCartaoProm=CartaoService.listarBandeirasCartao(cobrancas)):(listaFormaPagamentoProm=CartaoService.listarFormaPagamento(cobrancas),listaBandeirasCartaoProm=CartaoService.listarBandeirasCartao(cobrancas.cartaoItensCobrancas));let listaMesesCartaoProm=CartaoService.listarMesesCartao(),listaAnosCartaoProm=CartaoService.listarAnosCartao(),listaCartoesSalvos=CartaoService.listarCartoesSalvos(user.id),configCartaoProm=CartaoService.obterConfiguracoesCartao(aluno.codAluno),listaAutorizacoesDeDebitoProm=CartaoService.listarAutorizacoesDebito({aluno:aluno.codAluno});function removeAcento(text){return text?text=(text=(text=(text=(text=(text=(text=text.toLowerCase()).replace(new RegExp("[ÁÀÂÃ]","gi"),"a")).replace(new RegExp("[ÉÈÊ]","gi"),"e")).replace(new RegExp("[ÍÌÎ]","gi"),"i")).replace(new RegExp("[ÓÒÔÕ]","gi"),"o")).replace(new RegExp("[ÚÙÛ]","gi"),"u")).replace(new RegExp("[Ç]","gi"),"c"):""}function preencherCamposEndereco(){$scope.alunoEndereco.endereco=$scope.endereco.txbLogradouro,$scope.alunoEndereco.end_num=$scope.endereco.txbNumero,$scope.alunoEndereco.end_compl=$scope.endereco.txbComplemento,$scope.alunoEndereco.bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.alunoEndereco.end_municipio=$scope.endereco.srbCidade,$scope.alunoEndereco.nome_end_municipio=$scope.endereco.nomeMunicipio,$scope.alunoEndereco.uf_municipio_end=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_RES=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_RES=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_RES=$scope.listaBairros,$scope.loadCodigoBairro(),$scope.loadCodigoCidade()}$q.all([listaFormaPagamentoProm,listaBandeirasCartaoProm,listaMesesCartaoProm,listaAnosCartaoProm,listaCartoesSalvos,configCartaoProm,listaAutorizacoesDeDebitoProm]).then(function(result){vm.listaFormaPagamento=result[0],$scope.formaPagamentoSelected=vm.listaFormaPagamento[0],vm.listaBandeirasCartao=result[1],$scope.bandeiraSelected=vm.listaBandeirasCartao[0],vm.listaMesesCartao=result[2],$scope.mesSelected=vm.listaMesesCartao[0],vm.listaAnosCartao=result[3],$scope.anoSelected=vm.listaAnosCartao[0],vm.listaCartoes=result[4],vm.configCartao=result[5],vm.listaAutorizacoesDeDebito=result[6],$scope.configuracaoCartao={ehProducao:"S"===vm.configCartao.ehProducao,nomeConfig:vm.configCartao.nomeConfig,permiteSalvarCartao:"S"===vm.configCartao.permiteSalvarCartao,permiteDebAutMensalidade:"S"==vm.configCartao.permiteDebAutMensalidade,textoDebAutMensalidade:vm.configCartao.textoDebAutMensalidade,requerEmail:"S"===vm.configCartao.requerEmail,requerTelefone:"S"===vm.configCartao.requerTelefone,verificaFraude:"S"===vm.configCartao.verificaFraude,permiteRecorrencia:"S"===vm.configCartao.permiteRecorrencia,textoRecorrencia:vm.configCartao.textoRecorrencia,cobrancaMensalidadePagRec:"S"===vm.configCartao.cobrancaMensalidadePagRec},vm.orgId="S"===vm.configCartao.ehProducao?"k8vif92e":"1snn5n9w",vm.sessionId="U"+user.id+"S"+(new Date).getTime(),vm.validarExibicaoPagamentoRecorrente(!0),$ionicLoading.hide()}),vm.validarExibicaoDebAutomatico=function(){vm.flagPagarComCartaoSalvo&&$scope.configuracaoCartao.permiteDebAutMensalidade?vm.exibeDebAutorizacao=!0:vm.salvarCartao&&$scope.configuracaoCartao.permiteDebAutMensalidade?vm.exibeDebAutorizacao=!0:vm.exibeDebAutorizacao=!1},vm.validarExibicaoPagamentoRecorrente=function(exibe){$scope.configuracaoCartao.cobrancaMensalidadePagRec&&(null==cobrancas.cartaoItensCobrancas||null==cobrancas.cartaoItensCobrancas?cobrancas.map(function(cob){0!==cob.num_cobranca&&1!==cob.num_cobranca&&vm.exibeRecorrenteMensagem&&(vm.exibeRecorrenteMensagem=!1)}):cobrancas.cartaoItensCobrancas.map(function(cob){0!==cob.numCobranca&&1!==cob.numCobranca&&vm.exibeRecorrenteMensagem&&(vm.exibeRecorrenteMensagem=!1)})),vm.exibePagamentoRecorrente=!1,$scope.configuracaoCartao.permiteRecorrencia&&exibe?vm.exibePagamentoRecorrente=!0:angular.element("#check-recorrente")[0].checked=!1},$scope.alunoEndereco={},$scope.habilitaInputBairro=!0,vm.usarEnderecoAluno=function(){showLoading(),setTimeout(function(){$scope.$apply(function(){$scope.showFormEnd=!0})},200),$scope.limparCamposEndereco(),$scope.validarBrasil(),$scope.obterDadosAluno()},vm.informarNovoEndereco=function(){showLoading(),$scope.alunoEndereco.cep="",$scope.alunoEndereco.end_pais="BRASIL",setTimeout(function(){$scope.$apply(function(){$scope.showFormEnd=!0})},200),$scope.validarBrasil(),$scope.limparCamposEndereco(),$scope.carregarCombosEnderecoResidencial()},$scope.obterDadosAluno=function(){let codRespFinan=Array.isArray(cobrancas)?cobrancas[0].codResponsavelFinanceiro:cobrancas.codResponsavelFinanceiro;codRespFinan?AlunoCadastroService.obterDadosRespFinan(codRespFinan).then(function(result){$scope.alunoEndereco=result,$scope.alunoEndereco.ddd_fone&&$scope.alunoEndereco.fone&&!isNaN($scope.alunoEndereco.ddd_fone)&&!isNaN($scope.alunoEndereco.fone)?$scope.alunoEndereco.telefonePayment=$scope.alunoEndereco.ddd_fone.concat($scope.alunoEndereco.fone):$scope.alunoEndereco.telefonePayment=null,vm.configCartao.requerTelefone||($scope.alunoEndereco.telefonePayment=null),$scope.carregarCombosEnderecoResidencial(),$ionicLoading.hide()}).catch(function(err){$ionicLoading.hide(),$log.debug(err)}):$ionicLoading.hide()},$scope.carregarCombosEnderecoResidencial=function(){UtilService.obterPais().then(function(result){$scope.paises=result,$ionicLoading.hide()}).catch(function(err){$ionicLoading.hide()}),$scope.loadEstados(),$scope.loadMunicipios()},$scope.loadEstados=function(){if($scope.validarBrasil())angular.element("#cepRes").mask("00000-000"),$scope.LISTA_ESTADOS_END_RES=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_END_RES=result}).catch(function(err){$ionicLoading.hide(),$log.debug(err)});else if($scope.alunoEndereco.end_pais&&""!==$scope.alunoEndereco.end_pais){angular.element("#cepRes").mask("000000000000");var codPais=$scope.getCodigoPais($scope.alunoEndereco.end_pais);UtilService.obterEstadosEstrangeiros(codPais).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}$scope.LISTA_ESTADOS_END_RES.dados=dados}).catch(function(err){$ionicLoading.hide(),$log.debug(err)})}},$scope.loadMunicipios=function(){if(showLoading(),$scope.validarBrasil()){var selUF=null!=$scope.alunoEndereco.uf_municipio_end?$scope.alunoEndereco.uf_municipio_end:null,filtro={codMunicipio:null,nome:null,cep:null,uf:selUF};if(null==selUF||""===selUF)return $scope.LISTA_MUNICIPIOS_END_RES=[],void $ionicLoading.hide();UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_RES=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome.toUpperCase()};$scope.LISTA_MUNICIPIOS_END_RES.push(municipio)}$scope.loadBairros()}).catch(function(err){$ionicLoading.hide(),$log.debug(err)})}else if($scope.alunoEndereco.uf_municipio_end&&$scope.alunoEndereco.end_pais&&""!==$scope.alunoEndereco.end_pais&&""!==$scope.alunoEndereco.uf_municipio_end){var municipio={codMunicipioEstrangeiro:null,nome:null,pais:$scope.getCodigoPais($scope.alunoEndereco.end_pais),cep:null,estado:$scope.alunoEndereco.uf_municipio_end,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;$scope.LISTA_MUNICIPIOS_END_RES=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};$scope.LISTA_MUNICIPIOS_END_RES.push(municipio)}$ionicLoading.hide()}).catch(function(err){$ionicLoading.hide(),$log.debug(err)})}else $ionicLoading.hide()},$scope.loadBairros=function(){if(showLoading(),$scope.loadCodigoCidade(),$scope.validarBrasil()){var codMunicipio=null!=$scope.alunoEndereco.end_municipio?$scope.alunoEndereco.end_municipio:null;if($scope.alunoEndereco&&$scope.alunoEndereco.bairro&&($scope.alunoEndereco.bairro=$scope.alunoEndereco.bairro.toUpperCase()),$scope.LISTA_BAIRROS_END_RES=[],null==codMunicipio||""===codMunicipio)return void $ionicLoading.hide();UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_RES=result,$scope.loadCodigoBairro(),$ionicLoading.hide()}).catch(function(err){$ionicLoading.hide(),$log.debug(err)})}else $scope.LISTA_BAIRROS_END_RES=[],$ionicLoading.hide()},$scope.loadCodigoCidade=function(){var cidade=$scope.alunoEndereco.nome_end_municipio;if(cidade)for(var i=0;i<$scope.LISTA_MUNICIPIOS_END_RES.length;i++)if(removeAcento($scope.LISTA_MUNICIPIOS_END_RES[i].nome)===removeAcento(cidade))return $scope.alunoEndereco.end_municipio=$scope.LISTA_MUNICIPIOS_END_RES[i].codigo,void($scope.alunoEndereco.nome_end_municipio=$scope.LISTA_MUNICIPIOS_END_RES[i].nome.toUpperCase())},$scope.loadCodigoBairro=function(){var bairro=$scope.alunoEndereco.bairro;if(bairro&&$scope.LISTA_BAIRROS_END_RES.length>0)for(var i=0;i<$scope.LISTA_BAIRROS_END_RES.length;i++)if(removeAcento($scope.LISTA_BAIRROS_END_RES[i].nome)===removeAcento(bairro))return $scope.alunoEndereco.obj_bairro={},$scope.alunoEndereco.obj_bairro.bairro=$scope.LISTA_BAIRROS_END_RES[i].bairro,$scope.alunoEndereco.obj_bairro.nome=$scope.LISTA_BAIRROS_END_RES[i].nome,void($scope.habilitaInputBairro=!1);$scope.alunoEndereco.obj_bairro={},$scope.alunoEndereco.obj_bairro.nome=$scope.alunoEndereco.bairro?$scope.alunoEndereco.bairro.toUpperCase():"",$scope.habilitaInputBairro=!0},$scope.getCodigoPais=function(nomePais){if(nomePais&&$scope.paises)for(let i=0;i<$scope.paises.dados.length;i++)if($scope.paises.dados[i].nome.toUpperCase()===nomePais.toUpperCase())return $scope.paises.dados[i].pais},$scope.validarBrasil=function(){return void 0!==$scope.alunoEndereco.end_pais&&""!==$scope.alunoEndereco.end_pais&&($scope.alunoEndereco.end_pais=$scope.alunoEndereco.end_pais.toUpperCase(),null!==$scope.alunoEndereco.end_pais&&void 0!==$scope.alunoEndereco.end_pais&&"BRASIL"==$scope.alunoEndereco.end_pais.toUpperCase())},$scope.limparCamposEndereco=function(){$scope.alunoEndereco.endereco="",$scope.alunoEndereco.end_num="",$scope.alunoEndereco.end_compl="",$scope.alunoEndereco.obj_bairro={},$scope.alunoEndereco.end_municipio="",$scope.alunoEndereco.nome_end_municipio="",$scope.alunoEndereco.uf_municipio_end="",$scope.LISTA_ESTADOS_END_RES=[],$scope.LISTA_MUNICIPIOS_END_RES=[],$scope.LISTA_BAIRROS_END_RES=[]},$scope.obterEndereco=function(cep){void 0!==cep&&""!==cep&&8==cep.length&&($scope.limparCamposEndereco(),$scope.loadEstados(),showLoading(),UtilService.obterEndereco(cep).then(function(result){$scope.endereco=result;try{$scope.validarBrasil()?UtilService.obterUF().then(function(result){$scope.listaEstados=result;var filtroMunicipio={codMunicipio:null,nome:null,cep:null,uf:$scope.endereco.ufSigla};$scope.endereco.ufSigla?UtilService.obterMunicipios(filtroMunicipio).then(function(result){$ionicLoading.hide();var municipios=result;$scope.listaMunicipios=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome.toUpperCase()};$scope.listaMunicipios.push(municipio)}null!==$scope.endereco.srbCidade&&void 0!==$scope.endereco.srbCidade?UtilService.obterBairros($scope.endereco.srbCidade).then(function(result){$scope.listaBairros=result,preencherCamposEndereco()}):(preencherCamposEndereco(),$scope.listaBairros=[])}):$ionicLoading.hide()}):UtilService.obterEstadosEstrangeiros($scope.alunoEndereco.end_pais).then(function(result){$scope.listaEstados={},$scope.listaEstados.dados=[];for(var i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado.toUpperCase():result[i].estado};$scope.listaEstados.dados.push(uf)}var municipio={codMunicipioEstrangeiro:null,nome:null,pais:$scope.getCodigoPais($scope.alunoEndereco.end_pais),cep:null,estado:$scope.endereco.ufSigla,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;$scope.listaMunicipios=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};$scope.listaMunicipios.push(municipio)}$scope.listaBairros=[],preencherCamposEndereco()})})}catch(erro){$ionicLoading.hide()}}).catch(function(erro){$ionicLoading.hide(),$scope.limparCamposEndereco()}))}}]),angular.module("custom.controllers").controller("PagamentoDebitoAutorizadoController",["$q","$scope","$timeout","Notification","SessionData","AonlineUtils","$state","$ionicModal","CartaoService",function($q,$scope,$timeout,Notification,SessionData,AonlineUtils,$state,$ionicModal,CartaoService){var vm=this;let user=SessionData.user;const alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado];vm.dadosCartao={},vm.isCartoesSalvos=!1,vm.isGestaoAlteracao=!1,vm.showBackButton=!1,vm.isNovoCartao=!1,vm.cardMask="9999 9999 9999 9999",vm.namePattern=/^[a-zA-Z]+\s[a-zA-Z ]+$/;let debitoCartaoDto={aluno:alunoSelecionado.codAluno,processo:null,chave1:null,chave2:null,chave3:null,chave4:null,chave5:null,chave6:null};function _listarAutorizacoesDebito(){AonlineUtils.showLoading(!0),CartaoService.listarAutorizacoesDebito(debitoCartaoDto).then(result=>{vm.dadosCartoes=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}function _listarCartoesSalvos(){CartaoService.listarCartoesSalvos(parseInt(user.id)).then(result=>{vm.listaCartoes=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}_listarAutorizacoesDebito(),CartaoService.obterConfiguracoesCartao(alunoSelecionado.codAluno).then(result=>{vm.configCartao=angular.copy(result)}),$ionicModal.fromTemplateUrl("views/logged/cartao/modal.gestao.cartoes.view.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalCartoesSalvos){vm.modalCartoesSalvos=modalCartoesSalvos}),$ionicModal.fromTemplateUrl("views/logged/cartao/modal.confrma.cancela.autorizacao.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalCancelaAutorizacao){vm.modalCancelaAutorizacao=modalCancelaAutorizacao}),$ionicModal.fromTemplateUrl("views/logged/cartao/modal.confrma.cancela.cartoes.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalConfirmaCancelaCartoes){vm.modalConfirmaCancelaCartoes=modalConfirmaCancelaCartoes}),vm.openModalCartoesSalvos=function(){vm.isCartoesSalvos=!0,vm.showBackButton=!1,vm.modalCartoesSalvos.show(),AonlineUtils.showLoading(!0),_listarCartoesSalvos()},vm.cancelaAutorizacao=function(item,confirmado){confirmado?(console.log(item),CartaoService.desativarAutorizacao(item.id).then(function(){vm.modalCancelaAutorizacao.hide(),vm.autorizacaoParaCancelar=null,_listarAutorizacoesDebito()})):(vm.autorizacaoParaCancelar=item,vm.modalCancelaAutorizacao.show())},vm.closeModalCartoes=function(){vm.isCartoesSalvos=!1,vm.isGestaoAlteracao=!1,vm.modalCartoesSalvos.hide()},vm.openModalAlteracao=function(dadosCartao){vm.isGestaoAlteracao=!0,vm.isCartoesSalvos=!1,vm.isNovoCartao=!1,AonlineUtils.showLoading(!0),dadosCartao&&(vm.dadosItemSelecionado=angular.copy(dadosCartao)),CartaoService.listarBandeiras().then(result=>{vm.listaBandeiras=angular.copy(result.data)}),_listarCartoesSalvos(),vm.modalCartoesSalvos.show()},vm.concluirCartaoAutorizacao=function(){let cartaoDadosDto={};AonlineUtils.showLoading(!0),cartaoDadosDto=vm.isNovoCartao?{aluno:alunoSelecionado.codAluno,idAutorizacao:vm.dadosItemSelecionado.id,numero:vm.dadosCartao.numeroCartao,cvv:vm.dadosCartao.cvv,mes:vm.dadosCartao.mes,ano:vm.dadosCartao.ano,nome:vm.dadosCartao.nomeTitular,cpf:vm.dadosCartao.cpfTitular,autorizo:vm.salvarCartao?"S":"N",codPessoaLogada:parseInt(user.id)}:{aluno:alunoSelecionado.codAluno,idAutorizacao:vm.dadosItemSelecionado.id,idCartaoSalvo:vm.dadosCartao.cartaoSelecionado.id,cvvCartaoSalvo:vm.dadosCartao.cvvCartaoSalvo,autorizo:vm.salvarCartao?"S":"N",codPessoaLogada:parseInt(user.id)},CartaoService.alterarCartaoProcesso(cartaoDadosDto).then(result=>{AonlineUtils.showLoading(!1),Notification.success(result.conteudo),vm.closeModalCartoes(),_listarAutorizacoesDebito()}).catch(err=>{AonlineUtils.showLoading(!1)})},vm.habilitarFormCard=function(){vm.isNovoCartao=!0,vm.dadosCartao.cvv=null,vm.dadosCartao.cartaoSelecionado=null,$location.hash("bandeira")},vm.cancelarFormCard=function(){vm.isNovoCartao=!1},vm.gerenciarCartoesSalvos=function(){vm.isCartoesSalvos=!0,vm.showBackButton=!0,vm.isGestaoAlteracao=!1},vm.removerCartao=function(item,confirmado){if(!confirmado){if(vm.dadosCartoes&&(vm.autorizacaoParaCancelar=vm.dadosCartoes.filter(a=>a.id_cartao_salvo===item.id&&"S"===a.ativo)),vm.autorizacaoParaCancelar.length>0)return vm.autorizacaoParaCancelar=vm.autorizacaoParaCancelar[0],vm.cartaoParaCancelar=item,vm.modalConfirmaCancelaCartoes.show(),0;vm.autorizacaoParaCancelar=null,vm.modalConfirmaCancelaCartoes.hide()}AonlineUtils.showLoading(!0);let params={idCartao:item.id},reqs=[CartaoService.desativarCartao(params)];confirmado&&vm.autorizacaoParaCancelar&&reqs.push(CartaoService.desativarAutorizacao(vm.autorizacaoParaCancelar.id)),$q.all(reqs).then(result=>{Notification.info(result[0].conteudo),_listarCartoesSalvos(),confirmado&&vm.autorizacaoParaCancelar&&_listarAutorizacoesDebito(),vm.modalConfirmaCancelaCartoes.hide(),vm.modalCartoesSalvos.hide()}).catch(err=>{AonlineUtils.showLoading(!1)})},vm.detalharItemPagamento=function(pagamento){$state.go("home.pgtocartao-consulta",{from:"pagamento",numPedido:pagamento.idPedidoPgto})},vm.isModal=!1,vm.expandAccordion=function(idDebito){vm.isModal?$timeout(()=>{$("#"+idDebito).removeClass("in"),$("#btn"+idDebito).attr("aria-expanded","false")},500):(angular.forEach(vm.dadosCartoes,function(item){item.id!==idDebito&&$("#"+item.id).hasClass("in")&&($("#"+item.id).removeClass("in"),$("#btn"+item.id).attr("aria-expanded","false"))}),$("#"+idDebito).hasClass("in")||(AonlineUtils.showLoading(!0),CartaoService.listarProcessamentosDebitoCartao(idDebito).then(response=>{vm.listaProcessamentoDebito=angular.copy(response),AonlineUtils.showLoading(!1)},error=>{AonlineUtils.showLoading(!1)})))},vm.setCardMask=function(bandeiraSelecionada){switch(vm.dadosCartao.numeroCartao=null,bandeiraSelecionada){case"AMEX":vm.cardMask="9999 999999 99999";break;case"DINERS":vm.cardMask="9999 9999 9999 99";break;default:vm.cardMask="9999 9999 9999 9999"}}}]),angular.module("custom.controllers").controller("PagamentoRecorrenteController",["$q","$scope","$timeout","Notification","SessionData","AonlineUtils","$state","$ionicModal","CartaoService",function($q,$scope,$timeout,Notification,SessionData,AonlineUtils,$state,$ionicModal,CartaoService){var vm=this;let dadosAluno={codAluno:SessionData.aluno.list[SessionData.aluno.selecionado].codAluno};function _listarPagamentosRecorrentes(){AonlineUtils.showLoading(!0),CartaoService.listarPagamentosRecorrentes(dadosAluno).then(result=>{vm.dadosRecorrencia=angular.copy(result),vm.tratarSituacao(),console.log(vm.dadosRecorrencia),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}_listarPagamentosRecorrentes(),$ionicModal.fromTemplateUrl("views/logged/cartao/modal.confirma.cancela.recorrencia.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalCancelaRecorrencia){vm.modalCancelaRecorrencia=modalCancelaRecorrencia}),vm.cancelaRecorrencia=function(item,confirmado){if(confirmado){let cancelaRecorrencia={idPgtoRecorrente:item.idPgtoRecorrente,usuario:SessionData.user.id,motivo:"Cancelado pelo usuário"};CartaoService.cancelarRecorrenciaCartao(cancelaRecorrencia).then(function(){vm.modalCancelaRecorrencia.hide(),vm.autorizacaoParaCancelar=null,_listarPagamentosRecorrentes()})}else vm.autorizacaoParaCancelar=item,vm.modalCancelaRecorrencia.show()},vm.isModal=!1,vm.expandAccordion=function(idPgtoRecorrencia){if(vm.isModal)$timeout(()=>{$("#"+idPgtoRecorrencia).removeClass("in"),$("#btn"+idPgtoRecorrencia).attr("aria-expanded","false")},500);else if(angular.forEach(vm.dadosCartoes,function(item){item.idPgtoRecorrente!==idPgtoRecorrencia&&$("#"+item.idPgtoRecorrente).hasClass("in")&&($("#"+item.idPgtoRecorrente).removeClass("in"),$("#btn"+item.idPgtoRecorrente).attr("aria-expanded","false"))}),!$("#"+idPgtoRecorrencia).hasClass("in")){AonlineUtils.showLoading(!0);let parcelasRecorrencia={idPgtoRecorrente:idPgtoRecorrencia};CartaoService.listarParcelasPagamentoRecorrente(parcelasRecorrencia).then(response=>{vm.parcelasPagamentoRecorrente=angular.copy(response),AonlineUtils.showLoading(!1)},error=>{AonlineUtils.showLoading(!1)})}},vm.tratarSituacao=function(){angular.forEach(vm.dadosRecorrencia,function(item){"S"==item.ativo?item.ativoDesc="Ativo":item.ativoDesc="Cancelado"})}}]),angular.module("custom.controllers").controller("PagamentoCobrancasController",["$log","$scope","$http","$rootScope","$state","$timeout","$translate","SessionData","CartaoService","$ionicNavBarDelegate",function($log,$scope,$http,$rootScope,$state,$timeout,$translate,SessionData,CartaoService,$ionicNavBarDelegate){$ionicNavBarDelegate.title($translate.instant("Home.view.Cobranca")),$state.go("home.pgtocobrancas.cobrancas")}]),angular.module("custom.controllers").controller("PagamentoCobrancasListarController",["$log","$scope","$timeout","$rootScope","$state","$ionicLoading","$ionicScrollDelegate","$q","SessionData","CartaoService","TypeEnum","PagamentoCartaoFactory","CobrancaService","Storage","Notification","$ionicModal","$translate",function($log,$scope,$timeout,$rootScope,$state,$ionicLoading,$ionicScrollDelegate,$q,SessionData,CartaoService,TypeEnum,PagamentoCartaoFactory,CobrancaService,Storage,Notification,$ionicModal,$translate){let vm=this,aluno=SessionData.aluno.list[0];function showLoading(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})}showLoading(),$scope.$on("broadAtualizarCobrancas",function(){Notification.info("Boleto Vencido. Aguarde enquanto realizamos a prorrogação."),showLoading(),vm.alunos=[],listarCobrancas()}),vm.alunos=[];var listarCobrancas=function(){CartaoService.listaCobrancasBoletoCartao(aluno).then(function(cobrancas){if(cobrancas&&cobrancas.length>0){vm.permiteCartao=!1,vm.permitePix=!1;for(let i=0;i<cobrancas.length;i++)vm.permiteCartao=vm.permiteCartao||cobrancas[i].permiteCartao,vm.permitePix=vm.permitePix||cobrancas[i].permitePix,cobrancas[i].checked=!1,cobrancas[i].codNomeAluno=cobrancas[i].aluno+" - "+cobrancas[i].nome_compl,0==i?vm.alunos.push({aluno:cobrancas[0].aluno,nome:cobrancas[0].nome_compl,cobrancas:[cobrancas[i]]}):vm.alunos[0].cobrancas.push(cobrancas[i]);if($scope.mapaExtrato={},null!==vm.alunos[0].cobrancas&&void 0!==vm.alunos[0].cobrancas){for(var i=0;i<vm.alunos[0].cobrancas.length;i++)null==$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo]?($scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo]=[],$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo].push(vm.alunos[0].cobrancas[i])):$scope.mapaExtrato[vm.alunos[0].cobrancas[i].grupo].push(vm.alunos[0].cobrancas[i]);$scope.tamanhoMapa=Object.keys($scope.mapaExtrato).length,vm.alunos[0].mapaExtrato=angular.copy($scope.mapaExtrato)}$ionicLoading.hide()}else $ionicLoading.hide()})};function adjustScroll(){let scrollInstance=$ionicScrollDelegate._instances.filter(function(inst){if("listarContent"==inst.$element[0].id)return inst});scrollInstance.length>0&&scrollInstance[0].resize()}listarCobrancas(),vm.btNext=function(){showLoading();let cobrancas=vm.getCobrancasSelecionadas();cobrancas.length>0?(PagamentoCartaoFactory.setCobrancasSelecionadas(cobrancas),CartaoService.calculaValoresTotaisPagamento(cobrancas).then(function(calculos){calculos.calculoValores.encargoBolsa=calculos.calculoValores.encargoBolsaCalculado,calculos.calculoValores.valorDocumento=calculos.calculoValores.valorFinalAcordo,PagamentoCartaoFactory.setCalculos(calculos),$state.go("home.pgtocartao-pagamento")},function(error){$ionicLoading.hide()})):(Notification.error("Erro ao processar cobranças selecionadas. Tente novamente mais tarde."),$ionicLoading.hide())},vm.columnsResumo=[{name:"Aluno.Cartao.Wizard1.ValorSelecionado",id:"valorSelecionado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Encargo",id:"encargoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.EncargoBolsa",id:"encargoBolsaCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.Desconto",id:"descontoAdiantamentoCalculado",type:TypeEnum.CURRENCY},{name:"Aluno.Cartao.Wizard1.ValorTotal",id:"valorFinalAcordo",type:TypeEnum.CURRENCY}],$scope.$on("CardCreditSelection",function(event,data){showLoading();let cobrancas=vm.getCobrancasSelecionadas();cobrancas.length>0?CartaoService.calculaValoresTotaisPagamento(cobrancas).then(function(calculos){calculos.calculoValores&&(vm.resumoPagamento=calculos.calculoValores,PagamentoCartaoFactory.setCalculos(calculos)),$ionicLoading.hide(),adjustScroll()},function(){console.log(event)}):($ionicLoading.hide(),adjustScroll())}),vm.getCalculatedValues=function(column){if(vm.resumoPagamento)return function(input=0){return parseFloat(input).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}(vm.resumoPagamento[column.id])},$ionicModal.fromTemplateUrl("views/logged/cartao/modal.pagamento.pix.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalPix){vm.modalPix=modalPix}),vm.openModalPix=function(){let cobrancas=vm.getCobrancasSelecionadas(),listaCobrancas=[];angular.forEach(cobrancas,item=>{listaCobrancas.push(item.cobranca)});let params={candidato:null,concurso:null,listaDeCobrancas:listaCobrancas,valorTotal:vm.resumoPagamento.valorFinalAcordo};$scope.$broadcast("startPix",params),vm.modalPix.show()},$scope.copiarPix=function(){Clipboard.isSupported()?(vm.clipboard=new Clipboard("#copy-button"),Notification.success($translate.instant("pix.view.msg.copied"))):Notification.warning($translate.instant("navegador.sem.suporte"))},vm.getWindowWidth=function(){return $(window).width()},$scope.closeModal=function(){vm.modalPix.hide()},vm.getCobrancasSelecionadas=function(){let cobrancas=[];for(let i=0;i<vm.alunos.length;i++)vm.alunos[i].mapaExtrato&&Object.values(vm.alunos[i].mapaExtrato).forEach(function(tipoCobranca){for(let j=0;j<tipoCobranca.length;j++)tipoCobranca[j].checked&&cobrancas.push({cobranca:tipoCobranca[j].cobranca,valorDiferenca:tipoCobranca[j].valor,descricaoCobranca:tipoCobranca[j].descricaoCobranca,codResponsavelFinanceiro:tipoCobranca[j].resp,codAluno:tipoCobranca[j].aluno,num_cobranca:tipoCobranca[j].num_cobranca})});return cobrancas},vm.mostrarCartao=function(){let alunos=vm.alunos,cobrancasSelecionadas=this.getCobrancasSelecionadas();for(let i=0;i<cobrancasSelecionadas.length;i++)for(let j=0;j<alunos.length;j++)if(cobrancasSelecionadas[i].codAluno==alunos[j].aluno)for(let k=0;k<alunos[j].cobrancas.length;k++)if(cobrancasSelecionadas[i].cobranca==alunos[j].cobrancas[k].cobranca&&!alunos[j].cobrancas[k].permiteCartao)return!1;return!0},vm.mostrarPix=function(){let alunos=vm.alunos,cobrancasSelecionadas=this.getCobrancasSelecionadas();for(let i=0;i<cobrancasSelecionadas.length;i++)for(let j=0;j<alunos.length;j++)if(cobrancasSelecionadas[i].codAluno==alunos[j].aluno)for(let k=0;k<alunos[j].cobrancas.length;k++)if(cobrancasSelecionadas[i].cobranca==alunos[j].cobrancas[k].cobranca&&!alunos[j].cobrancas[k].permitePix)return!1;return!0}}]),angular.module("custom.controllers").controller("ContratoController",["$log","$http","$state","$timeout","$translate","Notification","SessionData",ContratoController]),angular.module("custom.controllers").controller("MatriculaController",["$log","SessionData","MatriculaService","$ionicLoading","$state","$q","$scope","$ionicHistory","$ionicNavBarDelegate","$translate",MatriculaController]),angular.module("custom.controllers").controller("MatriculaTermoController",["$scope",MatriculaTermoController]),angular.module("custom.controllers").controller("MatriculaDisciplinasController",["$scope","SessionData","Notification","MatriculaService","$log","$ionicModal","TypeEnum","$translate","$ionicLoading","$q","$ionicScrollDelegate","$state","Storage","$location","DownloadArquivo","Configs",function($scope,SessionData,Notification,MatriculaService,$log,$ionicModal,TypeEnum,$translate,$ionicLoading,$q,$ionicScrollDelegate,$state,Storage,$location,DownloadArquivo,Configs){let vm=this,aluno=SessionData.aluno.list[0],matriculaController=$scope.vm.parentScope.vm,adjustWizardScroll=$scope.vm.parentScope.adjustWizardScroll,configMatricula=matriculaController.configMatricula.config,alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado];function showLoading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}):$ionicLoading.hide()}MatriculaService.checarOperacoesPermitidas(alunoSelecionado.codAluno).then(result=>{vm.permittedActions=result}),vm.activeOnModal="DISCIPLINAS",showLoading(!0),matriculaController.cancelButton={enabled:!1},matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green",enabled:!0,onClick:function(){let deferr=$q.defer();return deferr.resolve(),deferr.promise}},vm.instrucoes=configMatricula.instrucoes;const idioma=$translate.use();"pt_br"!==idioma?(vm.instrucoes=configMatricula[`disciplinas_instr_${idioma}`]?configMatricula[`disciplinas_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],vm.instrucoes||(vm.instrucoes=configMatricula.disciplinas_instr?configMatricula.disciplinas_instr:configMatricula.instrucoes)):vm.instrucoes=configMatricula.disciplinas_instr?configMatricula.disciplinas_instr:configMatricula.instrucoes;let semanas={dom:$translate.instant("System.week.Domingo"),seg:$translate.instant("System.week.Segunda"),ter:$translate.instant("System.week.Terca"),qua:$translate.instant("System.week.Quarta"),qui:$translate.instant("System.week.Quinta"),sex:$translate.instant("System.week.Sexta"),sab:$translate.instant("System.week.Sabado")};function obterDisciplinasMatriculadas(){MatriculaService.obterDisciplinasMatriculadas(aluno,vm.config.configMatricula).then(function(disciplinasMatriculadas){vm.config.contextoMatricula=matriculaController.configMatricula.contexto,vm.config.disciplinasMatriculadas=disciplinasMatriculadas.dados,Storage.set("disciplinasMatriculadas",JSON.stringify(vm.config.disciplinasMatriculadas)),obterDadosQuadroHorario()},function(){vm.redirectError()})}function obterDadosQuadroHorario(){MatriculaService.obterDadosQuadroHorario(aluno,vm.config).then(function(horarios){listaComHorario=horarios.listaComHorario,vm.disciplinasSemHorario=horarios.listaSemHorario,vm.hours=[],vm.lines=[],vm.weekDetails=[];let template={seg:[],ter:[],qua:[],qui:[],sex:[],sab:[]};vm.weekDetails=angular.copy(template);for(let i=0;listaComHorario&&i<listaComHorario.length;i++){let horario=listaComHorario[i],horas=horario.horario.split("-");vm.hours[i]={ini:horas[0],end:horas[1]},vm.lines.push(angular.copy(template));for(let j=0;j<horario.diasSemana.length;j++){let diaSemana=horario.diasSemana[j];switch(vm.lines[i][Object.keys(template)[diaSemana.dia-2]]=diaSemana.disciplinas,diaSemana.disciplinas.horario=horario.horario,diaSemana.dia){case 2:case 3:case 4:case 5:case 6:case 7:vm.weekDetails[Object.keys(template)[diaSemana.dia-2]].push(diaSemana.disciplinas)}}}$ionicLoading.hide(),adjustWizardScroll()},function(){vm.redirectError()})}function limparCamposModal(){vm.dadosDisciplina.tipoSelecionado=void 0,vm.dadosDisciplina.turnoSelecionado=void 0,vm.dadosDisciplina.undFisicaSelecionada=void 0,vm.listaDisciplinas=[],vm.listaTurmas=[],$scope.turmasSelecionadas=[],$scope.disciplinasSelecionadas=[]}function atualizarDisciplinaPriorizacaoSelecionada(){let i=vm.config.disciplinasMatriculadas.findIndex(element=>element.disciplina==$scope.disciplinaSelecionada.disciplina);$scope.disciplinaSelecionada=vm.config.disciplinasMatriculadas[i],vm.listaOpcoesAdicionadas=angular.copy($scope.disciplinaSelecionada.listaOpcoes),vm.config.disciplinasMatriculadas[i].listaOpcoes.length||(vm.config.disciplinasMatriculadas[i].listaOpcoes=null)}vm.onClickClass=function(disciplina,dia,indexLine){vm.detalhes=[],vm.titulo=$translate.instant("Aluno.Matricula.Disciplina.Modal"),dia&&void 0!==indexLine?(vm.tituloCard=semanas[dia]+" "+vm.hours[indexLine].ini+"-"+vm.hours[indexLine].end,vm.columnsDetalhes=[{name:"Aluno.Materia.Disciplina.Codigo",id:"codDisciplina",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Nome",id:"nomeDisciplina",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Turma",id:"codTurma",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Local",id:"localCompl",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.InicioAulas",id:"dataInicioFimAula",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Frequencia",id:"frequencia",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Modalidade",id:"nivelPresenca",type:TypeEnum.STRING}]):(vm.tituloCard=disciplina.codDisciplina,vm.columnsDetalhes=[{name:"Aluno.Materia.Disciplina.Codigo",id:"codDisciplina",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Nome",id:"nomeDisciplina",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Turma",id:"codTurma",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Serie",id:"descrSerie",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.NomeDisciplina",id:"nomeDisciplina",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Observacao",id:"observacao",type:TypeEnum.STRING},{name:"Aluno.Materia.Disciplina.Detalhe",id:"sit_detalhe",type:TypeEnum.STRING}]),disciplina instanceof Array?disciplina.map(function(item){vm.detalhes.push(item)}):vm.detalhes.push(disciplina),vm.modal.show()},vm.closeModal=function(){vm.modal.hide()},vm.redirectError=function(){matriculaController&&matriculaController.steps&&matriculaController.steps.length>1&&"termo"==matriculaController.steps[0].name?$state.go("home.matricula",{},{reload:!0}):$state.go("home.avisos",{},{reload:!0})},$ionicModal.fromTemplateUrl("views/logged/matricula/aluno.matricula.disciplinas.modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){vm.modal=modal}),$ionicModal.fromTemplateUrl("views/logged/matricula/modal.incluir.disciplinas.matricula.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalInclusao){vm.modalInclusao=modalInclusao}),$ionicModal.fromTemplateUrl("views/logged/matricula/modal.editar.disciplinas.matricula.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalEdicao){vm.modalEdicao=modalEdicao}),$ionicModal.fromTemplateUrl("views/logged/matricula/modal.priorizacao.matricula.html",{scope:$scope,animation:"slide-in-up",hardwareBackButtonClose:!1,backdropClickToClose:!1}).then(function(modalPriorizacao){vm.modalPriorizacao=modalPriorizacao}),$ionicModal.fromTemplateUrl("views/logged/matricula/modal.simular.valores.matricula.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalValores){vm.modalValores=modalValores}),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){vm.modal&&vm.modal.hide(),"matricula"==fromState.pageId&&toState.pageId!=fromState.pageId&&Storage.set("disciplinasMatriculadas",null)}),vm.config={configMatricula:matriculaController.configMatricula.config},vm.config.configMatricula.instrucao_adicao_disciplina="pt_br"!==idioma?configMatricula[`incluir_disciplinas_instr_${idioma}`]:configMatricula.incluir_disciplinas_instr,Storage.get("disciplinasMatriculadas")&&"[]"!=Storage.get("disciplinasMatriculadas")?(vm.config.contextoMatricula=matriculaController.configMatricula.contexto,vm.config.disciplinasMatriculadas=JSON.parse(Storage.get("disciplinasMatriculadas")),obterDadosQuadroHorario()):obterDisciplinasMatriculadas(),vm.getWindowWidth=function(){return window.innerWidth},vm.handleNormalizeString=function(string){return"string"==typeof string||string instanceof String?string.toLowerCase().split(" ").map(s=>s.length>1||"i"==s?s.charAt(0).toUpperCase()+s.substring(1):s).join(" "):string},vm.deletarDisciplina=function(item){showLoading(!0);let obj_params={codAluno:alunoSelecionado.codAluno,codDisciplina:item.codDisciplina,turma:item.codTurma,disciplinasList:vm.config.disciplinasMatriculadas};MatriculaService.removerDisciplinasQuadro(obj_params).then(result=>{Storage.set("disciplinasMatriculadas",JSON.stringify(result)),vm.config.disciplinasMatriculadas=angular.copy(result),obterDadosQuadroHorario(vm.config)},err=>(Notification.error("Erro ao remover."),err))},vm.listarGruposPorArea=function(area){showLoading(!0),MatriculaService.listarGruposPorArea(alunoSelecionado.codAluno,area).then(result=>{vm.listaGrupoArea=angular.copy(result),showLoading(!1)},err=>{$log.debug(err),showLoading(!1)})},vm.listarGruposMatricula=function(){showLoading(!0);let obrigatorio=vm.dadosDisciplina.obrigatorio?"S":"N";MatriculaService.listarGruposMatricula(alunoSelecionado.codAluno,obrigatorio).then(result=>{vm.listaGrupoMatricula=angular.copy(result),showLoading(!1)},err=>{$log.debug(err),showLoading(!1)})},vm.aoSelecionarTipo=function(tipoSelecionado){switch(tipoSelecionado.tipo){case"ExtraCurriculares":showLoading(!0),MatriculaService.listarCursosMatricula().then(result=>{vm.listaCursos=angular.copy(result),vm.cursoRequired=!0,showLoading(!1)},err=>{console.log(err),showLoading(!1)});break;case"AreaConcentracao":showLoading(!0),MatriculaService.listarAreas(alunoSelecionado.codAluno).then(result=>{vm.listaAreas=angular.copy(result),showLoading(!1)},err=>{$log.debug(err),showLoading(!1)}),vm.cursoRequired=!1;break;case"HabilitacaoEletivas":vm.listarGruposMatricula(),vm.cursoRequired=!1;break;default:vm.cursoRequired=!1}},vm.openModalAdd=async function(){await async function(){if(showLoading(!0),!vm.listaTipos)var p1=MatriculaService.listarTiposDisciplinas(alunoSelecionado.codAluno).then(result=>{vm.listaTipos=angular.copy(result),vm.buscarDisciplinas()},err=>{$log.debug(err)});if(!vm.listaTurnosMatricula)var p2=MatriculaService.listarTurnosMatricula(alunoSelecionado.codAluno).then(result=>{vm.listaTurnosMatricula=angular.copy(result)},err=>{$log.debug(err)});if(!vm.listaUnidadeFisica)var p3=MatriculaService.listarUnidadesFisicasMatricula(alunoSelecionado.codAluno).then(result=>{vm.listaUnidadeFisica=angular.copy(result)},err=>{$log.debug(err)});await Promise.all([p1,p2,p3]).then(()=>{showLoading(!1)},()=>{showLoading(!1)})}(),vm.modalInclusao.show()},vm.downloadEmenta=function(item){showLoading(!0);let params={};params.url=Configs.getApiServer()+"/matricula/codDisciplina/"+item.disciplina+"/obter-ementa",params.method="GET",DownloadArquivo.downloadArquivo(params)},vm.buscarDisciplinas=function(){vm.allSelected=!1,showLoading(!0),vm.listaDisciplinas=[],vm.listaTurmas=[],$scope.disciplinasSelecionadas=[];let matriculaTD={codAluno:encodeURI(alunoSelecionado.codAluno),tipo:vm.dadosDisciplina.tipoSelecionado.tipo,area:vm.dadosDisciplina.areaSelecionada,grupoArea:vm.dadosDisciplina.grupoSelecionado,curso:vm.dadosDisciplina.cursoSelecionado,descricaoDisciplina:vm.dadosDisciplina.descricaoDisciplina?encodeURI(vm.dadosDisciplina.descricaoDisciplina):"",grupo:vm.dadosDisciplina.grupoMatriculaSelecionado,obrigatorio:vm.dadosDisciplina.obrigatorio?"S":"N",disciplinasList:vm.config.disciplinasMatriculadas};MatriculaService.listarDisciplinas(matriculaTD).then(result=>{vm.listaDisciplinas=angular.copy(result),showLoading(!1)},err=>{})},vm.selecionarDisciplina=function(item,indice){item.selecionado?($scope.disciplinasSelecionadas.push(item),vm.buscarTurmas()):($scope.disciplinasSelecionadas.splice(indice,1),vm.buscarTurmas())},$scope.disciplinasSelecionadas=[],$scope.disciplinasEquivalentesSelecionadas=[],vm.dadosDisciplina={},$scope.turmasSelecionadas=[],vm.filtro={},vm.filtro.verificaVagas=!1,vm.filtro.diasSemana={seg:!0,ter:!0,qua:!0,qui:!0,sex:!0,sab:!0,dom:!0},vm.buscarTurmas=function(){if($scope.disciplinasSelecionadas.length){$scope.checkDias={seg:vm.filtro.diasSemana.seg?"S":"N",ter:vm.filtro.diasSemana.ter?"S":"N",qua:vm.filtro.diasSemana.qua?"S":"N",qui:vm.filtro.diasSemana.qui?"S":"N",sex:vm.filtro.diasSemana.sex?"S":"N",sab:vm.filtro.diasSemana.sab?"S":"N",dom:vm.filtro.diasSemana.dom?"S":"N"};let filtroMatricula={codAluno:alunoSelecionado.codAluno,unidadeFisica:vm.dadosDisciplina.undFisicaSelecionada,turno:vm.dadosDisciplina.turnoSelecionado,verificaVagas:vm.filtro.verificaVagas?"S":"N",seg:$scope.checkDias.seg,ter:$scope.checkDias.ter,qua:$scope.checkDias.qua,qui:$scope.checkDias.qui,sexta:$scope.checkDias.sex,sab:$scope.checkDias.sab,dom:$scope.checkDias.dom,disciplinas:$scope.disciplinasSelecionadas.map(item=>item.disciplina),grupos:$scope.disciplinasSelecionadas.map(item=>item.grupo),nomesDisciplinas:$scope.disciplinasSelecionadas.map(item=>item.nomeDisciplina),cargaHoraria:$scope.disciplinasSelecionadas.map(item=>item.cargaHoraria),series:$scope.disciplinasSelecionadas.map(item=>item.serieIdeal)};showLoading(!0),MatriculaService.listarTurmas(filtroMatricula).then(result=>{vm.listaTurmas=angular.copy(result),"en_us"===$translate.use()&&vm.listaTurmas.forEach(itens=>itens[0].cabecalhoDisciplina=itens[0].cabecalhoDisciplina.replace("Carga Horária","Workload")),showLoading(!1)},err=>{$log.debug(err),showLoading(!1)})}else vm.listaTurmas=[]},vm.selecionarDisciplinaTroca=function(disciplinaEquivalente){disciplinaEquivalente.selecionado?$scope.disciplinasEquivalentesSelecionadas.push(disciplinaEquivalente):$scope.disciplinasEquivalentesSelecionadas.splice(indice,1)},vm.selectAll=function(){vm.allSelected?($scope.disciplinasSelecionadas=angular.copy(vm.listaDisciplinas),vm.buscarTurmas()):$scope.disciplinasSelecionadas=[]},vm.incluirDisciplinasMatricula=function(){if($scope.turmasSelecionadas=[],angular.forEach(vm.listaTurmas,itens=>{angular.forEach(itens,element=>{element.turmaSelecionada&&$scope.turmasSelecionadas.push(element)})}),!$scope.turmasSelecionadas.length)return void Notification.warning("Nenhuma turma foi selecionada.");let paramsMatriculaTD={codAluno:alunoSelecionado.codAluno,disciplinas:$scope.turmasSelecionadas.map(item=>item.disciplina),grupos:$scope.turmasSelecionadas.map(item=>item.grupo),turmas:$scope.turmasSelecionadas.map(item=>item.turma),series:$scope.turmasSelecionadas.map(item=>item.serieIdeal),disciplinasList:vm.config.disciplinasMatriculadas};showLoading(!0),MatriculaService.incluirDisciplinasMatricula(paramsMatriculaTD).then(result=>{angular.forEach(result,item=>{item.inicioTurma&&!isNaN(item.inicioTurma)&&(item.inicioTurma=moment(item.inicioTurma).utc().format("YYYY-MM-DD hh:mm:ss.sss")),item.fimTurma&&!isNaN(item.fimTurma)&&(item.fimTurma=moment(item.fimTurma).utc().format("YYYY-MM-DD hh:mm:ss.sss"))}),vm.config.disciplinasMatriculadas=angular.copy(result),Storage.set("disciplinasMatriculadas",JSON.stringify(vm.config.disciplinasMatriculadas)),obterDadosQuadroHorario(vm.config),limparCamposModal(),vm.dadosDisciplina.tipoSelecionado=vm.listaTipos[0],vm.modalInclusao.hide()},err=>{$log.debug(err),showLoading(!1)})},vm.openModalEdit=async function(disciplina){vm.isEquivalente=!1,$scope.disciplinaSelecionada=disciplina,limparCamposModal(),await async function(){let params={codAluno:alunoSelecionado.codAluno,codDisciplinaTroca:$scope.disciplinaSelecionada.codDisciplina,codTurmaTroca:$scope.disciplinaSelecionada.codTurma,nivelTurmaTroca:null,proximoPeriodo:"S"==vm.config.configMatricula.matricula_prox_periodo};showLoading(!0),await MatriculaService.listarTurmasTroca(params).then(result=>{vm.listaTurmasTroca=angular.copy(result),showLoading(!1)},err=>{showLoading(!1)})}(),0==vm.listaTurmasTroca.length&&(vm.isEquivalente=!0,await async function(){let params={codAluno:alunoSelecionado.codAluno,codDisciplinaTroca:$scope.disciplinaSelecionada.codDisciplina,codTurmaTroca:$scope.disciplinaSelecionada.codTurma,nivelTurmaTroca:null,proximoPeriodo:"S"==vm.config.configMatricula.matricula_prox_periodo};showLoading(!0),await MatriculaService.listarTurmasDisciplinasEquivalentesTroca(params).then(result=>{vm.listaDisciplinasTurmaTroca=angular.copy(result),console.log(result),showLoading(!1)},err=>{showLoading(!1)})}()),vm.modalEdicao.show()},vm.closeModalEdit=function(){$scope.disciplinaSelecionada=null,limparCamposModal(),vm.modalEdicao.hide()},vm.openModalPriorizacao=function(disciplina){vm.listaOpcoesAdicionadas=[];let i=vm.config.disciplinasMatriculadas.findIndex(element=>element.disciplina==disciplina.codDisciplina);$scope.disciplinaSelecionada=vm.config.disciplinasMatriculadas[i],$scope.disciplinaSelecionada.listaOpcoes&&$scope.disciplinaSelecionada.listaOpcoes.length&&(vm.listaOpcoesAdicionadas=$scope.disciplinaSelecionada.listaOpcoes),vm.disciplinasPriorizacao||vm.listarDisciplinaPriorizacao(),vm.modalPriorizacao.show()},vm.setSectionActiveInModal=function(val){vm.activeOnModal=val,"ADD_DISCIPLINAS"==val&&(vm.opcoesTurmaPriorizacao=[],vm.disciplinaPriorizacaoSelec="",$scope.turmaPriorizacaoSelecionada=null)},vm.closeModalPriorizacao=function(){$scope.disciplinaSelecionada=null,vm.modalPriorizacao.hide()},vm.listarDisciplinaPriorizacao=async function(){let params={codAluno:alunoSelecionado.codAluno,codDisciplina:$scope.disciplinaSelecionada.disciplina,disciplinas:vm.config.disciplinasMatriculadas};showLoading(!0),await MatriculaService.listarDisciplinasPriorizacao(params).then(result=>{vm.disciplinasPriorizacao=angular.copy(result),vm.disciplinasPriorizacaoAux=angular.copy(result),showLoading(!1)}).catch(()=>{showLoading(!1),vm.modalPriorizacao.hide()})},vm.listarOpcoesTurmaPriorizacao=function(){if(vm.disciplinaPriorizacaoSelec){let params={codDisciplina:encodeURI(vm.disciplinaPriorizacaoSelec.codDisciplina),codAluno:encodeURI(alunoSelecionado.codAluno)};showLoading(!0),MatriculaService.listarOpcoesTurma(params).then(result=>{vm.opcoesTurmaPriorizacao=angular.copy(result),showLoading(!1)}).catch(err=>{showLoading(!1)})}},vm.removerOpcaoPriorizacao=function(opcaoTurma){let turmaOpcaoDTO={codAluno:alunoSelecionado.codAluno,codDisciplina:$scope.disciplinaSelecionada.disciplina,codTurma:$scope.disciplinaSelecionada.turma,codDisciplinaOpcao:opcaoTurma.disciplina,codTurmaOpcao:[opcaoTurma.turma],opcao:opcaoTurma.opcao,disciplinas:vm.config.disciplinasMatriculadas};showLoading(!0),MatriculaService.removerOpcao(turmaOpcaoDTO).then(async function(result){vm.config.disciplinasMatriculadas=angular.copy(result),atualizarDisciplinaPriorizacaoSelecionada(),vm.disciplinasPriorizacao=[],vm.listaOpcoesAdicionadas.length?angular.forEach(vm.listaOpcoesAdicionadas,added=>{angular.forEach(vm.disciplinasPriorizacaoAux,itemDisciplina=>{added.disciplina!=itemDisciplina.codDisciplina&&vm.disciplinasPriorizacao.push(itemDisciplina)})}):vm.disciplinasPriorizacao=angular.copy(vm.disciplinasPriorizacaoAux),showLoading(!1)}).catch(err=>{showLoading(!1)})},vm.subirDescerPrioridade=function(disciplina,acao){let prioridadeDTO={codAluno:alunoSelecionado.codAluno,codDisciplina:disciplina.disciplinaSubst,codTurma:disciplina.turmaSubst,codDisciplinaOpcao:disciplina.disciplina,codTurmaOpcao:disciplina.turma,disciplinas:vm.config.disciplinasMatriculadas},params={acao:acao};showLoading(!0),MatriculaService.subirDescerPrioridade(params,prioridadeDTO).then(result=>{vm.config.disciplinasMatriculadas=angular.copy(result),atualizarDisciplinaPriorizacaoSelecionada(),showLoading(!1)}).catch(err=>{showLoading(!1)})},vm.selecionarTurmaPriorizacao=function(turma){angular.forEach(vm.opcoesTurmaPriorizacao,element=>{element.selecionado&&turma.disciplina!=element.disciplina&&(element.selecionado=!1)}),turma.selecionado?$scope.turmaPriorizacaoSelecionada=turma:$scope.turmaPriorizacaoSelecionada=null},vm.incluirOpcaoDisciplinaPriorizacao=function(){if(!$scope.turmaPriorizacaoSelecionada)return void Notification.warning("É necessário selecionar uma turma.");let turmaOpcaoDTO={codAluno:alunoSelecionado.codAluno,codDisciplinaSubst:$scope.disciplinaSelecionada.disciplina,codTurmaSubst:$scope.disciplinaSelecionada.turma,codDisciplinaOpcao:$scope.turmaPriorizacaoSelecionada.disciplina,codTurmaOpcao:[$scope.turmaPriorizacaoSelecionada.turma],anoOpcao:[$scope.turmaPriorizacaoSelecionada.ano],semestreOpcao:[$scope.turmaPriorizacaoSelecionada.semestre],disciplinas:vm.config.disciplinasMatriculadas};showLoading(!0),MatriculaService.incluirOpcao(turmaOpcaoDTO).then(result=>{vm.config.disciplinasMatriculadas=angular.copy(result),atualizarDisciplinaPriorizacaoSelecionada(),angular.forEach(vm.disciplinasPriorizacao,(element,key)=>{element.codDisciplina==$scope.turmaPriorizacaoSelecionada.disciplina&&vm.disciplinasPriorizacao.splice(key,1)}),vm.setSectionActiveInModal("DISCIPLINAS"),showLoading(!1)})},vm.trocarTurmaMatricula=function(){if($scope.turmasSelecionadasTroca=[],angular.forEach(vm.listaTurmasTroca,itens=>{angular.forEach(itens,element=>{element.turmaSelecionada&&$scope.turmasSelecionadasTroca.push(element)})}),$scope.turmasSelecionadasTroca.length){let matriculaTD={codAluno:alunoSelecionado.codAluno,codDisciplinaAntigo:$scope.disciplinaSelecionada.codDisciplina,codTurmaAntigo:$scope.disciplinaSelecionada.codTurma,turmas:$scope.turmasSelecionadasTroca.map(item=>item.turma),niveisTurma:$scope.turmasSelecionadasTroca.map(item=>item.numNivel),disciplinasList:vm.config.disciplinasMatriculadas,proxPeriodo:"S"==vm.config.configMatricula.matricula_prox_periodo};showLoading(!0),MatriculaService.trocarTurmaMatricula(matriculaTD).then(result=>{for(let j=0;j<result.length;j++)result[j].disciplina==$scope.disciplinaSelecionada.codDisciplina&&null!==result[j].inicioTurma&&void 0!==result[j].inicioTurma&&(result[j].inicioTurma=moment(result[j].inicioTurma).local().format("YYYY-MM-DD HH:mm:ss.SSS"),null!==result[j].fimTurma&&void 0!==result[j].fimTurma&&(result[j].fimTurma=moment(result[j].fimTurma).local().format("YYYY-MM-DD HH:mm:ss.SSS")));$scope.disciplinaSelecionada=null,Storage.set("disciplinasMatriculadas",JSON.stringify(result)),vm.config.disciplinasMatriculadas=angular.copy(result),obterDadosQuadroHorario(vm.config),vm.closeModalEdit()},err=>{vm.closeModalEdit(),showLoading(!1)})}else Notification.warning("Nenhuma turma selecionada para troca.")},vm.trocarTurmaDisciplinaEquivalente=function(){if($scope.disciplinasEquivalentesSelecionadas.length){let matriculaTD={codAluno:alunoSelecionado.codAluno,codDisciplinaAntigo:$scope.disciplinaSelecionada.codDisciplina,codTurmaAntigo:$scope.disciplinaSelecionada.codTurma,turmas:$scope.disciplinasEquivalentesSelecionadas.map(item=>item.turma),niveisTurma:$scope.disciplinasEquivalentesSelecionadas.map(item=>item.numNivel),disciplinas:$scope.disciplinasEquivalentesSelecionadas.map(item=>item.disciplina),grupos:$scope.disciplinasEquivalentesSelecionadas.map(item=>item.grupo),disciplinasList:vm.config.disciplinasMatriculadas,proxPeriodo:"S"==vm.config.configMatricula.matricula_prox_periodo};showLoading(!0),MatriculaService.trocarTurmaDisciplinaEquivalente(matriculaTD).then(result=>{for(let j=0;j<result.length;j++)result[j].disciplina==$scope.disciplinaSelecionada.codDisciplina&&null!==result[j].inicioTurma&&void 0!==result[j].inicioTurma&&(result[j].inicioTurma=moment(result[j].inicioTurma).local().format("YYYY-MM-DD HH:mm:ss.SSS"),null!==result[j].fimTurma&&void 0!==result[j].fimTurma&&(result[j].fimTurma=moment(result[j].fimTurma).local().format("YYYY-MM-DD HH:mm:ss.SSS")));$scope.disciplinaSelecionada=null,$scope.disciplinasEquivalentesSelecionadas=[],Storage.set("disciplinasMatriculadas",JSON.stringify(result)),vm.config.disciplinasMatriculadas=angular.copy(result),obterDadosQuadroHorario(vm.config),vm.closeModalEdit()},err=>{vm.closeModalEdit(),showLoading(!1)})}else Notification.warning("Nenhuma disciplina selecionada para troca.")},vm.simularValores=function(){let preMatricula=!1;vm.config.configMatricula.tipomatricula&&vm.config.configMatricula.tipomatricula.toLowerCase().startsWith("p")&&vm.config.configMatricula.tipomatricula.includes("-")&&(preMatricula=!0);let matriculaTD={codAluno:alunoSelecionado.codAluno,ano:configMatricula.ano,periodo:configMatricula.periodo,preMatricula:preMatricula,disciplinasList:vm.config.disciplinasMatriculadas};showLoading(!0),MatriculaService.listarValoresSimulacao(matriculaTD).then(result=>{vm.listaValores=angular.copy(result),showLoading(!1),vm.modalValores.show()},err=>{vm.modalValores.hide(),showLoading(!1)})},vm.confirmarMatricula=function(){let params={codAluno:alunoSelecionado.codAluno,disciplinasList:vm.config.disciplinasMatriculadas};MatriculaService.confirmarMatricula(params).then(result=>{Storage.set("disciplinasMatriculadas",null)},err=>{showLoading(!1)})},vm.desfazerAlteracoes=function(){showLoading(!0),Storage.set("disciplinasMatriculadas",null),obterDisciplinasMatriculadas(),$location.hash("quadro")}}]),angular.module("custom.controllers").controller("MatriculaContratoController",["$scope","SessionData","MatriculaService","TypeEnum","$translate","$ionicLoading","$q","$ionicScrollDelegate","$state","$timeout","Notification","FileSaver",function($scope,SessionData,MatriculaService,TypeEnum,$translate,$ionicLoading,$q,$ionicScrollDelegate,$state,$timeout,Notification,FileSaver){let vm=this,aluno=SessionData.aluno.list[0],matriculaController=$scope.vm.parentScope.vm,configMatricula=matriculaController.configMatricula.config,adjustWizardScroll=(matriculaController.configMatricula.config,$scope.vm.parentScope.adjustWizardScroll);function showLoading(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1})}showLoading(),vm.instrucoes=configMatricula.instrucoes;let idioma=$translate.use();"pt_br"!==idioma?(vm.instrucoes=configMatricula[`contrato_instr_${idioma}`]?configMatricula[`contrato_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],vm.instrucoes||(vm.instrucoes=configMatricula.contrato_instr?configMatricula.contrato_instr:configMatricula.instrucoes)):vm.instrucoes=configMatricula.contrato_instr?configMatricula.contrato_instr:configMatricula.instrucoes,vm.base64ToArrayBuffer=function(data){for(var binaryString=window.atob(data),binaryLen=binaryString.length,bytes=new Uint8Array(binaryLen),i=0;i<binaryLen;i++){var ascii=binaryString.charCodeAt(i);bytes[i]=ascii}return bytes},$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){"home.matricula.contrato"==fromState.name&&"home.matricula.contrato"!=toState.name&&(matriculaController.additionalButton={enabled:!1})}),MatriculaService.existeContratoAceito(aluno,configMatricula).then(function(existeContratoAceito){existeContratoAceito.existeContratoAceito?MatriculaService.buscaContratoImagemAluno(aluno,configMatricula).then(function(contratoImagemAluno){vm.contrato=contratoImagemAluno,vm.hash=contratoImagemAluno.codigoHash,matriculaController.contratoAceito=contratoImagemAluno,matriculaController.cancelButton.caption="html"===vm.contrato.extensaoContrato?"Aluno.Matricula.Contrato.ImprimirPDF":"Aluno.Matricula.Contrato.DownloadPDF",buttonsWizardMatricula(),$ionicLoading.hide(),adjustWizardScroll()},function(){$state.go("home.avisos",{},{reload:!1})}):MatriculaService.gerarContratoAlunoRollback({codAluno:aluno.codAluno,ano:configMatricula.ano,periodo:configMatricula.periodo,geraDivida:"S"==configMatricula.gerar_divida,ehContratoEmAjuste:!1,tipoMatricula:configMatricula.tipomatricula,progressaoJaRealizada:"S"==configMatricula.progressaojarealizada,ehMatriculaOnline:!0,geraEmHtml:!0,boletoSemAceite:"S"==configMatricula.boleto_sem_aceite}).then(function(contratoImagemAluno){vm.contrato=contratoImagemAluno,vm.assinaturaEletronica="S"==contratoImagemAluno.assinaturaEletronica,vm.msgAssEletronica=contratoImagemAluno.msgAssEletronica,vm.contrato.imagem=vm.contrato.imagem?vm.contrato.imagem:".",vm.hash=null,buttonsWizardMatricula(),$ionicLoading.hide(),adjustWizardScroll()},function(){$state.go("home.avisos",{},{reload:!1})}),buttonsWizardMatricula=function(){vm.assinaturaEletronica?matriculaController.finalButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green w-50",enabled:!0,onClick:function(){let deferr=$q.defer();return deferr.resolve(),deferr.promise}}:"S"!=configMatricula.aceite||existeContratoAceito.existeContratoAceito?(matriculaController.additionalButton={enabled:!1},matriculaController.cancelButton={caption:matriculaController.cancelButton.caption,style:"button-green btn-padrao-redondo",enabled:!0,onClick:function(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1});let bytesContrato=vm.contrato&&vm.contrato.imagemBin?vm.contrato.imagemBin:null;if(bytesContrato){let fileExtension=vm.contrato.extensaoContrato?vm.contrato.extensaoContrato.toLowerCase():"";fileExtension=fileExtension.startsWith(".")?fileExtension:"."+fileExtension;let fileName="contrato_"+vm.contrato.idContratoAluno+fileExtension,fileType="application/octet-stream";switch(fileExtension){case".pdf":fileType="application/pdf";break;case".doc":fileType="application/msword";break;case".docx":fileType="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case".jpeg":fileType="image/jpeg";break;default:fileType="application/octet-stream"}let arquivo=new Blob([vm.base64ToArrayBuffer(bytesContrato)],{type:fileType});FileSaver.saveAs(arquivo,fileName)}else if(vm.contrato.htmlContrato){let myblob=new Blob([vm.contrato.htmlContrato],{type:"text/html;charset=UTF-8",encoding:"UTF-8"}),date=new Date,fileName=$translate.instant("Aluno.Matricula.Contrato")+" - "+date.getTime()+".html";FileSaver.saveAs(myblob,fileName)}else Notification.error($translate.instant("Aluno.Matricula.Contrato.SemConteudo"));$ionicLoading.hide()}},matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green w-50",enabled:!0,onClick:function(){let deferr=$q.defer();return deferr.resolve(),deferr.promise}}):(matriculaController.additionalButton={caption:"Aluno.Matricula.Contrato.DownloadPDF",style:"btn-contrato-matricula btn-contrato-matricula-download",enabled:!0,onClick:function(){var myblob=new Blob([vm.contrato.htmlContrato],{type:"text/html;charset=UTF-8",encoding:"UTF-8"}),fileName="Contrato - "+(new Date).getTime()+".html";FileSaver.saveAs(myblob,fileName)}},matriculaController.cancelButton={caption:"Aluno.Matricula.Wizard.Recusar",style:"btn-contrato-matricula btn-contrato-matricula-recusar",enabled:!0,onClick:function(){let deferr=$q.defer();return showLoading(),MatriculaService.aceitarContratoAluno(!1,configMatricula,vm.contrato,aluno).then(function(contratoAceito){$ionicLoading.hide(),deferr.reject(),Notification.error($translate.instant("Aluno.Matricula.Contrato.Negado")),$state.go("home.avisos",{},{reload:!0})}),deferr.promise}},matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.AceitarProsseguir",style:"btn-contrato-matricula btn-contrato-matricula-aceitar btn-prosseguir",enabled:!0,onClick:function(){let deferr=$q.defer();return showLoading(),MatriculaService.aceitarContratoAluno(!0,configMatricula,vm.contrato,aluno).then(function(contratoAceito){matriculaController.contratoAceito=contratoAceito,deferr.resolve(),$ionicLoading.hide()}),deferr.promise}},matriculaController.finalButton={caption:"Aluno.Matricula.Wizard.Aceitar",style:"btn-contrato-matricula btn-contrato-matricula-aceitar",enabled:!0,onClick:function(){let deferr=$q.defer();return showLoading(),MatriculaService.aceitarContratoAluno(!0,configMatricula,vm.contrato,aluno).then(function(contratoAceito){matriculaController.contratoAceito=contratoAceito,deferr.resolve(),$ionicLoading.hide()}),deferr.promise}})}},function(){$state.go("home.avisos",{},{reload:!1})})}]),angular.module("custom.controllers").controller("MatriculaRequerimentoController",["$rootScope","PagamentoCartaoFactory","Storage","AonlineUtils","CartaoService","DownloadArquivo","$state","$scope","SessionData","MatriculaService","$ionicModal","TypeEnum","$translate","$ionicLoading","$q","$ionicScrollDelegate","Configs","Notification","$timeout","FileSaver",function($rootScope,PagamentoCartaoFactory,Storage,AonlineUtils,CartaoService,DownloadArquivo,$state,$scope,SessionData,MatriculaService,$ionicModal,TypeEnum,$translate,$ionicLoading,$q,$ionicScrollDelegate,Configs,Notification,$timeout,FileSaver){let vm=this,aluno=SessionData.aluno.list[0],matriculaController=$scope.vm.parentScope.vm,configMatricula=matriculaController.configMatricula.config,adjustWizardScroll=$scope.vm.parentScope.adjustWizardScroll;AonlineUtils.showLoading(!0),$scope.$on("onPaymentClickBroadcast",function(event,args){vm.pagamentoCartao()}),$scope.$on("onPixPaymentClickBroadcast",function(event,args){vm.pagamentoPix()}),vm.base64ToArrayBuffer=function(data){for(var binaryString=window.atob(data),binaryLen=binaryString.length,bytes=new Uint8Array(binaryLen),i=0;i<binaryLen;i++){var ascii=binaryString.charCodeAt(i);bytes[i]=ascii}return bytes},matriculaController.cancelButton={caption:"Aluno.Matricula.Requerimento.Imprimir",style:"button-blue btn-padrao-redondo w-28",enabled:"S"===configMatricula.exibe_requerim,onClick:function(){MatriculaService.obterRequerimentoAluno(aluno,configMatricula).then(function(retorno){if(null!==retorno.requerimentoPDF){var arquivo=new Blob([vm.base64ToArrayBuffer(retorno.requerimentoPDF)],{type:"application/pdf"});FileSaver.saveAs(arquivo,"requerimento.pdf")}})}},matriculaController.finalButton={caption:"Aluno.Matricula.Requerimento.Boleto",style:"button-green btn-padrao-redondo w-28",enabled:"S"===configMatricula.exibe_boleto,onClick:function(){let deferr=$q.defer();return vm.visualizarBoleto(),deferr.reject(),deferr.promise}},matriculaController.pagamentoCartaoButton={style:"btn-padrao-redondo"},matriculaController.pixButton={style:"btn-padrao-redondo"};let idBoleto=0;vm.contratoAceito=!1,vm.contratoPendente=!1,matriculaController.contratoAceito&&(idBoleto=matriculaController.contratoAceito.idBoletoAluno?matriculaController.contratoAceito.idBoletoAluno:0,vm.contratoAceito=!0),vm.contratoAceito||"N"==configMatricula.aceite||(vm.contratoPendente=!0),MatriculaService.validarPremissaoCartaoMatricula(aluno.codAluno,idBoleto).then(function(retorno){matriculaController.pagamentoButton=retorno.valor}),1==Storage.get("enablePix")&&0!=idBoleto&&(matriculaController.showPix=!0),vm.instrucoes=configMatricula.instrucoes;let requerimentoAlunoProm,contratoImagemAlunoProm,idioma=$translate.use();async function obterCobrancasPagamento(){return await MatriculaService.obterDadosPagarMatriculaCartao(aluno,vm.boleto).then(function(retorno){return cobrancas={valorDocumento:retorno.cartaoValorDocumento,origem:retorno.cartaoOrigem,dataCalculoValor:retorno.cartaoDataCalculoValor,codResponsavelFinanceiro:retorno.cartaoCodRespFinan,opcaoPgtoCartao:retorno.cartaoOpcaoPgto,cobrancasConcatenadas:retorno.cartaoCobrancasSelecionadas,cartaoItensCobrancas:retorno.cartaoItensCobrancas,valorSelecionado:retorno.cartaoValorOriginalDocumento,encargoCalculado:retorno.cartaoEncargoDocumento,encargoBolsa:retorno.cartaoEncargoBolsaDocumento,descontoAdiantamentoCalculado:retorno.cartaoDescontoDocumento}}).catch(function(){Notification.error($translate.instant("General.ErrorNotSpecified"))})}"pt_br"!==idioma?(vm.instrucoes=configMatricula[`requerim_instr_${idioma}`]?configMatricula[`requerim_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],vm.instrucoes||(vm.instrucoes=configMatricula.requerim_instr?configMatricula.requerim_instr:configMatricula.instrucoes)):vm.instrucoes=configMatricula.requerim_instr?configMatricula.requerim_instr:configMatricula.instrucoes,"N"!==configMatricula.exibe_requerim&&(requerimentoAlunoProm=MatriculaService.obterRequerimentoAluno(aluno,configMatricula)),("N"!==configMatricula.contrato_habilit&&"N"!==configMatricula.aceite||vm.contratoAceito)&&(contratoImagemAlunoProm=MatriculaService.buscaContratoImagemAluno(aluno,configMatricula)),$q.all([requerimentoAlunoProm,contratoImagemAlunoProm]).then(function(retorno){let obterRequerimentoAluno,contratoImagemAluno=retorno[1];null!=contratoImagemAluno&&null!=contratoImagemAluno&&vm.contratoAceito&&(vm.hash=contratoImagemAluno.codigoHash),vm.requerimentoExibe=configMatricula.exibe_requerim,"N"!==configMatricula.exibe_requerim&&(obterRequerimentoAluno=retorno[0],vm.requerimentoAluno=obterRequerimentoAluno.requerimentoMatricula)}),matriculaController.contratoAceito&&matriculaController.contratoAceito.idBoletoAluno?(vm.boleto=matriculaController.contratoAceito.idBoletoAluno,AonlineUtils.showLoading(!1)):"N"==matriculaController.configMatricula.config.gerar_divida?AonlineUtils.showLoading(!1):MatriculaService.gerarBoletoMatricula(aluno,configMatricula).then(function(gerarBoletoMatricula){vm.boleto=gerarBoletoMatricula.boleto,gerarBoletoMatricula.boleto&&MatriculaService.verificarImpressaoBoleto(aluno,configMatricula,vm.boleto).then(function(verificarImpressaoBoleto){vm.imprimirBoleto=verificarImpressaoBoleto.imprimeBoletoWebMatricula}),AonlineUtils.showLoading(!1),$timeout(function(){adjustWizardScroll()})}),vm.visualizarBoleto=function(){AonlineUtils.showLoading(!0);let numBoleto=vm.boleto;if(null!=numBoleto){let params={};params.url=Configs.getApiServer()+"/financeiro/codPessoaLogada/"+SessionData.user.id+"/codAluno/"+aluno.codAluno+"/codBoleto/"+numBoleto+"/exibirArquivo/false/obterBoleto/",params.method="GET",DownloadArquivo.downloadArquivo(params)}else AonlineUtils.showLoading(!1),Notification.info("Não existe boleto gerado."),AonlineUtils.showLoading(!1)},$ionicModal.fromTemplateUrl("views/logged/cartao/modal.pagamento.pix.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalPix){vm.modalPix=modalPix}),$scope.closeModal=function(){vm.modalPix.hide()},vm.pagamentoPix=async function(){AonlineUtils.showLoading(!0);let retorno=await obterCobrancasPagamento(),obj={candidato:null,concurso:null,listaDeCobrancas:[retorno.cobrancasConcatenadas],valorTotal:retorno.valorDocumento};vm.modalPix.show(),$scope.$broadcast("startPix",obj)},$scope.copiarPix=function(){Clipboard.isSupported()?(vm.clipboard=new Clipboard("#copy-button"),Notification.success($translate.instant("pix.view.msg.copied"))):Notification.warning($translate.instant("navegador.sem.suporte"))},vm.pagamentoCartao=async function(){AonlineUtils.showLoading(!0);let cobrancas=await obterCobrancasPagamento();PagamentoCartaoFactory.setCobrancasSelecionadas(cobrancas),AonlineUtils.showLoading(!1),$state.go("home.pgtocartao-pagamento")}}]),angular.module("custom.controllers").controller("HistoricoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum){function loading(value){historicoCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}var historicoCtrl=this;historicoCtrl.id="HistoricoController",historicoCtrl.cabecalho=void 0,historicoCtrl.columns=[],historicoCtrl.listaHistorico=[],loading(!0),HistoricoService.listarCabecalhoHistorico().then(function(result){historicoCtrl.cabecalho=result,historicoCtrl.exibeCh=historicoCtrl.cabecalho.exibeCh,historicoCtrl.exibeCreditos=historicoCtrl.cabecalho.exibeCreditos,HistoricoService.listarHistoricoSimplificado().then(function(result){historicoCtrl.columns=[{name:"Aluno.Contrato.Periodo",id:"periodo",type:TypeEnum.STRING},{name:"Aluno.Boletim.Serie",id:"serie",type:TypeEnum.STRING},{name:"Aluno.Boletim.Disciplina",id:"nomeDisciplina",type:TypeEnum.STRING,size:"30%",align:"left"}],historicoCtrl.cabecalho.exibeCreditos&&historicoCtrl.columns.push({name:"Aluno.Dados.Creditos",id:"creditos",type:TypeEnum.STRING}),historicoCtrl.cabecalho.exibeCh&&historicoCtrl.columns.push({name:"Aluno.Dados.CH",id:"cargaHoraria",type:TypeEnum.STRING}),historicoCtrl.columns.push({name:"Aluno.boletim.Media",id:"notaFinal",type:TypeEnum.STRING}),historicoCtrl.columns.push({name:"Aluno.Boletim.Situacao",id:"situacao",type:TypeEnum.STRING}),historicoCtrl.listaHistorico=result,loading(!1)}).catch(function(err){Notification.error(err),loading(!1)})}).catch(function(err){Notification.error(err),historicoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.avisos")})}]),angular.module("custom.controllers").controller("AlunoCadastroController",["$scope","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$q","$log","AlunoCadastroService","UtilService","$ionicLoading","AonlineUtils",function($scope,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$q,$log,AlunoCadastroService,UtilService,$ionicLoading,AonlineUtils){if($scope.bloquearCampos=!1,!angular.isUndefined($scope.vm)){let matriculaController=$scope.vm.parentScope.vm;matriculaController.configMatricula.config;matriculaController.cancelButton={enabled:!1},matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green",enabled:!0,onClick:function(){let deferr=$q.defer();return $scope.atualizarAluno($scope.alunoCadastro,$scope.cadastroForm)||deferr.resolve(),deferr.promise}}}$scope.getWidth=function(){return $(window).width()},angular.element("#cepRes").mask("00000-000"),angular.element("#dddResidencial, #dddCelular, #dddComercial").mask("00000"),angular.element("#cepResResp").mask("00000-000"),angular.element("#dddResidencialResp, #dddCelularResp, #dddComercialResp").mask("00000"),$scope.alunoCadastro={},$scope.respLogadoAlunoCadastro={},$scope.ehResponsavel="responsavel"===SessionData.perfil,$scope.mostraAbaResponsavel=!1,$scope.respFinan={},$scope.abaAtiva="abaPessoal",$scope.currentStep="infoPessoais",$scope.desabilitarSalvar=!1,$scope.desabilitarSalvarRespLogado=!1,$scope.habilitaInputBairro=!1,$scope.habilitaInputBairroResp=!1;var vm=this;vm.id="AlunoCadastroController",AonlineUtils.showLoading(!0);let alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado];var idAluno;function bloquearCamposForm(selectorId){$scope.bloquearCampos=!0,document.querySelectorAll(selectorId+" input").forEach(function(input){input.disabled=!0}),document.querySelectorAll(selectorId+" select").forEach(function(select){select.disabled=!0})}if(vm.showRespTab=!1,idAluno=alunoSelecionado.codAluno,AonlineUtils.showLoading(!0),AlunoCadastroService.obterEnderecoRespFinanAluno(idAluno).then(result=>{null!=result.codigoResp&&(vm.showRespTab=!0,result.codigoPessoa==alunoSelecionado.id?vm.RespTabPodeAlt=!0:vm.RespTabPodeAlt=!1,$scope.respFinan=angular.copy(result),AonlineUtils.showLoading(!1))}).catch(error=>{AonlineUtils.showLoading(!1)}),UtilService.obterUF().then(function(result){$scope.LISTA_UF_RG=result,$scope.LISTA_UF_RG_RESP_LOGADO=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),"home.matricula.cadastro"===$state.current.name){let configMatricula=$scope.vm.parentScope.vm.configMatricula.config;$scope.instrucoes=configMatricula.instrucoes;let idioma=$translate.use();"pt_br"!==idioma?($scope.instrucoes=configMatricula[`cadastro_aluno_instr_${idioma}`]?configMatricula[`cadastro_aluno_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],$scope.instrucoes||($scope.instrucoes=configMatricula.cadastro_aluno_instr?configMatricula.cadastro_aluno_instr:configMatricula.instrucoes)):$scope.instrucoes=configMatricula.cadastro_aluno_instr?configMatricula.cadastro_aluno_instr:configMatricula.instrucoes,configMatricula.bloqueia_edicao_dados_aluno&&"S"===configMatricula.bloqueia_edicao_dados_aluno&&bloquearCamposForm("#cadastroForm")}"home.aluno-cadastro"===$state.current.name&&UtilService.obterOpcoesOnline().then(function(result){result.aol_bloq_edicao_dados_cad&&"S"===result.aol_bloq_edicao_dados_cad?(bloquearCamposForm("#abaPessoal"),bloquearCamposForm("#abaPessoalResponsavel"),$scope.desabilitarSalvar=!0,$scope.desabilitarSalvarRespLogado=!0):($scope.desabilitarSalvar=!1,$scope.habilitaInputBairro=!1,$scope.desabilitarSalvarRespLogado=!1,$scope.habilitaInputBairroResp=!1)}),$scope.LISTA_ESTADOS_END_RES=[],$scope.LISTA_MUNICIPIOS_END_RES=[],$scope.LISTA_BAIRROS_END_RES=[],$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=[],$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=[],$scope.LISTA_ESTADOS_END_RESP=[],$scope.LISTA_MUNICIPIOS_END_RESP=[],$scope.LISTA_BAIRROS_END_RESP=[],$scope.LISTA_ESTADOS_END_COM=[],$scope.LISTA_MUNICIPIOS_END_COM=[],$scope.LISTA_BAIRROS_END_COM=[],$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=[],$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=[],$scope.LISTA_ESTADOS_NASCIMENTO=[],$scope.LISTA_MUNICIPIOS_NASCIMENTO=[],$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[];var campoAba=[{aba:"infoPessoais",campos:[{campo:"naturalidade",nomeCampo:"paisNascimento"},{campo:"nacionalidade",nomeCampo:"Nacionalidade"},{campo:"uf_municipio_nasc",nomeCampo:"UFNascimento"},{campo:"municipio_nasc",nomeCampo:"MunicipioNascimento"},{campo:"sexo",nomeCampo:"Sexo"},{campo:"nomeMae",nomeCampo:"Mae"},{campo:"racaCor",nomeCampo:"RacaCor"},{campo:"estadoCivil",nomeCampo:"EstadoCivil"}]},{aba:"enderecoContato",campos:[{campo:"cep",nomeCampo:"CEP"},{campo:"end_pais",nomeCampo:"Pais"},{campo:"endereco",nomeCampo:"Endereco"},{campo:"end_num",nomeCampo:"Numero"},{campo:"uf_municipio_end",nomeCampo:"UF"},{campo:"nome_end_municipio",nomeCampo:"Cidade"},{campo:"bairro",nomeCampo:"Bairro"},{campo:"DDDTelefoneRes",nomeCampo:"DDDTelefone"},{campo:"fone",nomeCampo:"TelefoneResidencial"},{campo:"emailPessoal",nomeCampo:"EMail"},{campo:"DDDTelefoneCel",nomeCampo:"DDDTelefone"},{campo:"celular",nomeCampo:"TelefoneCelular"}]},{aba:"enderecoContatoComercial",campos:[{campo:"ddd_fone_comercial",nomeCampo:"DDDTelefone"},{campo:"fone_com",nomeCampo:"Label.Telefone"}]},{aba:"documentosPessoais",campos:[{campo:"numRG",nomeCampo:"RG"},{campo:"orgExpRg",nomeCampo:"OrgaoExpedidorDoRg"},{campo:"rg_uf",nomeCampo:"UF"},{campo:"rg_dtexp",nomeCampo:"DataExpedicaoDoRg"}]},{aba:"infoPessoaisResponsavelLogado",campos:[{campo:"naturalidadeRespLogado",nomeCampo:"paisNascimento"},{campo:"nacionalidadeRespLogado",nomeCampo:"Nacionalidade"},{campo:"uf_municipio_nasc_resp_logado",nomeCampo:"UFNascimento"},{campo:"municipio_nasc_resp_logado",nomeCampo:"MunicipioNascimento"},{campo:"sexoRespLogado",nomeCampo:"Sexo"},{campo:"nomeMaeRespLogado",nomeCampo:"Mae"},{campo:"racaCorRespLogado",nomeCampo:"RacaCor"},{campo:"estadoCivilRespLogado",nomeCampo:"EstadoCivil"}]},{aba:"enderecoContatoRespLogado",campos:[{campo:"cepRespLogado",nomeCampo:"CEP"},{campo:"end_pais_resp_logado",nomeCampo:"Pais"},{campo:"enderecoRespLogado",nomeCampo:"Endereco"},{campo:"end_num_resp_logado",nomeCampo:"Numero"},{campo:"uf_municipio_end_resp_logado",nomeCampo:"UF"},{campo:"nome_end_municipio_resp_logado",nomeCampo:"Cidade"},{campo:"bairroRespLogado",nomeCampo:"Bairro"},{campo:"DDDTelefoneResRespLogado",nomeCampo:"DDDTelefone"},{campo:"foneRespLogado",nomeCampo:"TelefoneResidencial"},{campo:"emailPessoalRespLogado",nomeCampo:"EMail"},{campo:"DDDTelefoneCelRespLogado",nomeCampo:"DDDTelefone"},{campo:"celularRespLogado",nomeCampo:"TelefoneCelular"}]},{aba:"enderecoContatoComercialRespLogado",campos:[{campo:"ddd_fone_comercial_resp_logado",nomeCampo:"DDDTelefone"},{campo:"fone_com_resp_logado",nomeCampo:"Label.Telefone"}]},{aba:"documentosPessoaisRespLogado",campos:[{campo:"numRGRespLogado",nomeCampo:"RG"},{campo:"orgExpRgLogado",nomeCampo:"OrgaoExpedidorDoRg"},{campo:"rg_uf_resp_logado",nomeCampo:"UF"},{campo:"rg_dtexp_resp_logado",nomeCampo:"DataExpedicaoDoRg"}]}];function formatarDatasUTC(){$scope.alunoCadastro.dt_nasc&&($scope.alunoCadastro.dt_nasc=new Date($scope.alunoCadastro.dt_nasc)),$scope.alunoCadastro.cert_nasc&&($scope.alunoCadastro.cert_nasc=new Date($scope.alunoCadastro.cert_nasc)),$scope.alunoCadastro.rg_dtexp&&($scope.alunoCadastro.rg_dtexp=new Date($scope.alunoCadastro.rg_dtexp)),$scope.alunoCadastro.teleitor_dtexp&&$scope.alunoCadastro.alist_dtexp&&($scope.alunoCadastro.teleitor_dtexp=new Date($scope.alunoCadastro.teleitor_dtexp),$scope.alunoCadastro.alist_dtexp=new Date($scope.alunoCadastro.alist_dtexp))}function formatarDatasRespUTC(){$scope.respLogadoAlunoCadastro.dt_nasc&&($scope.respLogadoAlunoCadastro.dt_nasc=new Date($scope.respLogadoAlunoCadastro.dt_nasc)),$scope.respLogadoAlunoCadastro.cert_nasc&&($scope.respLogadoAlunoCadastro.cert_nasc=new Date($scope.respLogadoAlunoCadastro.cert_nasc)),$scope.respLogadoAlunoCadastro.rg_dtexp&&($scope.respLogadoAlunoCadastro.rg_dtexp=new Date($scope.respLogadoAlunoCadastro.rg_dtexp)),$scope.respLogadoAlunoCadastro.teleitor_dtexp&&$scope.respLogadoAlunoCadastro.alist_dtexp&&($scope.respLogadoAlunoCadastro.teleitor_dtexp=new Date($scope.respLogadoAlunoCadastro.teleitor_dtexp),$scope.respLogadoAlunoCadastro.alist_dtexp=new Date($scope.respLogadoAlunoCadastro.alist_dtexp))}if(AlunoCadastroService.obterAlunoSessao().then(function(result){if($scope.alunoSessao=result,AonlineUtils.showLoading(!1),void 0!==result&&void 0!==result.dados&&1===result.dados.length){var codAluno=result.dados[0].codigoAluno;$scope.alunoSessao.alunoSelecionado=codAluno,obterDadosAcademicos(codAluno)}else{codAluno=SessionData.aluno.list[0].codAluno;$scope.alunoSessao.alunoSelecionado=codAluno,obterDadosAcademicos(codAluno)}}).catch(function(err){Notification.error(err),vm.loading=!1,AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.aluno-cadastro")}),AlunoCadastroService.obterDadosPessoa().then(function(result){$scope.alunoCadastro=result,AlunoCadastroService.obterAluno($scope.alunoSessao.alunoSelecionado).then(function(retornoAluno){$scope.alunoCadastro.tipo_escola=retornoAluno.tipo_escola}).catch(function(err){Notification.error(err),vm.loading=!1,AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.aluno-cadastro")}),formatarDatasUTC(),$scope.carregaEnderecoNascimento(),$scope.carregarEnderecoResidencial(),$scope.carregarEnderecoComercial(),$scope.carregarEnderecoRespFinan(),validarCamposDesabilit(),AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),vm.loading=!1,AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.aluno-cadastro")}),SessionData.aluno){var codPessoaLogada=SessionData.user.id;null!=codPessoaLogada&&""!=codPessoaLogada&&null!=codPessoaLogada&&codPessoaLogada!=SessionData.aluno.list[SessionData.aluno.selecionado].id&&($scope.mostraAbaResponsavel=!0,AonlineUtils.showLoading(!0),AlunoCadastroService.obterDadosPessoaLogada(codPessoaLogada).then(function(result){$scope.respLogadoAlunoCadastro=result,formatarDatasRespUTC(),$scope.carregaEnderecoNascimentoRespLogado(),$scope.carregarEnderecoResidencialRespLogado(),$scope.carregarEnderecoComercialRespLogado(),validarCamposDesabilitRespLogado(),AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),vm.loading=!1,AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.aluno-cadastro")}))}function validarCamposDesabilit(){$scope.alunoCadastro.cpf&&($scope.alunoCadastro.disabledCpf=!0),$scope.alunoCadastro.resp_cpf&&($scope.alunoCadastro.disabledRespCpf=!0),$scope.alunoCadastro.nome_compl&&($scope.alunoCadastro.disabledNomeCompl=!0),$scope.alunoCadastro.nome_abrev&&($scope.alunoCadastro.disabledNomeAbrev=!0),$scope.alunoCadastro.dt_nasc&&($scope.alunoCadastro.disabledDtNasc=!0),$scope.alunoCadastro.sexo&&($scope.alunoCadastro.disabledSexo=!0),$timeout(function(){"00000000000"!==$scope.alunoCadastro.cpf&&"00000000000"!==$scope.alunoCadastro.resp_cpf&&validarCPFs()},500)}function validarCamposDesabilitRespLogado(){$scope.respLogadoAlunoCadastro.cpf&&($scope.respLogadoAlunoCadastro.disabledCpf=!0),$scope.respLogadoAlunoCadastro.resp_cpf&&($scope.respLogadoAlunoCadastro.disabledRespCpf=!0),$scope.respLogadoAlunoCadastro.nome_compl&&($scope.respLogadoAlunoCadastro.disabledNomeCompl=!0),$scope.respLogadoAlunoCadastro.nome_abrev&&($scope.respLogadoAlunoCadastro.disabledNomeAbrev=!0),$scope.respLogadoAlunoCadastro.dt_nasc&&($scope.respLogadoAlunoCadastro.disabledDtNasc=!0),$scope.respLogadoAlunoCadastro.sexo&&($scope.respLogadoAlunoCadastro.disabledSexo=!0),$timeout(function(){"00000000000"!==$scope.respLogadoAlunoCadastro.cpf&&"00000000000"!==$scope.respLogadoAlunoCadastro.resp_cpf&&function(){if(vm.cadastroForm&&vm.cadastroForm.$error&&vm.cadastroForm.$error.cpf)for(let i=0;i<vm.cadastroForm.$error.cpf.length;i++)"cpf_aluno_resp_logado"==vm.cadastroForm.$error.cpf[i].$name&&(Notification.error($translate.instant("CPF do Responsável Inválido")),$scope.respLogadoAlunoCadastro.disabledCpf=!1)}()},500)}function validarCPFs(){if(vm.cadastroForm&&vm.cadastroForm.$error&&vm.cadastroForm.$error.cpf)for(let i=0;i<vm.cadastroForm.$error.cpf.length;i++)"cpf_aluno"==vm.cadastroForm.$error.cpf[i].$name?(Notification.error($translate.instant("CPF do Aluno Inválido")),$scope.alunoCadastro.disabledCpf=!1):"cpf_resp"==vm.cadastroForm.$error.cpf[i].$name&&(Notification.error($translate.instant("CPF do Responsável Legal Inválido")),$scope.alunoCadastro.disabledRespCpf=!1)}function obterDadosAcademicos(codAluno){null!=codAluno&&""!==codAluno&&AonlineUtils.showLoading(!0),AlunoCadastroService.obterDadosAcademicos(codAluno).then(function(result){$scope.alunoDadosAcademicos=result,AlunoCadastroService.obterSituacaoDocumentos(codAluno).then(function(result){$scope.alunoSituacaoDocumentos=result,AonlineUtils.showLoading(!1)}).catch(function(err){AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}).catch(function(err){AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}function retornoErro(erro){Notification.error(erro),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}function preencherCamposEndereco(tipoEndereco){switch(tipoEndereco){case"R":$scope.alunoCadastro.endereco=$scope.endereco.txbLogradouro,$scope.alunoCadastro.end_num=$scope.endereco.txbNumero,$scope.alunoCadastro.end_compl=$scope.endereco.txbComplemento,$scope.alunoCadastro.bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.alunoCadastro.end_municipio=$scope.endereco.srbCidade,$scope.alunoCadastro.nome_end_municipio=$scope.endereco.nomeMunicipio,$scope.alunoCadastro.uf_municipio_end=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_RES=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_RES=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_RES=$scope.listaBairros,$scope.loadCodigoCidade();break;case"RR":$scope.respLogadoAlunoCadastro.endereco=$scope.endereco.txbLogradouro,$scope.respLogadoAlunoCadastro.end_num=$scope.endereco.txbNumero,$scope.respLogadoAlunoCadastro.end_compl=$scope.endereco.txbComplemento,$scope.respLogadoAlunoCadastro.bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.respLogadoAlunoCadastro.end_municipio=$scope.endereco.srbCidade,$scope.respLogadoAlunoCadastro.nome_end_municipio=$scope.endereco.nomeMunicipio,$scope.respLogadoAlunoCadastro.uf_municipio_end=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=$scope.listaBairros,$scope.loadCodigoCidade();break;case"C":$scope.alunoCadastro.endcom=$scope.endereco.txbLogradouro,$scope.alunoCadastro.endcom_num=$scope.endereco.txbNumero,$scope.alunoCadastro.endcom_compl=$scope.endereco.txbComplemento,$scope.alunoCadastro.endcom_bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.alunoCadastro.endcom_municipio=$scope.endereco.srbCidade,$scope.alunoCadastro.cidadecomercial=$scope.endereco.nomeMunicipio,$scope.alunoCadastro.uf_endcom_municipio=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_COM=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_COM=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_COM=$scope.listaBairros;break;case"CR":$scope.respLogadoAlunoCadastro.endcom=$scope.endereco.txbLogradouro,$scope.respLogadoAlunoCadastro.endcom_num=$scope.endereco.txbNumero,$scope.respLogadoAlunoCadastro.endcom_compl=$scope.endereco.txbComplemento,$scope.respLogadoAlunoCadastro.endcom_bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.respLogadoAlunoCadastro.endcom_municipio=$scope.endereco.srbCidade,$scope.respLogadoAlunoCadastro.cidadecomercial=$scope.endereco.nomeMunicipio,$scope.respLogadoAlunoCadastro.uf_endcom_municipio=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=$scope.listaBairros;break;case"RF":$scope.respFinan.endereco=$scope.endereco.txbLogradouro,$scope.respFinan.numero=$scope.endereco.txbNumero,$scope.respFinan.complemento=$scope.endereco.txbComplemento,$scope.respFinan.bairro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,$scope.respFinan.municipio=$scope.endereco.municipio,$scope.respFinan.nomeMunicipio=$scope.endereco.nomeMunicipio,$scope.respFinan.ufSigla=$scope.endereco.ufSigla,$scope.LISTA_ESTADOS_END_RESP=$scope.listaEstados,$scope.LISTA_MUNICIPIOS_END_RESP=$scope.listaMunicipios,$scope.LISTA_BAIRROS_END_RESP=$scope.listaBairros}}function limparCamposEndereco(tipoEndereco){switch(tipoEndereco){case"R":$scope.alunoCadastro.endereco="",$scope.alunoCadastro.end_num="",$scope.alunoCadastro.end_compl="",$scope.alunoCadastro.bairro="",$scope.alunoCadastro.end_municipio="",$scope.alunoCadastro.nome_end_municipio="",$scope.alunoCadastro.uf_municipio_end="",$scope.LISTA_ESTADOS_END_RES=[],$scope.LISTA_MUNICIPIOS_END_RES=[],$scope.LISTA_BAIRROS_END_RES=[];break;case"RR":$scope.respLogadoAlunoCadastro.endereco="",$scope.respLogadoAlunoCadastro.end_num="",$scope.respLogadoAlunoCadastro.end_compl="",$scope.respLogadoAlunoCadastro.bairro="",$scope.respLogadoAlunoCadastro.end_municipio="",$scope.respLogadoAlunoCadastro.nome_end_municipio="",$scope.respLogadoAlunoCadastro.uf_municipio_end="",$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=[],$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=[];break;case"C":$scope.alunoCadastro.endcom="",$scope.alunoCadastro.endcom_num="",$scope.alunoCadastro.endcom_compl="",$scope.alunoCadastro.endcom_bairro="",$scope.alunoCadastro.endcom_municipio="",$scope.alunoCadastro.cidadecomercial="",$scope.alunoCadastro.estadoComercial="",$scope.LISTA_ESTADOS_END_COM=[],$scope.LISTA_MUNICIPIOS_END_COM=[],$scope.LISTA_BAIRROS_END_COM=[];break;case"CR":$scope.respLogadoAlunoCadastro.endcom="",$scope.respLogadoAlunoCadastro.endcom_num="",$scope.respLogadoAlunoCadastro.endcom_compl="",$scope.respLogadoAlunoCadastro.endcom_bairro="",$scope.respLogadoAlunoCadastro.endcom_municipio="",$scope.respLogadoAlunoCadastro.cidadecomercial="",$scope.respLogadoAlunoCadastro.estadoComercial="",$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=[],$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=[];break;case"RF":$scope.respFinan.endereco="",$scope.respFinan.numero="",$scope.respFinan.complemento="",$scope.respFinan.bairro="",$scope.respFinan.municipio="",$scope.respFinan.nomeMunicipio="",$scope.respFinan.ufSigla="",$scope.LISTA_ESTADOS_END_RESP=[],$scope.LISTA_MUNICIPIOS_END_RESP=[],$scope.LISTA_BAIRROS_END_RESP=[];break;case"N":$scope.LISTA_ESTADOS_NASCIMENTO=[],$scope.LISTA_MUNICIPIOS_NASCIMENTO=[];break;case"NR":$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO=[],$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[]}}AlunoCadastroService.obterAlunoSessao().then(function(result){if($scope.alunoSessao=result,AonlineUtils.showLoading(!1),void 0!==result&&void 0!==result.dados&&1===result.dados.length){var codAluno=result.dados[0].codigoAluno;$scope.alunoSessao.alunoSelecionado=codAluno,obterDadosAcademicos(codAluno)}else{codAluno=SessionData.aluno.list[0].codAluno;$scope.alunoSessao.alunoSelecionado=codAluno,obterDadosAcademicos(codAluno)}}).catch(function(err){Notification.error(err),vm.loading=!1,AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("home.aluno-cadastro")}),UtilService.obterSexo().then(function(result){$scope.sexos=result}).catch(function(err){console.log(err)}),UtilService.obterTiposEscola().then(function(result){$scope.tiposEscola=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterOrgaoEmissor().then(function(result){$scope.orgaosEmissores=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterNecessidadeEspecial().then(function(result){$scope.necessidadesEspeciais=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterCredo().then(function(result){$scope.credos=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterPais().then(function(result){$scope.paises=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterNacionalidade().then(function(result){$scope.nacionalidades=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterProfissao().then(function(result){$scope.profissoes=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterEstadoCivil().then(function(result){$scope.estadoCivil=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterCores().then(function(result){$scope.cores=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.validarCampoNaoVazio=function(valorCampo){return""!==valorCampo&&null!=valorCampo},$scope.alphaOnly=function(event){angular.element(event)[0].value=angular.element(event)[0].value.replace(/[^A-ZÁÀÃÂÉÈÊÍÌÓÒÔÕÚÙÇ ]/gi,"")},$scope.atualizarAluno=function(alunoCadastro,cadastroForm){AonlineUtils.showLoading(!0),alunoCadastro.dt_nasc=moment(alunoCadastro.dt_nasc).valueOf(),alunoCadastro.rg_dtexp=moment(alunoCadastro.rg_dtexp).valueOf(),alunoCadastro.alist_dtexp=moment(alunoCadastro.alist_dtexp).valueOf();var erro=!1;if(cadastroForm&&cadastroForm.$invalid){var auxInvalid=cadastroForm.$error.required,stepErro=!1,nomeCampo="",abaErro=this.currentStep;erro=!0,auxInvalid?(auxInvalid=auxInvalid[0].$name,campoAba.forEach(function(aba,i){aba.campos.forEach(function(campo,j){if(campo.campo===auxInvalid)return abaErro=aba.aba,nomeCampo=campo.nomeCampo,void(stepErro=!0)})}),stepErro&&(angular.element(document.getElementsByName(auxInvalid)).addClass("ng-invalid","ng-invalid-required","ng-touched"),Notification.error('Por favor, preencha o campo "'+$translate.instant(nomeCampo)+'".')),this.currentStep=abaErro):cadastroForm.$error.cpf&&("00000000000"!==cadastroForm.cpf_aluno.$modelValue&&"00000000000"!==cadastroForm.cpf_resp.$modelValue?validarCPFs():erro=!1),AonlineUtils.showLoading(!1)}0==erro&&AlunoCadastroService.atualizarAluno(alunoCadastro).then(function(){AonlineUtils.showLoading(!1),validarCamposDesabilit(),formatarDatasUTC(),Notification.success($translate.instant("Registro atualizado com sucesso."))}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})},$scope.atualizarRespLogado=function(respLogado,cadastroForm){AonlineUtils.showLoading(!0),respLogado.dt_nasc=moment(respLogado.dt_nasc).valueOf(),respLogado.rg_dtexp=moment(respLogado.rg_dtexp).valueOf(),respLogado.alist_dtexp=moment(respLogado.alist_dtexp).valueOf();var erro=!1;if(cadastroForm.$invalid){var auxInvalid=cadastroForm.$error.required,stepErro=!1,nomeCampo="",abaErro=this.currentStep;erro=!0,auxInvalid?(auxInvalid=auxInvalid[0].$name,campoAba.forEach(function(aba,i){aba.campos.forEach(function(campo,j){if(campo.campo===auxInvalid)return abaErro=aba.aba,nomeCampo=campo.nomeCampo,void(stepErro=!0)})}),stepErro&&(angular.element(document.getElementsByName(auxInvalid)).addClass("ng-invalid","ng-invalid-required","ng-touched"),Notification.error('Por favor, preencha o campo "'+$translate.instant(nomeCampo)+'".')),this.currentStep=abaErro):cadastroForm.$error.cpf&&("00000000000"!==cadastroForm.cpf_aluno_resp_logado.$modelValue?validarCPFs():erro=!1),AonlineUtils.showLoading(!1)}0==erro&&AlunoCadastroService.atualizarAluno(respLogado).then(function(){AonlineUtils.showLoading(!1),validarCamposDesabilitRespLogado(),formatarDatasRespUTC(),Notification.success($translate.instant("Registro atualizado com sucesso."))}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})},$scope.obterDadosAcademicos=function(codAluno){obterDadosAcademicos(codAluno)},$scope.validarData=function(campo){if("alist_dtexp"==campo.target.name&&(""==campo.target.value||null==campo.target.value))return angular.element(document.getElementsByName(campo.target.name)).removeClass("bordaVermelha"),void($scope.desabilitarSalvar=!1);if((""==campo.target.value||null==campo.target.value)&&"alist_dtexp"!=campo.target.name)return angular.element(document.getElementsByName(campo.target.name)).addClass("bordaVermelha"),void($scope.desabilitarSalvar=!0);if(campo.target.value.match(/(0[1-9]|[12][0-9]|3[01]){1,1}\/(0[1-9]|1[0-2]){1,1}\/(19{1,1}[1-9]{2,2}|20{1,1}[0-9]{2,2})/)){var aux=campo.target.value.split("/");if(new Date(aux[2]+"/"+aux[1]+"/"+aux[0]).getMonth()===aux[1]-1)return angular.element(document.getElementsByName(campo.target.name)).removeClass("bordaVermelha"),void($scope.desabilitarSalvar=!1)}Notification.error("Data inválida!"),angular.element(document.getElementsByName(campo.target.name)).addClass("bordaVermelha"),$scope.desabilitarSalvar=!0},$scope.validarDataRespLogado=function(campo){if("alist_dtexp_resp_logado"==campo.target.name&&(""==campo.target.value||null==campo.target.value))return angular.element(document.getElementsByName(campo.target.name)).removeClass("bordaVermelha"),void($scope.desabilitarSalvarRespLogado=!1);if((""==campo.target.value||null==campo.target.value)&&"alist_dtexp_resp_logado"!=campo.target.name)return angular.element(document.getElementsByName(campo.target.name)).addClass("bordaVermelha"),void($scope.desabilitarSalvarRespLogado=!0);if(campo.target.value.match(/(0[1-9]|[12][0-9]|3[01]){1,1}\/(0[1-9]|1[0-2]){1,1}\/(19{1,1}[1-9]{2,2}|20{1,1}[0-9]{2,2})/)){var aux=campo.target.value.split("/");if(new Date(aux[2]+"/"+aux[1]+"/"+aux[0]).getMonth()===aux[1]-1)return angular.element(document.getElementsByName(campo.target.name)).removeClass("bordaVermelha"),void($scope.desabilitarSalvarRespLogado=!1)}Notification.error("Data inválida!"),angular.element(document.getElementsByName(campo.target.name)).addClass("bordaVermelha"),$scope.desabilitarSalvarRespLogado=!0},$scope.validarBrasil=function(tipoEndereco){return"R"===tipoEndereco&&void 0!==$scope.alunoCadastro.end_pais&&""!==$scope.alunoCadastro.end_pais?($scope.alunoCadastro.end_pais=($scope.alunoCadastro.end_pais?$scope.alunoCadastro.end_pais:"").toUpperCase(),null!==$scope.alunoCadastro.end_pais&&void 0!==$scope.alunoCadastro.end_pais&&"BRASIL"==$scope.alunoCadastro.end_pais):"RR"===tipoEndereco&&void 0!==$scope.respLogadoAlunoCadastro.end_pais&&""!==$scope.respLogadoAlunoCadastro.end_pais?($scope.respLogadoAlunoCadastro.end_pais=($scope.respLogadoAlunoCadastro.end_pais?$scope.respLogadoAlunoCadastro.end_pais:"").toUpperCase(),null!==$scope.respLogadoAlunoCadastro.end_pais&&void 0!==$scope.respLogadoAlunoCadastro.end_pais&&"BRASIL"==$scope.respLogadoAlunoCadastro.end_pais):"C"===tipoEndereco&&void 0!==$scope.alunoCadastro.endcom_pais&&""!==$scope.alunoCadastro.endcom_pais?($scope.alunoCadastro.endcom_pais=($scope.alunoCadastro.endcom_pais?$scope.alunoCadastro.endcom_pais:"").toUpperCase(),null!==$scope.alunoCadastro.endcom_pais&&void 0!==$scope.alunoCadastro.endcom_pais&&"BRASIL"==$scope.alunoCadastro.endcom_pais):"CR"===tipoEndereco&&void 0!==$scope.respLogadoAlunoCadastro.endcom_pais&&""!==$scope.respLogadoAlunoCadastro.endcom_pais?($scope.respLogadoAlunoCadastro.endcom_pais=($scope.respLogadoAlunoCadastro.endcom_pais?$scope.respLogadoAlunoCadastro.endcom_pais:"").toUpperCase(),null!==$scope.respLogadoAlunoCadastro.endcom_pais&&void 0!==$scope.respLogadoAlunoCadastro.endcom_pais&&"BRASIL"==$scope.respLogadoAlunoCadastro.endcom_pais):"N"===tipoEndereco&&void 0!==$scope.alunoCadastro.pais_nasc&&""!==$scope.alunoCadastro.pais_nasc?($scope.alunoCadastro.pais_nasc=($scope.alunoCadastro.pais_nasc?$scope.alunoCadastro.pais_nasc:"").toUpperCase(),null!==$scope.alunoCadastro.pais_nasc&&void 0!==$scope.alunoCadastro.pais_nasc&&"BRASIL"==$scope.alunoCadastro.pais_nasc):"NR"===tipoEndereco&&void 0!==$scope.respLogadoAlunoCadastro.pais_nasc&&""!==$scope.respLogadoAlunoCadastro.pais_nasc?($scope.respLogadoAlunoCadastro.pais_nasc=($scope.respLogadoAlunoCadastro.pais_nasc?$scope.respLogadoAlunoCadastro.pais_nasc:"").toUpperCase(),null!==$scope.respLogadoAlunoCadastro.pais_nasc&&void 0!==$scope.respLogadoAlunoCadastro.pais_nasc&&"BRASIL"==$scope.respLogadoAlunoCadastro.pais_nasc):"RF"==tipoEndereco},$scope.obterEndereco=function(cep,tipoEndereco){void 0!==cep&&""!==cep&&8==cep.length&&(AonlineUtils.showLoading(!0),UtilService.obterEndereco(cep).then(function(result){$scope.endereco=result;try{var endPais;if($scope.validarBrasil(tipoEndereco))null!=$scope.endereco.ufSigla&&null!=$scope.endereco.ufSigla||(AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)),UtilService.obterUF().then(function(result){if($scope.listaEstados=result,$scope.endereco.ufSigla){var filtroMunicipio={codMunicipio:null,nome:null,cep:null,uf:$scope.endereco.ufSigla};UtilService.obterMunicipios(filtroMunicipio).then(function(result){var municipios=result;AonlineUtils.showLoading(!1),$scope.listaMunicipios=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome};$scope.listaMunicipios.push(municipio)}null!==$scope.endereco.srbCidade&&void 0!==$scope.endereco.srbCidade?UtilService.obterBairros($scope.endereco.srbCidade).then(function(result){$scope.listaBairros=result,preencherCamposEndereco(tipoEndereco)}):preencherCamposEndereco(tipoEndereco)}).catch(function(erro){retornoErro(erro),AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)})}preencherCamposEndereco(tipoEndereco),AonlineUtils.showLoading(!1)}).catch(function(erro){retornoErro(erro),AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)});else endPais="RR"===tipoEndereco?$scope.respLogadoAlunoCadastro.end_pais:$scope.alunoCadastro.end_pais,UtilService.obterEstadosEstrangeiros(endPais).then(function(result){$scope.listaEstados={},$scope.listaEstados.dados=[];for(var i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};$scope.listaEstados.dados.push(uf)}if("RR"===tipoEndereco)var municipio={codMunicipioEstrangeiro:null,nome:null,pais:$scope.getCodigoPais($scope.respLogadoAlunoCadastro.end_pais),cep:null,estado:$scope.endereco.ufSigla,nomeEstado:null};else municipio={codMunicipioEstrangeiro:null,nome:null,pais:$scope.getCodigoPais($scope.alunoCadastro.end_pais),cep:null,estado:$scope.endereco.ufSigla,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;$scope.listaMunicipios=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};$scope.listaMunicipios.push(municipio)}$scope.listaBairros=[],AonlineUtils.showLoading(!1),preencherCamposEndereco(tipoEndereco)}).catch(function(erro){retornoErro(erro),AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)})}).catch(function(erro){retornoErro(erro),AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)})}catch(erro){AonlineUtils.showLoading(!1),retornoErro(erro)}}).catch(function(erro){retornoErro(erro),AonlineUtils.showLoading(!1),limparCamposEndereco(tipoEndereco)})),limparCamposEndereco(tipoEndereco),$scope.loadEstados(tipoEndereco)},$scope.carregarEnderecoResidencial=function(){$scope.loadEstados("R"),$scope.loadMunicipios("R"),$scope.loadBairros("R")},$scope.carregarEnderecoComercial=function(){$scope.loadEstados("C"),$scope.loadMunicipios("C"),$scope.loadBairros("C")},$scope.carregarEnderecoRespFinan=function(){$scope.loadEstados("RF"),$scope.loadMunicipios("RF"),$scope.loadBairros("RF")},$scope.carregaEnderecoNascimento=function(){$scope.loadEstados("N"),$scope.loadMunicipios("N")},$scope.carregaEnderecoNascimentoRespLogado=function(){$scope.loadEstados("NR"),$scope.loadMunicipios("NR")},$scope.carregarEnderecoResidencialRespLogado=function(){$scope.loadEstados("RR"),$scope.loadMunicipios("RR"),$scope.loadBairros("RR")},$scope.carregarEnderecoComercialRespLogado=function(){$scope.loadEstados("CR"),$scope.loadMunicipios("CR"),$scope.loadBairros("CR")},$scope.loadEstados=function(tipoEndereco){let list=$scope.obterNomeListaMunicipios(tipoEndereco);if($scope[list]=[],"R"===tipoEndereco||"RR"===tipoEndereco){if("R"===tipoEndereco&&$scope.validarBrasil("R"))AonlineUtils.showLoading(!0),angular.element("#dddResidencial, #dddCelular, #dddComercial, #cepRes").unmask(),angular.element("#dddResidencial, #dddCelular, #dddComercial").mask("00"),angular.element("#cepRes").mask("00000-000"),$scope.LISTA_ESTADOS_END_RES=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_END_RES=result,AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if("RR"===tipoEndereco&&$scope.validarBrasil("RR"))AonlineUtils.showLoading(!0),angular.element("#dddResidencialRespLogado, #dddCelularRespLogado, #dddComercialRespLogado, #cepResRespLogado").unmask(),angular.element("#dddResidencialRespLogado, #dddCelularRespLogado, #dddComercialRespLogado").mask("00"),angular.element("#cepResRespLogado").mask("00000-000"),$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO=result,AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if(null!==$scope.alunoCadastro.end_pais&&void 0!==$scope.alunoCadastro.end_pais){AonlineUtils.showLoading(!0),angular.element("#telResidInt, #telCelInt").mask("000000000000000"),angular.element("#dddResidencial, #telCel, #telResid, #dddCelular, #dddComercial, #cepRes").unmask(),angular.element("#dddResidencial, #dddCelular, #dddComercial").mask("00000"),angular.element("#cepRes").mask("000000000000");var codPais=$scope.getCodigoPais($scope.alunoCadastro.end_pais);UtilService.obterEstadosEstrangeiros(codPais).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_RES.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else if(null!==$scope.respLogadoAlunoCadastro.end_pais&&void 0!==$scope.respLogadoAlunoCadastro.end_pais){AonlineUtils.showLoading(!0),angular.element("#telResidIntRespLogado, #telCelIntRespLogado").mask("000000000000000"),angular.element("#dddResidencialRespLogado, #telCelRespLogado, #telResidRespLogado, #dddCelularRespLogado, #dddComercialRespLogado, #cepResRespLogado").unmask(),angular.element("#dddResidencialRespLogado, #dddCelularRespLogado, #dddComercialRespLogado").mask("00000"),angular.element("#cepResRespLogado").mask("000000000000");var codPaisResp=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.end_pais);UtilService.obterEstadosEstrangeiros(codPaisResp).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_RES_RESP_LOGADO.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}}else if("C"===tipoEndereco||"CR"===tipoEndereco){if("C"===tipoEndereco&&$scope.validarBrasil("C"))AonlineUtils.showLoading(!0),$scope.LISTA_ESTADOS_END_COM=[],UtilService.obterUF().then(function(result){AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_COM=result}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if("CR"===tipoEndereco&&$scope.validarBrasil("CR"))AonlineUtils.showLoading(!0),$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO=[],UtilService.obterUF().then(function(result){AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO=result}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if(null!==$scope.alunoCadastro.endcom_pais&&void 0!==$scope.alunoCadastro.endcom_pais){AonlineUtils.showLoading(!0);codPais=$scope.getCodigoPais($scope.alunoCadastro.endcom_pais);UtilService.obterEstadosEstrangeiros(codPais).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_COM.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else if(null!==$scope.respLogadoAlunoCadastro.endcom_pais&&void 0!==$scope.respLogadoAlunoCadastro.endcom_pais){AonlineUtils.showLoading(!0);codPaisResp=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.endcom_pais);UtilService.obterEstadosEstrangeiros(codPaisResp).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_COM_RESP_LOGADO.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}}else if("RF"==tipoEndereco)AonlineUtils.showLoading(!0),$scope.LISTA_ESTADOS_END_RESP=[],UtilService.obterUF().then(function(result){AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_END_RESP=result}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if("N"===tipoEndereco||"NR"===tipoEndereco)if("N"===tipoEndereco&&$scope.validarBrasil("N"))AonlineUtils.showLoading(!0),$scope.LISTA_ESTADOS_NASCIMENTO=[],UtilService.obterUF().then(function(result){AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_NASCIMENTO=result}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if("NR"===tipoEndereco&&$scope.validarBrasil("NR"))AonlineUtils.showLoading(!0),$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO=[],UtilService.obterUF().then(function(result){AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO=result}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});else if(null!==$scope.alunoCadastro.pais_nasc&&void 0!==$scope.alunoCadastro.pais_nasc){codPais=$scope.getCodigoPais($scope.alunoCadastro.pais_nasc.toUpperCase());AonlineUtils.showLoading(!0),UtilService.obterEstadosEstrangeiros(codPais).then(function(result){var dados=[];$scope.LISTA_ESTADOS_NASCIMENTO=[];for(var i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_NASCIMENTO.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else if(null!==$scope.respLogadoAlunoCadastro.pais_nasc&&void 0!==$scope.respLogadoAlunoCadastro.pais_nasc){codPaisResp=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.pais_nasc.toUpperCase());AonlineUtils.showLoading(!0),UtilService.obterEstadosEstrangeiros(codPaisResp).then(function(result){var dados=[];$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO=[];for(var i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}AonlineUtils.showLoading(!1),$scope.LISTA_ESTADOS_NASCIMENTO_RESP_LOGADO.dados=dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},$scope.obterNomeListaMunicipios=function(tipoEndereco){return{R:"LISTA_MUNICIPIOS_END_RES",C:"LISTA_MUNICIPIOS_END_COM",N:"LISTA_MUNICIPIOS_NASCIMENTO",RF:"LISTA_MUNICIPIOS_END_RESP",RR:"LISTA_MUNICIPIOS_END_RES_RESP_LOGADO",CR:"LISTA_MUNICIPIOS_END_COM_RESP_LOGADO",NR:"LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO"}[tipoEndereco]},$scope.loadMunicipios=function(tipoEndereco){if(function(tipoEndereco){"R"==tipoEndereco?$scope.LISTA_BAIRROS_END_RES=[]:"RR"==tipoEndereco?$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=[]:$scope.LISTA_BAIRROS_END_COM=[]}(tipoEndereco),"R"===tipoEndereco||"RR"===tipoEndereco)if(AonlineUtils.showLoading(!0),"R"===tipoEndereco&&$scope.validarBrasil("R"))if($scope.alunoCadastro.uf_municipio_end){var filtro={codMunicipio:null,nome:null,cep:null,uf:selUF=$scope.alunoCadastro.uf_municipio_end};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_RES=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome?municipios[i].nome.toUpperCase():""};$scope.LISTA_MUNICIPIOS_END_RES.push(municipio)}AonlineUtils.showLoading(!1),$scope.loadCodigoCidade("R")}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_END_RES=[],AonlineUtils.showLoading(!1);else if("RR"===tipoEndereco&&$scope.validarBrasil("RR"))if($scope.respLogadoAlunoCadastro.uf_municipio_end){filtro={codMunicipio:null,nome:null,cep:null,uf:selUF=$scope.respLogadoAlunoCadastro.uf_municipio_end};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome?municipios[i].nome.toUpperCase():""};$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO.push(municipio)}AonlineUtils.showLoading(!1),$scope.loadCodigoCidade("RR")}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=[],AonlineUtils.showLoading(!1);else{if("RR"===tipoEndereco)var codPais=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.end_pais),estado=$scope.respLogadoAlunoCadastro.uf_municipio_end;else codPais=$scope.getCodigoPais($scope.alunoCadastro.end_pais),estado=$scope.alunoCadastro.uf_municipio_end;var municipio={codMunicipioEstrangeiro:null,nome:null,pais:codPais,cep:null,estado:estado,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;"RR"===tipoEndereco?$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO=[]:$scope.LISTA_MUNICIPIOS_END_RES=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};"RR"===tipoEndereco?$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO.push(municipio):$scope.LISTA_MUNICIPIOS_END_RES.push(municipio)}AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else if("RF"==tipoEndereco)if($scope.respFinan.ufSigla){filtro={codMunicipio:null,nome:null,cep:null,uf:selUF=$scope.respFinan.ufSigla};AonlineUtils.showLoading(!0),UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_RESP=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome?municipios[i].nome.toUpperCase():""};$scope.LISTA_MUNICIPIOS_END_RESP.push(municipio)}AonlineUtils.showLoading(!1),$scope.loadCodigoCidade("RF")}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_END_RESP=[],AonlineUtils.showLoading(!1);else if("C"===tipoEndereco||"CR"===tipoEndereco)if("C"===tipoEndereco&&$scope.validarBrasil("C"))if($scope.alunoCadastro.uf_endcom_municipio){filtro={codMunicipio:null,nome:null,cep:null,uf:selUF=null!=$scope.alunoCadastro.uf_endcom_municipio?$scope.alunoCadastro.uf_endcom_municipio:null};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_COM=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome};$scope.LISTA_MUNICIPIOS_END_COM.push(municipio)}AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_END_COM=[],AonlineUtils.showLoading(!1);else if("CR"===tipoEndereco&&$scope.validarBrasil("CR"))if($scope.respLogadoAlunoCadastro.uf_endcom_municipio){filtro={codMunicipio:null,nome:null,cep:null,uf:selUF=null!=$scope.respLogadoAlunoCadastro.uf_endcom_municipio?$scope.respLogadoAlunoCadastro.uf_endcom_municipio:null};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome};$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO.push(municipio)}AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=[],AonlineUtils.showLoading(!1);else{if("RR"===tipoEndereco)codPais=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.endcom_pais),estado=$scope.respLogadoAlunoCadastro.uf_endcom_municipio;else codPais=$scope.getCodigoPais($scope.alunoCadastro.endcom_pais),estado=$scope.alunoCadastro.uf_endcom_municipio;municipio={codMunicipioEstrangeiro:null,nome:null,pais:codPais,cep:null,estado:estado,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;"RR"===tipoEndereco?$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO=[]:$scope.LISTA_MUNICIPIOS_END_COM=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};"RR"===tipoEndereco?$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO.push(municipio):$scope.LISTA_MUNICIPIOS_END_COM.push(municipio)}AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else if("N"===tipoEndereco||"NR"===tipoEndereco)if("N"===tipoEndereco&&$scope.validarBrasil("N"))if($scope.alunoCadastro.uf_municipio_nasc){var selUF=$scope.alunoCadastro.uf_municipio_nasc?$scope.alunoCadastro.uf_municipio_nasc:null;AonlineUtils.showLoading(!0);filtro={codMunicipio:null,nome:null,cep:null,uf:selUF};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;AonlineUtils.showLoading(!1),$scope.LISTA_MUNICIPIOS_NASCIMENTO=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome};$scope.LISTA_MUNICIPIOS_NASCIMENTO.push(municipio)}}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_NASCIMENTO=[];else if("NR"===tipoEndereco&&$scope.validarBrasil("NR"))if($scope.respLogadoAlunoCadastro.uf_municipio_nasc){selUF=$scope.respLogadoAlunoCadastro.uf_municipio_nasc?$scope.respLogadoAlunoCadastro.uf_municipio_nasc:null;AonlineUtils.showLoading(!0);filtro={codMunicipio:null,nome:null,cep:null,uf:selUF};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;AonlineUtils.showLoading(!1),$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome};$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO.push(municipio)}}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})}else $scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[];else{if("RR"===tipoEndereco)codPais=$scope.getCodigoPais($scope.respLogadoAlunoCadastro.pais_nasc),estado=$scope.respLogadoAlunoCadastro.uf_municipio_nasc;else codPais=$scope.getCodigoPais($scope.alunoCadastro.pais_nasc),estado=$scope.alunoCadastro.uf_municipio_nasc;municipio={codMunicipioEstrangeiro:null,nome:null,pais:codPais,cep:null,estado:estado,nomeEstado:null};if(null==estado)return $scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[],void AonlineUtils.showLoading(!1);UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeirosResp=result;$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO=[];for(var i=0;i<municipiosEstrangeirosResp.length;i++){var municipio={codigo:municipiosEstrangeirosResp[i].codigo,nome:municipiosEstrangeirosResp[i].nome+" - "+municipiosEstrangeirosResp[i].estado};$scope.LISTA_MUNICIPIOS_NASCIMENTO_RESP_LOGADO.push(municipio)}AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},$scope.loadBairros=function(tipoEndereco){if($scope.loadCodigoCidade(tipoEndereco),"R"===tipoEndereco&&$scope.alunoCadastro.nome_end_municipio||"RR"===tipoEndereco&&$scope.respLogadoAlunoCadastro.nome_end_municipio)if("R"===tipoEndereco&&$scope.validarBrasil("R")){AonlineUtils.showLoading(!0);var codMunicipio=null!=$scope.alunoCadastro.end_municipio?$scope.alunoCadastro.end_municipio:null;$scope.alunoCadastro&&$scope.alunoCadastro.bairro&&($scope.alunoCadastro.bairro=$scope.alunoCadastro.bairro.toUpperCase()),$scope.LISTA_BAIRROS_END_RES=[],codMunicipio?UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_RES=result,0===$scope.LISTA_BAIRROS_END_RES.length?$scope.habilitaInputBairro=!0:$scope.habilitaInputBairro=!1,AonlineUtils.showLoading(!1)}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}):AonlineUtils.showLoading(!1)}else if("RR"===tipoEndereco&&$scope.validarBrasil("RR")){AonlineUtils.showLoading(!0);codMunicipio=null!=$scope.respLogadoAlunoCadastro.end_municipio?$scope.respLogadoAlunoCadastro.end_municipio:null;$scope.respLogadoAlunoCadastro&&$scope.respLogadoAlunoCadastro.bairro&&($scope.respLogadoAlunoCadastro.bairro=$scope.respLogadoAlunoCadastro.bairro.toUpperCase()),$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=[],codMunicipio?UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=result,0===$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO.length?$scope.habilitaInputBairroResp=!0:$scope.habilitaInputBairroResp=!1,AonlineUtils.showLoading(!1)}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}):AonlineUtils.showLoading(!1)}else"RR"===tipoEndereco?$scope.LISTA_BAIRROS_END_RES_RESP_LOGADO=[]:$scope.LISTA_BAIRROS_END_RES=[];else if("RF"==tipoEndereco){codMunicipio=null!=$scope.respFinan.municipio?$scope.respFinan.municipio:null;$scope.respFinan&&$scope.respFinan.bairro&&($scope.respFinan.bairro=$scope.respFinan.bairro.toUpperCase()),$scope.LISTA_BAIRROS_END_RESP=[],codMunicipio?(AonlineUtils.showLoading(!0),UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_RESP=result,0===$scope.LISTA_BAIRROS_END_RESP.length?$scope.habilitaInputBairroResp=!0:$scope.habilitaInputBairroResp=!1,AonlineUtils.showLoading(!1)}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})):$scope.habilitaInputBairroResp=!0}else if("C"===tipoEndereco&&$scope.alunoCadastro.cidadecomercial||"CR"===tipoEndereco&&$scope.respLogadoAlunoCadastro.cidadecomercial)if("C"===tipoEndereco&&$scope.validarBrasil("C")){AonlineUtils.showLoading(!0);codMunicipio=null!=$scope.alunoCadastro.endcom_municipio?$scope.alunoCadastro.endcom_municipio:null;$scope.LISTA_BAIRROS_END_COM=[],codMunicipio&&UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_COM=result,AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),AonlineUtils.showLoading(!1)}else if("CR"===tipoEndereco&&$scope.validarBrasil("CR")){AonlineUtils.showLoading(!0);codMunicipio=null!=$scope.respLogadoAlunoCadastro.endcom_municipio?$scope.respLogadoAlunoCadastro.endcom_municipio:null;$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=[],codMunicipio&&UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=result,AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),AonlineUtils.showLoading(!1)}else"RR"===tipoEndereco?$scope.LISTA_BAIRROS_END_COM_RESP_LOGADO=[]:$scope.LISTA_BAIRROS_END_COM=[]},$scope.getCodigoPais=function(nomePais){if(nomePais&&$scope.paises)for(let i=0;i<$scope.paises.dados.length;i++)if($scope.paises.dados[i].nome.toUpperCase()===nomePais.toUpperCase())return $scope.paises.dados[i].pais},$scope.loadCodigoCidade=function(tipoEndereco){if("R"===tipoEndereco){if(cidade=$scope.alunoCadastro.nome_end_municipio)for(var i=0;i<$scope.LISTA_MUNICIPIOS_END_RES.length;i++)if($scope.LISTA_MUNICIPIOS_END_RES[i].nome&&$scope.LISTA_MUNICIPIOS_END_RES[i].nome.toUpperCase()===cidade.toUpperCase())return $scope.alunoCadastro.end_municipio=$scope.LISTA_MUNICIPIOS_END_RES[i].codigo,void($scope.alunoCadastro.nome_end_municipio=$scope.LISTA_MUNICIPIOS_END_RES[i].nome.toUpperCase())}else if("RR"===tipoEndereco){if(cidadeResp=$scope.respLogadoAlunoCadastro.nome_end_municipio)for(i=0;i<$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO.length;i++)if($scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO[i].nome&&$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO[i].nome.toUpperCase()===cidadeResp.toUpperCase())return $scope.respLogadoAlunoCadastro.end_municipio=$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO[i].codigo,void($scope.respLogadoAlunoCadastro.nome_end_municipio=$scope.LISTA_MUNICIPIOS_END_RES_RESP_LOGADO[i].nome.toUpperCase())}else if("RF"===tipoEndereco){if(cidade=$scope.respFinan.nomeMunicipio)for(i=0;i<$scope.LISTA_MUNICIPIOS_END_RESP.length;i++)if($scope.LISTA_MUNICIPIOS_END_RESP[i].nome&&$scope.LISTA_MUNICIPIOS_END_RESP[i].nome.toUpperCase()===cidade.toUpperCase())return $scope.respFinan.municipio=$scope.LISTA_MUNICIPIOS_END_RESP[i].codigo,void($scope.respFinan.nomeMunicipio=$scope.LISTA_MUNICIPIOS_END_RESP[i].nome.toUpperCase())}else if("C"===tipoEndereco){var cidade;if(cidade=$scope.alunoCadastro.cidadecomercial)for(i=0;i<$scope.LISTA_MUNICIPIOS_END_COM.length;i++)if($scope.LISTA_MUNICIPIOS_END_COM[i].nome&&$scope.LISTA_MUNICIPIOS_END_COM[i].nome.toUpperCase()===cidade.toUpperCase())return $scope.alunoCadastro.endcom_municipio=$scope.LISTA_MUNICIPIOS_END_COM[i].codigo,void($scope.alunoCadastro.cidadecomercial=$scope.LISTA_MUNICIPIOS_END_COM[i].nome.toUpperCase())}else if("CR"===tipoEndereco){var cidadeResp;if(cidadeResp=$scope.respLogadoAlunoCadastro.cidadecomercial)for(i=0;i<$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO.length;i++)if($scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO[i].nome&&$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO[i].nome.toUpperCase()===cidadeResp.toUpperCase())return $scope.respLogadoAlunoCadastro.endcom_municipio=$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO[i].codigo,void($scope.respLogadoAlunoCadastro.cidadecomercial=$scope.LISTA_MUNICIPIOS_END_COM_RESP_LOGADO[i].nome.toUpperCase())}},vm.salvarDadosRespFinan=function(endRespFinanForm){if(endRespFinanForm.$valid){let respFinan={dados:{bairro:$scope.respFinan.bairro,cep:$scope.respFinan.cep,complemento:$scope.respFinan.complemento,endereco:$scope.respFinan.endereco,municipio:$scope.respFinan.municipio,numero:$scope.respFinan.numero},idResponsavel:$scope.respFinan.codigoResp};AonlineUtils.showLoading(!0),AlunoCadastroService.atualizarRespFinanInfo(respFinan).then(result=>{AonlineUtils.showLoading(!1),Notification.success("Dados atualizados com sucesso.")}).catch(error=>{AonlineUtils.showLoading(!1)})}else Notification.warning("Favor informar os campos obrigatórios.")}}]),angular.module("custom.controllers").controller("AlunoExtratoController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$log","AlunoExtratoService","CartaoService","UtilService","$ionicLoading","$ionicModal",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$log,AlunoExtratoService,CartaoService,UtilService,$ionicLoading,$ionicModal){function loading(value){alunoExtratoCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}$scope.gerarHTML=function(filename,divId){var elHtml=document.getElementById(divId).innerHTML,link=document.createElement("a");mimeType="text/plain",link.setAttribute("download",filename+".html"),link.setAttribute("href","data:"+mimeType+";charset=utf-8,"+encodeURIComponent(elHtml)),link.click()},getWindowWidth=function(){return window.innerWidth};var alunoExtratoCtrl=this;alunoExtratoCtrl.id="AlunoExtratoController",loading(!0),$scope.alunoExtrato={},$scope.alunoExtrato.filtro={},$scope.alunoExtrato.filtro.tipo="filtroData",$scope.alunoExtrato.filtro.dataInicial=void 0,$scope.alunoExtrato.filtro.dataFinal=void 0,AlunoExtratoService.obterAnoDividaAluno().then(function(result){alunoExtratoCtrl.loading=!1,loading(!1),$scope.alunoExtrato.anoDividaAluno=result,$scope.alunoExtrato.periodoDividaAluno={},$scope.alunoExtrato.periodoDividaAluno.dados=[]}).catch(function(err){Notification.error(err),alunoExtratoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.obterPeriodoDividaAluno=function(ano){null!=ano&&""!==ano?(loading(!0),AlunoExtratoService.obterPeriodoDividaAluno(ano).then(function(result){$scope.alunoExtrato.periodoDividaAluno=result,alunoExtratoCtrl.loading=!1,loading(!1)}).catch(function(err){Notification.error(err),alunoExtratoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})):$scope.alunoExtrato.periodoDividaAluno.dados=[]},$scope.isFormValid=function(){return("filtroData"!=$scope.alunoExtrato.filtro.tipo||null!=$scope.alunoExtrato.filtro.dataInicial&&null!=$scope.alunoExtrato.filtro.dataFinal)&&("filtroPeriodo"!=$scope.alunoExtrato.filtro.tipo||null!=$scope.alunoExtrato.filtro.anoSelecionado&&null!=$scope.alunoExtrato.filtro.periodoSelecionado)},$scope.getWindowWidth=function(){return window.innerWidth},$ionicModal.fromTemplateUrl("./views/logged/aluno.extrato.modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.exibeItemExtrado=function(extratoSelecionadoToModal){$log.debug(extratoSelecionadoToModal),$scope.extratoSelecionadoToModal=extratoSelecionadoToModal,$scope.isPagCartao=!1,extratoSelecionadoToModal.tipoPagamento&&("CARTAO"!=extratoSelecionadoToModal.tipoPagamento.toUpperCase()&&"CARTÃO"!=extratoSelecionadoToModal.tipoPagamento.toUpperCase()||($scope.isPagCartao=!0)),$scope.modal.show()},$scope.obterExtratoFinanceiro=function(tipoFiltro){let ano={},periodo="",dataInicial="",dataFinal="";loading(!0),"filtroData"===tipoFiltro?(dataInicial=UtilService.dateToString($scope.alunoExtrato.filtro.dataInicial),dataFinal=UtilService.dateToString($scope.alunoExtrato.filtro.dataFinal)):(ano=$scope.alunoExtrato.filtro.anoSelecionado,periodo=$scope.alunoExtrato.filtro.periodoSelecionado),AlunoExtratoService.obterExtratoFinanceiro(dataInicial,dataFinal,ano,periodo).then(function(result){if($scope.alunoExtrato.dados=result,alunoExtratoCtrl.loading=!1,loading(!1),$scope.mapaExtrato={},null!==result.extrato&&void 0!==result.extrato){for(var i=0;i<result.extrato.length;i++)null==$scope.mapaExtrato[result.extrato[i].tipo]?($scope.mapaExtrato[result.extrato[i].tipo]=[],$scope.mapaExtrato[result.extrato[i].tipo].push(result.extrato[i])):$scope.mapaExtrato[result.extrato[i].tipo].push(result.extrato[i]);$scope.tamanhoMapa=Object.keys($scope.mapaExtrato).length}}).catch(function(err){alunoExtratoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})},$scope.downloadConsultaPagamento=function(){if($scope.extratoSelecionadoToModal.pedidoPgto){let numPedido=$scope.extratoSelecionadoToModal.pedidoPgto.idPedidoPgto;CartaoService.downloadConsultaPagamento(encodeURI(SessionData.aluno.list[0].codAluno),numPedido)}},$scope.obterExtratoFinanceiroPdf=function(tipoFiltro){let ano={},periodo="",dataInicial="",dataFinal="";loading(!0),"filtroData"===tipoFiltro?(dataInicial=UtilService.dateToString($scope.alunoExtrato.filtro.dataInicial),dataFinal=UtilService.dateToString($scope.alunoExtrato.filtro.dataFinal)):(ano=$scope.alunoExtrato.filtro.anoSelecionado,periodo=$scope.alunoExtrato.filtro.periodoSelecionado),AlunoExtratoService.obterExtratoFinanceiroPdf(dataInicial,dataFinal,ano,periodo)}}]),angular.module("custom.controllers").controller("ServicoConsultaController",["$scope","$rootScope","$state","$ionicModal","SessionData","ServicoService","$ionicLoading",function($scope,$rootScope,$state,$ionicModal,SessionData,ServicoService,$ionicLoading){$scope.servicosLista=[],$scope.servicoSelecionado={}}]),angular.module("custom.controllers").controller("ServicoDetailController",["Notification","$ionicHistory","$scope","$rootScope","$state","$ionicModal","SessionData","ServicoService","$ionicLoading","$http",function(Notification,$ionicHistory,$scope,$rootScope,$state,$ionicModal,SessionData,ServicoService,$ionicLoading,$http){var andamentosSolicitacao=[],anexosAndamentosSolicitacao=[];function loading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}$scope.solicitacaoDetalhe={},$scope.solicitacaoDetalhe.existeDados=!1,$scope.$on("openDetailService",function(event,params){var codAndamentoSolicitacao,codSolicitacao=params.codSolicitacao,codItemSolicitacao=params.itemSolicitacao,codServico=params.servico,codAluno=params.codAluno;if(loading(!0),ServicoService.obterAndamentoSolicitacaoServico(codAluno,codSolicitacao,codItemSolicitacao).then(function(result){if(loading(!1),result.length>0)for($scope.solicitacaoDetalhe.andamentosSolicitacao=result,$scope.solicitacaoDetalhe.existeDados=!0,i=0;i<result.length;i++)andamentosSolicitacao.push(result[i].andamento)}).catch(function(err){Notification.error(err),loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),ServicoService.obterParametroServicoSolicitado(codAluno,codSolicitacao,codItemSolicitacao,codServico).then(function(result){loading(!1),result.length>0&&($scope.solicitacaoDetalhe.parametrosServicosSolicitacoes=result,$scope.solicitacaoDetalhe.existeDados=!0)}).catch(function(err){Notification.error(err),loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),andamentosSolicitacao.length>0){for(i=0;i<andamentosSolicitacao.length;i++)codAndamentoSolicitacao=andamentosSolicitacao[i],ServicoService.obterAndamentoAnexo(SessionData.aluno.list[SessionData.aluno.selecionado].codAluno,codAndamentoSolicitacao).then(function(result){if(loading(!1),result.length>0)for(i=0;i<result.length;i++)anexosAndamentosSolicitacao.push(result[i])}).catch(function(err){Notification.error(err),loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})});$scope.solicitacaoDetalhe.andamentosAnexos=anexosAndamentosSolicitacao}})}]),angular.module("custom.controllers").controller("ConcluirSolicitacaoServicoController",["$scope","$rootScope","$state","$ionicModal","SessionData","ServicoService","$ionicLoading","$http","Configs","CartaoService","PagamentoCartaoFactory","$timeout","DownloadArquivo","Storage","$translate","Notification",function($scope,$rootScope,$state,$ionicModal,SessionData,ServicoService,$ionicLoading,$http,Configs,CartaoService,PagamentoCartaoFactory,$timeout,DownloadArquivo,Storage,$translate,Notification){$scope.$on("validatedReceivetItem",function(event,data){$rootScope.servicosSolicitadosList=data,$rootScope.prazoEntrega=new Date($rootScope.servicosSolicitadosList[0].prazoEntrega-$rootScope.servicosSolicitadosList[0].data).getDay(),$scope.numBoleto=$rootScope.servSolicitadoDetail.boleto,$scope.codCobranca=$rootScope.servSolicitadoDetail.codCobranca,$rootScope.servSolicitadoDetail=void 0;let numBoleto=null;null!==$scope.numBoleto&&(numBoleto=parseInt($scope.numBoleto)),$rootScope.objPagamento={cod_aluno:$rootScope.servicosSolicitadosList[0].codAluno,id_boleto:numBoleto},numBoleto&&ServicoService.obterPermitePagarServicoCartao($rootScope.objPagamento.id_boleto,$rootScope.objPagamento.cod_aluno).then(function(result){$scope.permitePagarServicoCartao=result.valor}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})})}),$scope.permitePix=Storage.get("enablePix"),$ionicModal.fromTemplateUrl("views/logged/cartao/modal.pagamento.pix.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalPix){$scope.modalPix=modalPix}),$scope.closeModal=function(){$scope.modalPix.hide()},$scope.openPixModal=async function(servico){$scope.modalPix.show(),$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}),CartaoService.obterDadosPagarServicoCartao($rootScope.objPagamento).then(function(retorno){let obj={candidato:null,concurso:null,listaDeCobrancas:[$scope.codCobranca],valorTotal:retorno.cartaoValorDocumento};$scope.$broadcast("startPix",obj)}).catch(error=>{$ionicLoading.hide()})},$scope.copiarPix=function(){Clipboard.isSupported()?($scope.clipboard=new Clipboard("#copy-button"),Notification.success($translate.instant("pix.view.msg.copied"))):Notification.warning($translate.instant("navegador.sem.suporte"))},$scope.acaoOpcao=function(codSolicitacao,codItemSolicitacao){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1});let params={};params.url=Configs.getApiServer()+"/pessoas/codSolicitacao/"+codSolicitacao+"/codItemSolicitacao/"+codItemSolicitacao+"/codPessoa/"+SessionData.user.id+"/obtemDocumentoCertificacao",params.method="GET",DownloadArquivo.downloadArquivo(params)},$scope.listaDoCarrinho=[];for(var i=0;i<SessionData.data.carrinho.length;i++){for(var teste=!0,j=0;j<i;j++)SessionData.data.carrinho[i].servico==SessionData.data.carrinho[j].servico&&(teste=!1);1==teste&&$scope.listaDoCarrinho.push(SessionData.data.carrinho[i])}$scope.visualizarDocumento=function(solicitacao){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1});let params={};params.url=Configs.getApiServer()+"/pessoas/solicitacao/"+solicitacao.solicitacao+"/itemSolicitacao/"+solicitacao.itemSolicitacao+"/exibirArquivo/false/cod_aluno/"+solicitacao.codAluno+"/visualizaDocumentoServico",params.method="GET",DownloadArquivo.downloadArquivo(params)},$rootScope.getValorTotalDosServicos=function(){var list=$rootScope.servicosSolicitadosList,valorTotalDosServicos=0;return angular.forEach(list,function(item,index){valorTotalDosServicos+=item.valorTotal}),$scope.vlr=valorTotalDosServicos,valorTotalDosServicos},$rootScope.getEncargosDeCobranca=function(){return 0},$rootScope.getValorTotal=function(){return $rootScope.getValorTotalDosServicos()+$rootScope.getEncargosDeCobranca()},$rootScope.getNumeroBoleto=function(listServicos){for(let i=0;i<listServicos.length;i++)if(null!==listServicos[i].boleto)return listServicos[i].boleto;return null},$scope.downloadBoleto=function(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1});let numBoleto=$rootScope.objPagamento.id_boleto;if(null!==numBoleto){let params={};params.url=Configs.getApiServer()+"/financeiro/codPessoaLogada/"+SessionData.user.id+"/codAluno/"+$rootScope.servicosSolicitadosList[0].codAluno+"/codBoleto/"+numBoleto+"/exibirArquivo/false/obterBoleto/",params.method="GET",DownloadArquivo.downloadArquivo(params)}else Notification.info("Não existe boleto gerado para esse serviço.")},$rootScope.pagamentoCartao=function(){$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}),CartaoService.obterDadosPagarServicoCartao($rootScope.objPagamento).then(function(retorno){let cobrancas={valorDocumento:retorno.cartaoValorDocumento,origem:retorno.cartaoOrigem,dataCalculoValor:retorno.cartaoDataCalculoValor,codResponsavelFinanceiro:retorno.cartaoCodRespFinan,opcaoPgtoCartao:retorno.cartaoOpcaoPgto,cobrancasConcatenadas:retorno.cartaoCobrancasSelecionadas,cartaoItensCobrancas:retorno.cartaoItensCobrancas,valorSelecionado:retorno.cartaoValorOriginalDocumento,encargoCalculado:retorno.cartaoEncargoDocumento,encargoBolsa:retorno.cartaoEncargoBolsaDocumento,descontoAdiantamentoCalculado:retorno.cartaoDescontoDocumento};PagamentoCartaoFactory.setCobrancasSelecionadas(cobrancas),$ionicLoading.hide(),$state.go("home.pgtocartao-pagamento")}).catch(function(){Notification.error($translate.instant("General.ErrorNotSpecified")),$ionicLoading.hide()})}}]),angular.module("custom.controllers").controller("AvaliaListagemController",["$log","$scope","$state","$ionicLoading","SessionData","AvaliaService","$timeout","Storage",function($log,$scope,$state,$ionicLoading,SessionData,AvaliaService,$timeout,Storage){let vm=this;function loading(value){vm.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}$scope.avaliacaoResponderDepois=angular.fromJson(Storage.get("avaliacaoResponderDepois")),loading(!0),AvaliaService.getListaQuestionarios().then(res=>{loading(!1),res&&($scope.listaQuestionarios=angular.copy(res),$scope.avaliacaoResponderDepois&&angular.forEach($scope.listaQuestionarios,function(questionario){angular.forEach($scope.avaliacaoResponderDepois,function(element){questionario.aplicacao===element&&(questionario.answerLater=!0)})}),res.find(function(item){return"S"===item.OBRIGATORIA})||Storage.set("questionariosObrigatorios",!1))},err=>loading(!1)),$scope.iniciarQuestionario=function(params){loading(!0),params.forma_exibicao||(params.forma_exibicao="AVALIADO SEGUIDO DAS QUESTÕES"),AvaliaService.iniciarQuestionario(params).then(function(response){loading(!1),"QUESTÕES SEGUIDAS DOS AVALIADOS"===params.forma_exibicao.toUpperCase()?$state.go("home.avaliacaoinstitucional-questionario-singular",{questionario:response}):$state.go("home.avaliacaoinstitucional-questionario-full",{questionario:response})},function(err){$log.debug(err)})},$scope.hoverIn=function(){$('[data-toggle="tooltip"]').tooltip()}}]),angular.module("custom.controllers").controller("AvaliaQuestionarioFullController",["$log","$scope","$state","$stateParams","$ionicLoading","SessionData","AvaliaService","$timeout","$location","$anchorScroll","Notification","Storage","$ionicModal",function($log,$scope,$state,$stateParams,$ionicLoading,SessionData,AvaliaService,$timeout,$location,$anchorScroll,Notification,Storage,$ionicModal){var vm=this;function loading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}if(!$stateParams.questionario)return $state.go("home.avaliacaoinstitucional");if(!$stateParams.questionario.listaQuestoes)return Notification.error("Erro ao obter questionário."),$state.go("home.avaliacaoinstitucional");function carrregarCombos(){angular.forEach($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes,function(value,key){value.combobox&&angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[key].alternativaSelecionada=$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[key].respostaAlternativas[key2])})})}$scope.questionario=[],$scope.respostas=[],$scope.perguntaOrdemAtual=1,$scope.perguntaSelecionada=null,$scope.questionario.push($stateParams.questionario),vm.questionarioIniciado=$stateParams.questionario.questionarioIniciado,vm.questionarioIniciado.paginaAtual=0,vm.totalDePaginas=vm.questionarioIniciado.totalDePaginas,vm.paginaResposta={},vm.paginaResposta.validarQuestoesObrigatorias=!0,$scope.btnActive=!1,carrregarCombos(),$ionicModal.fromTemplateUrl("modal-avalia-msg",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalAvaliaMsg=modal,vm.questionarioIniciado.msgInicial&&$timeout(function(){$scope.modalAvaliaMsg.show()},500)}),$ionicModal.fromTemplateUrl("modal-avalia-msg-final",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!1}).then(function(modal){$scope.modalAvaliaMsgFinal=modal}),$scope.fecharModal=function(){$scope.modalAvaliaMsg.hide()},$scope.anterior=function(){vm.questionarioIniciado.paginaAtual>0&&($location.hash("anchor0"),vm.questionarioIniciado.paginaAtual--)},$scope.proxima=function(){validarObrigatorios()?vm.questionarioIniciado.paginaAtual<vm.totalDePaginas&&(loading(!0),montarPaginaRespostas(),AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){vm.questionarioIniciado.paginaAtual++;let formaExibicao=vm.questionarioIniciado.formaExibicaoQuestionario?vm.questionarioIniciado.formaExibicaoQuestionario.toUpperCase():null;formaExibicao&&"AVALIADO SEGUIDO DAS QUESTÕES"===formaExibicao?AvaliaService.obterQuestionarioASQ(vm.questionarioIniciado).then(function(retorno){loading(!1),$scope.questionario.push(retorno),carrregarCombos()}):formaExibicao&&"AVALIAÇÃO EM CAIXAS DE GRUPOS"===formaExibicao&&AvaliaService.obterQuestionarioACG(vm.questionarioIniciado).then(function(retorno){loading(!1),$scope.questionario.push(retorno),carrregarCombos()})},function(err){Notification.error(err),console.log(err)})):Notification.warning("Preencha as questões obrigatórias.")};var montarPaginaRespostas=function(){let respostas={};angular.forEach($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes,function(value,key){(value.subjective||null!=value.RESPOSTA_SUBJETIVA&&""!=value.RESPOSTA_SUBJETIVA&&""!=value.RESPOSTA_SUBJETIVA)&&(respostas[value.ID]=value.RESPOSTA_SUBJETIVA),value.optionbutton&&angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]="on")}),value.combobox?(angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]=value2.CONCEITO)}),value.QUESTAO_SUBJETIVA&&(respostas[value.ID]=value.RESPOSTA_SUBJETIVA)):angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]=value2.CONCEITO)})}),vm.paginaResposta.respostas=JSON.stringify(respostas),vm.paginaResposta.avaliacaoTD=angular.copy(vm.questionarioIniciado),vm.paginaResposta.formaExibicao=angular.copy(vm.questionarioIniciado.formaExibicaoQuestionario)};function validarObrigatorios(){if($scope.questionario&&$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes){let count=0;for(element of($scope.btnActive=!0,$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes)){if(element.subjective&&!element.RESPOSTA_SUBJETIVA&&(element.RESPONDIDA="N"),"S"==element.OBRIGATORIA&&"N"===element.RESPONDIDA){let newHash="anchor"+count;return $location.hash()!==newHash?$location.hash(newHash):$anchorScroll(),!1}count++}}return $scope.btnActive=!1,!0}$scope.selecionaAlternativaCheck=function(pIndex,aIndex){$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].respostaAlternativas&&("S"===$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].respostaAlternativas[aIndex].RESPONDIDO?$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].respostaAlternativas[aIndex].RESPONDIDO=null:$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].respostaAlternativas[aIndex].RESPONDIDO="S",-1!==$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].respostaAlternativas.map(a=>a.RESPONDIDO).indexOf("S")?$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].RESPONDIDA="S":$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[pIndex].RESPONDIDA="N")},$scope.selecionaAlternativaOption=function(indiceP,alternativa,indiceA){$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas&&($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas.map(function(alt){"S"===alt.RESPONDIDO&&(alt.RESPONDIDO=null)}),$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas[indiceA].RESPONDIDO="S",$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].RESPONDIDA="S")},$scope.selecionaAlternativaCombo=function(indiceP,alternativa){try{$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas.map(function(alt){"S"===alt.RESPONDIDO&&(alt.RESPONDIDO=null)});let idx=function(arr,obj){for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],obj))return i;return-1}($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas,alternativa);idx>-1&&($scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].respostaAlternativas[idx].RESPONDIDO="S",$scope.questionario[vm.questionarioIniciado.paginaAtual].listaQuestoes[indiceP].RESPONDIDA="S")}catch(error){Notification.error(error)}},$scope.responderDepois=function(){loading(!0),montarPaginaRespostas(),vm.paginaResposta.validarQuestoesObrigatorias=!1,AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){if(response.sucesso){let respDepoisList=angular.fromJson(Storage.get("avaliacaoResponderDepois"));respDepoisList&&-1==respDepoisList.indexOf(vm.questionarioIniciado.aplicacao)?respDepoisList.push(vm.questionarioIniciado.aplicacao):respDepoisList||(respDepoisList=[vm.questionarioIniciado.aplicacao]),Storage.set("avaliacaoResponderDepois",JSON.stringify(respDepoisList)),$state.go("home.avaliacaoinstitucional")}},function(err){Notification.error(err),console.log(err)})},$scope.concluirQuestionario=function(){validarObrigatorios()?vm.questionarioIniciado.msgFinal?$scope.modalAvaliaMsgFinal.show():$scope.continuarConclusao():Notification.warning("Preencha as questões obrigatórias.")},$scope.continuarConclusao=function(){montarPaginaRespostas(),loading(!0),AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){if(response.sucesso){let params={};params.avaliacaoTD=vm.paginaResposta.avaliacaoTD,params.formaExibicao=vm.paginaResposta.formaExibicao,AvaliaService.enviarRespostasQuestionario(params).then(function(response){loading(!1),Notification.success("Questionário Enviado com Sucesso!"),$state.go("home.avaliacaoinstitucional")},function(err){console.log(err)})}else loading(!1)},function(err){Notification.error(err),loading(!1)})}}]),angular.module("custom.controllers").controller("AvaliaQuestionarioSingularController",["$log","$scope","$state","$stateParams","$ionicLoading","SessionData","AvaliaService","$timeout","$location","$anchorScroll","Notification","Storage","$ionicModal",function($log,$scope,$state,$stateParams,$ionicLoading,SessionData,AvaliaService,$timeout,$location,$anchorScroll,Notification,Storage,$ionicModal){var vm=this;function loading(value){value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}if(!$stateParams.questionario)return $state.go("home.avaliacaoinstitucional");$scope.questionario=[],$scope.respostas=[],$scope.perguntaOrdemAtual=1,$scope.perguntaSelecionada=null,vm.questionarioIniciado=$stateParams.questionario.questionarioIniciado,vm.questionarioIniciado.paginaAtual=0,vm.totalDePaginas=vm.questionarioIniciado.totalDePaginas,vm.paginaResposta={},vm.paginaResposta.validarQuestoesObrigatorias=!0,$scope.btnActive=!1,$scope.questionario=$stateParams.questionario,$scope.validQuestao=[!0,null],$scope.perguntaSelecionada=$scope.questionario.listaQuestoes?$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1]:null,$scope.anterior=function(){$scope.perguntaOrdemAtual>1&&($scope.perguntaOrdemAtual--,vm.questionarioIniciado.paginaAtual--,$scope.perguntaSelecionada=$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1])},carrregarCombos(),$ionicModal.fromTemplateUrl("modal-avalia-msg",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalAvaliaMsg=modal,vm.questionarioIniciado.msgInicial&&$timeout(function(){$scope.modalAvaliaMsg.show()},500)}),$ionicModal.fromTemplateUrl("modal-avalia-msg-final",{scope:$scope,animation:"slide-in-up",backdropClickToClose:!1}).then(function(modal){$scope.modalAvaliaMsgFinal=modal}),$scope.fecharModal=function(){$scope.modalAvaliaMsg.hide()},$scope.proxima=function(){$scope.btnActive=!0,validarObrigatorios()?vm.questionarioIniciado.paginaAtual<vm.totalDePaginas&&(loading(!0),montarPaginaRespostas(),AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){vm.questionarioIniciado&&"Questões seguidas dos avaliados"===vm.questionarioIniciado.formaExibicaoQuestionario&&(loading(!1),$scope.perguntaOrdemAtual<$scope.questionario.listaQuestoes.length&&($scope.perguntaOrdemAtual++,$scope.perguntaSelecionada=$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1]),vm.questionarioIniciado.paginaAtual++,carrregarCombos(),"anchorTop"!==$location.hash()?$location.hash("anchorTop"):$anchorScroll())},function(err){loading(!1),Notification.error(err),console.log(err)})):Notification.warning("Preencha as questões obrigatórias.")};var montarPaginaRespostas=function(){let respostas={};angular.forEach($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados,function(value,key){value.subjective&&(respostas[value.ID]=value.RESPOSTA_SUBJETIVA),value.optionbutton&&angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]="on")}),value.combobox?(angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]=value2.CONCEITO)}),value.QUESTAO_SUBJETIVA&&(respostas[value.ID]=value.RESPOSTA_SUBJETIVA)):angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&(respostas[value2.ID]=value2.CONCEITO)})}),vm.paginaResposta.respostas=JSON.stringify(respostas),vm.paginaResposta.avaliacaoTD=angular.copy(vm.questionarioIniciado),vm.paginaResposta.formaExibicao=angular.copy(vm.questionarioIniciado.formaExibicaoQuestionario)};function validarObrigatorios(){if($scope.questionario&&$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1]){let count=0;$scope.btnActive=!0;let listaDeAvaliados=$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados;for(var avaliado=0;avaliado<listaDeAvaliados.length;avaliado++){if(listaDeAvaliados[avaliado].QUESTAO_OBJETIVA)for(element of $scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[avaliado].respostaAlternativas){if("S"==listaDeAvaliados[avaliado].OBRIGATORIA&&"S"!==listaDeAvaliados[avaliado].RESPONDIDA){let newHash="anchor"+count;return $location.hash()!==newHash?$location.hash(newHash):$anchorScroll(),!1}count++}if(listaDeAvaliados[avaliado].QUESTAO_SUBJETIVA){let avaliadoSubjetiva=$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[avaliado];if("S"==avaliadoSubjetiva.OBRIGATORIA&&"N"===avaliadoSubjetiva.RESPONDIDA){let newHash="anchor"+count;return $location.hash()!==newHash?$location.hash(newHash):$anchorScroll(),!1}count++}}return $scope.btnActive=!1,!0}}function carrregarCombos(){angular.forEach($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados,function(value,key){value.combobox&&angular.forEach(value.respostaAlternativas,function(value2,key2){"S"===value2.RESPONDIDO&&($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[key].alternativaSelecionada=$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[key].respostaAlternativas[key2])})})}$scope.responderDepois=function(){loading(!0),montarPaginaRespostas(),vm.paginaResposta.validarQuestoesObrigatorias=!1,AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){if(response.sucesso){let respDepoisList=angular.fromJson(Storage.get("avaliacaoResponderDepois"));respDepoisList&&-1==respDepoisList.indexOf(vm.questionarioIniciado.aplicacao)?respDepoisList.push(vm.questionarioIniciado.aplicacao):respDepoisList||(respDepoisList=[vm.questionarioIniciado.aplicacao]),Storage.set("avaliacaoResponderDepois",JSON.stringify(respDepoisList)),$state.go("home.avaliacaoinstitucional")}},function(err){Notification.error(err),console.log(err)})},$scope.selecionaAlternativaCheck=function(pIndex,aIndex,indexQ){$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas&&($scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas[aIndex].RESPONDIDO="S"===$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas[aIndex].RESPONDIDO?null:"S",-1!==$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas.map(a=>a.RESPONDIDO).indexOf("S")?$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].RESPONDIDA="S":$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].RESPONDIDA="N")},$scope.selecionaAlternativaOption=function(pIndex,aIndex,indexQ){$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas&&($scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas.map(function(alt){"S"===alt.RESPONDIDO&&(alt.RESPONDIDO="N")}),$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].respostaAlternativas[aIndex].RESPONDIDO="S",$scope.questionario.listaQuestoes[pIndex].listaAvaliados[indexQ].RESPONDIDA="S")},$scope.selecionaAlternativaSelect=function(pIndex,aIndex,indexQ){console.log(pIndex+" "+aIndex+" "+indexQ)},$scope.selecionaAlternativaCombo=function(indiceP,alternativa){angular.forEach($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados,function(value,key){try{$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[key].respostaAlternativas.map(function(alt){"S"===alt.RESPONDIDO&&(alt.RESPONDIDO=null)});let idx=function(arr,obj){for(var i=0;i<arr.length;i++)if(angular.equals(arr[i],obj))return i;return-1}($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[key].respostaAlternativas,alternativa);idx>-1&&($scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[indiceP].respostaAlternativas[idx].RESPONDIDO="S",$scope.questionario.listaQuestoes[$scope.perguntaOrdemAtual-1].listaAvaliados[indiceP].RESPONDIDA="S")}catch(error){Notification.error(error)}})},$scope.concluirQuestionario=function(){validarObrigatorios()?vm.questionarioIniciado.msgFinal?$scope.modalAvaliaMsgFinal.show():$scope.continuarConclusao():Notification.warning("Preencha as questões obrigatórias.")},$scope.continuarConclusao=function(){montarPaginaRespostas(),loading(!0),AvaliaService.responderQuestoesPagina(vm.paginaResposta).then(function(response){if(response.sucesso){let params={};params.avaliacaoTD=vm.paginaResposta.avaliacaoTD,params.formaExibicao=vm.paginaResposta.formaExibicao,AvaliaService.enviarRespostasQuestionario(params).then(function(response){loading(!1),Notification.success("Questionário Enviado com Sucesso!"),$state.go("home.avaliacaoinstitucional")},function(err){console.log(err)})}else loading(!1)},function(err){Notification.error(err),loading(!1)})}}]),angular.module("custom.controllers").controller("ProcessoSeletivoController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","ProcessoSeletivoService","AonlineUtils","$location","$anchorScroll",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,ProcessoSeletivoService,AonlineUtils,$location,$anchorScroll){var vm=this;function obterProcessoSeletivo(aluno){ProcessoSeletivoService.obterDadosProcessoSeletivo(aluno).then(sucessDadosProcessoSeletivo,callbackErro)}function sucessDadosProcessoSeletivo(result){vm.dadosProcessoSeletivo=result,ProcessoSeletivoService.obterProvasProcessoSeletivo(vm.dadosProcessoSeletivo).then(sucessoObterListaProvas,callbackErro)}function sucessoObterListaProvas(result){AonlineUtils.showLoading(!1),vm.listaProvasProcessoSeletivo=result}function callbackErro(result){console.log(result)}vm.aluno=null,vm.dadosProcessoSeletivo={},vm.listaProvasProcessoSeletivo=[],vm.currentPage=0,vm.pageSize=5,vm.changePage=function(sentido){AonlineUtils.showLoading(!0),$anchorScroll(),$location.hash("provas"),$timeout(()=>{AonlineUtils.showLoading(!1),vm.currentPage="-"!=sentido?vm.currentPage+1:vm.currentPage-1},500)},vm.numberOfPages=function(){return null!=vm.listaProvasProcessoSeletivo&&0!=vm.listaProvasProcessoSeletivo.length&&null!=vm.listaProvasProcessoSeletivo.length?Math.ceil(vm.listaProvasProcessoSeletivo.length/vm.pageSize):1},vm.numberPageFormart=function(sizeList,pageSize){let number=vm.listaProvasProcessoSeletivo.length/vm.pageSize;if(number%1!=0&&!isNaN(number%1))return parseInt(number);return number-1},vm.obterProcessoSeletivo=obterProcessoSeletivo,vm.iniciar=(AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],void obterProcessoSeletivo(vm.aluno))}]),angular.module("custom.controllers").controller("PublicacoesController",["$log","$http","$scope","$state","$stateParams","$timeout","$translate","Notification","SessionData","DisciplinasMatriculadasService","AonlineUtils","PublicacoesService",function($log,$http,$scope,state,$stateParams,$timeout,$translate,Notification,SessionData,DisciplinasMatriculadasService,AonlineUtils,PublicacoesService){var vm=this;function iniciar(){AonlineUtils.showLoading(!0),vm.aluno=SessionData.aluno.list[SessionData.aluno.selecionado],vm.abaTitle="Publicações Associadas à Disciplina",vm.disciplinaSelecionada={},vm.exibirPublicacoes=!1,vm.view="associadas-a-disciplina",vm.tipo="disciplina",$stateParams.disciplina.turma?selectDisciplina($stateParams.disciplina,vm.aluno,"disciplina"):obterDisciplinas()}function obterDisciplinas(){DisciplinasMatriculadasService.obterDisciplinasMatriculadas().then(sucessoObterDisciplinas,callbackErro)}function selectDisciplina(disciplina,aluno,tipo="disciplina"){vm.exibirPublicacoes=!0,obterPublicacoes(disciplina,aluno,tipo),vm.disciplinaSelecionada=angular.copy(disciplina)}function obterPublicacoes(disciplina,aluno,tipo){AonlineUtils.showLoading(!0);let turmaPromise=PublicacoesService.obterInformacoesTurma(disciplina),publicacaoPromise=PublicacoesService.obterPublicacoes(disciplina,aluno,tipo);Promise.all([turmaPromise,publicacaoPromise]).then(sucessoObterPublicacoes)}function sucessoObterDisciplinas(result){AonlineUtils.showLoading(!1),vm.listaDisciplinas=result}function sucessoObterPublicacoes(result){if(AonlineUtils.showLoading(!1),Array.isArray(result)){if(Array.isArray(result[0]))return vm.listaPublicacoes=result[0],void(vm.infoTurma=result[1]);vm.listaPublicacoes=result[1],vm.infoTurma=result[0]}}function callbackErro(result){console.log(result)}vm.abaTitle=null,vm.aluno=null,vm.disciplinaSelecionada=null,vm.exibirPublicacoes=null,vm.infoTurma={},vm.listaDisciplinas=[],vm.listaPublicacoes=[],vm.view=null,vm.tipo=null,vm.changeTabs=function(slug,title,tipo){vm.abaTitle=title,vm.view=slug,vm.tipo=tipo,obterPublicacoes(vm.disciplinaSelecionada,vm.aluno,tipo)},vm.cliquePublicacoes=function(){$stateParams.disciplina={},iniciar()},vm.downloadPublicacao=function(idPublicacao,tipo,tipoArquivo){AonlineUtils.showLoading(!0),PublicacoesService.downloadPublicacao(idPublicacao,tipo,vm.aluno.codAluno,tipoArquivo)},vm.obterDisciplinas=obterDisciplinas,vm.selectDisciplina=selectDisciplina,vm.iniciar=iniciar()}]),angular.module("custom.controllers").controller("DiarioClasseController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","DisciplinasMatriculadasService","AonlineUtils","$state",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,DisciplinasMatriculadasService,AonlineUtils,$state){var vm=this;AonlineUtils.showLoading(!0),DisciplinasMatriculadasService.obterDisciplinasMatriculadas().then(function(response){vm.listaDisciplinas=response,AonlineUtils.showLoading(!1)},function(err){AonlineUtils.showLoading(!1)}),vm.acessarDetalhes=function(disciplinaSelecionada){$state.go("home.diarioclasse-detalhes",{disciplina:disciplinaSelecionada})}}]),angular.module("custom.controllers").controller("DiarioClasseDetalhesController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","$stateParams","AonlineUtils","$state","DisciplinasMatriculadasService","$anchorScroll","$location",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,$stateParams,AonlineUtils,$state,DisciplinasMatriculadasService,$anchorScroll,$location){var vm=this;if(AonlineUtils.showLoading(!0),$stateParams.disciplina&&0===Object.keys($stateParams.disciplina).length&&$stateParams.disciplina.constructor===Object)return $state.go("home.diarioclasse");vm.disciplinaSelecionada=$stateParams.disciplina,vm.currentPage=0,vm.pageSize=5,vm.changePage=function(sentido){AonlineUtils.showLoading(!0),$anchorScroll(),$location.hash("myAccordion"),$timeout(()=>{AonlineUtils.showLoading(!1),vm.currentPage="-"!=sentido?vm.currentPage+1:vm.currentPage-1},500)},vm.numberOfPages=function(){return null!=vm.aulasMinistradasList?Math.ceil(vm.aulasMinistradasList.length/vm.pageSize):1},vm.numberPageFormart=function(sizeList,pageSize){let number=vm.aulasMinistradasList.length/vm.pageSize;if(number%1!=0&&!isNaN(number%1))return parseInt(number);return number-1},DisciplinasMatriculadasService.listarAgendaDiario(vm.disciplinaSelecionada).then(response=>{AonlineUtils.showLoading(!1),vm.aulasMinistradasList=angular.copy(response)},err=>{AonlineUtils.showLoading(!1)}),vm.obterDetalhes=function(aulaSelecionada){if(angular.forEach(vm.aulasMinistradasList,function(item){item.agenda!==aulaSelecionada.agenda&&$("#"+item.agenda).hasClass("in")&&($("#"+item.agenda).removeClass("in"),$("#btn"+item.agenda).attr("aria-expanded","false"))}),!$("#"+aulaSelecionada.agenda).hasClass("in")){AonlineUtils.showLoading(!0),vm.listaDetalhes=[];let params={disciplina:encodeURI(vm.disciplinaSelecionada.codDisciplina),turma:encodeURI(vm.disciplinaSelecionada.turma),ano:vm.disciplinaSelecionada.ano,semestre:vm.disciplinaSelecionada.semestre,agenda:aulaSelecionada.agenda};DisciplinasMatriculadasService.obterDetalhesAgenda(params).then(response=>{AonlineUtils.showLoading(!1),vm.listaDetalhes=angular.copy(response)},err=>{AonlineUtils.showLoading(!1)})}}}]),angular.module("custom.controllers").controller("PosInformacoesController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","$rootScope",function($log,$http,$scope,$state,$timeout,$translate,Notification,SessionData,$rootScope){switch($rootScope.view="ocorrencias",$state.current.name){case"home.pos_infos.ocorrencias":$state.go("home.pos_infos.ocorrencias"),$rootScope.view="ocorrencias";break;case"home.pos_infos.orientadores":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="orientadores"})},500);break;case"home.pos_infos.proficiencia":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="proficiencia"})},500);break;case"home.pos_infos.qualificacao":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="qualificacao"})},500);break;case"home.pos_infos.defesa":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="defesa"})},500);break;case"home.pos_infos.agencias":setTimeout(()=>{$scope.$apply(()=>{$rootScope.view="agencias"})},500);break;default:$state.go("home.pos_infos.ocorrencias"),$rootScope.view="ocorrencias"}}]),angular.module("custom.controllers").controller("PosInformacoesDefesaController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","PosInformacoesService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,PosInformacoesService){vm=this,AonlineUtils.showLoading(!0),PosInformacoesService.obterDefesas().then(response=>{vm.listaDefesas=angular.copy(response),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)}),vm.obterDadosBancaDefesa=function(param){angular.forEach(vm.listaDefesas,function(item){item.defesa!==param.defesa&&$("#"+item.defesa).hasClass("in")&&($("#"+item.defesa).removeClass("in"),$("#btn"+item.defesa).attr("aria-expanded","false"))}),$("#"+param.defesa).hasClass("in")||(AonlineUtils.showLoading(!0),PosInformacoesService.obterBancaDefesa(param.defesa).then(response=>{AonlineUtils.showLoading(!1),vm.dadosBanca=angular.copy(response),console.log(response)},err=>{AonlineUtils.showLoading(!1)}))}}]),angular.module("custom.controllers").controller("PosInformacoesOcorrenciasController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","PosInformacoesService","AonlineUtils",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,PosInformacoesService,AonlineUtils){var vm=this;AonlineUtils.showLoading(!0);let prom1=PosInformacoesService.obterDadosPosGraduacao().then(response=>{vm.dadosPos=angular.copy(response)}),prom2=PosInformacoesService.listarOcorrencias().then(response=>{vm.listaOcorrencias=angular.copy(response)});Promise.all([prom1,prom2]).then(()=>{AonlineUtils.showLoading(!1)}).catch(()=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("PosInformacoesOrientadoresController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","PosInformacoesService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,PosInformacoesService){vm=this,AonlineUtils.showLoading(!0),PosInformacoesService.obterDadosOrientadores().then(response=>{vm.dadosOrientadores=angular.copy(response),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("PosInformacoesAgenciasController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","PosInformacoesService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,PosInformacoesService){vm=this,AonlineUtils.showLoading(!0),PosInformacoesService.obterDadosAgencias().then(response=>{vm.dadosAgenciasList=angular.copy(response),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("PosInformacoesProficienciaController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","HistoricoService","$ionicLoading","TypeEnum","AonlineUtils","PosInformacoesService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,HistoricoService,$ionicLoading,TypeEnum,AonlineUtils,PosInformacoesService){vm=this,AonlineUtils.showLoading(!0),PosInformacoesService.obterDadosProficiencia().then(response=>{vm.listaProficiencias=angular.copy(response),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("PosInformacoesQualificacaoController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","PosInformacoesService","AonlineUtils",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,PosInformacoesService,AonlineUtils){var vm=this;AonlineUtils.showLoading(!0),PosInformacoesService.obterQualificacoes().then(response=>{vm.dadosQualificacoes=angular.copy(response),AonlineUtils.showLoading(!1)}),vm.obterBancaQualificacao=function(param){angular.forEach(vm.dadosQualificacoes,function(item){item.qualificacao!==param.qualificacao&&$("#"+item.qualificacao).hasClass("in")&&($("#"+item.qualificacao).removeClass("in"),$("#btn"+item.qualificacao).attr("aria-expanded","false"))}),$("#"+param.qualificacao).hasClass("in")||(AonlineUtils.showLoading(!0),PosInformacoesService.obterBancaQualificacao(param.qualificacao).then(response=>{AonlineUtils.showLoading(!1),vm.dadosBanca=angular.copy(response)},err=>{AonlineUtils.showLoading(!1)}))}}]),angular.module("custom.controllers").controller("MatriculaDadosRespFinanController",["$scope","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$q","$log","$ionicPopup","MatriculaService","UtilService","$ionicLoading","AonlineUtils",function($scope,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$q,$log,$ionicPopup,MatriculaService,UtilService,$ionicLoading,AonlineUtils){let alunoSessao=SessionData.aluno.list[SessionData.aluno.selecionado],vm=this;$scope.respCadastro={},$scope.promises=[],$scope.firstLoad=!0;var campoAba=[{aba:"infoPessoais",campos:[{campo:"naturalidade",nomeCampo:"paisNascimento"},{campo:"nacionalidade",nomeCampo:"Nacionalidade"},{campo:"uf_municipio_nasc",nomeCampo:"UFNascimento"},{campo:"municipio_nasc",nomeCampo:"MunicipioNascimento"},{campo:"sexo",nomeCampo:"Sexo"},{campo:"nomeMae",nomeCampo:"Mae"},{campo:"racaCor",nomeCampo:"RacaCor"},{campo:"estadoCivil",nomeCampo:"EstadoCivil"},{campo:"cep",nomeCampo:"CEP"},{campo:"end_pais",nomeCampo:"Pais"},{campo:"endereco",nomeCampo:"Endereco"},{campo:"end_num",nomeCampo:"Numero"},{campo:"uf_municipio_end",nomeCampo:"UF"},{campo:"nome_end_municipio",nomeCampo:"Cidade"},{campo:"bairro",nomeCampo:"Bairro"},{campo:"DDDTelefoneRes",nomeCampo:"DDDTelefone"},{campo:"fone",nomeCampo:"TelefoneResidencial"},{campo:"emailPessoal",nomeCampo:"EMail"},{campo:"DDDTelefoneCel",nomeCampo:"DDDTelefone"},{campo:"celular",nomeCampo:"TelefoneCelular"},{campo:"ddd_fone_comercial",nomeCampo:"DDDTelefone"},{campo:"fone_com",nomeCampo:"Label.Telefone"},{campo:"numRG",nomeCampo:"RG"},{campo:"orgExpRg",nomeCampo:"OrgaoExpedidorDoRg"},{campo:"rg_uf",nomeCampo:"UF"},{campo:"rg_dtexp",nomeCampo:"DataExpedicaoDoRg"}]}];if(!angular.isUndefined($scope.vm)){let matriculaController=$scope.vm.parentScope.vm;matriculaController.configMatricula.config;matriculaController.cancelButton={enabled:!1},matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green",enabled:!0,onClick:function(){let deferr=$q.defer();AonlineUtils.showLoading(!0),vm.objFormatado=angular.copy(vm.dadosResponsavel),vm.objFormatado.dataNascimento=convertDate_US(vm.objFormatado.dataNascimento),vm.objFormatado["rg.dataExpedicao"]=convertDate_US(vm.objFormatado["rg.dataExpedicao"]),vm.objFormatado.sexo=vm.objFormatado.sexo?vm.objFormatado.sexo.charAt(0):null;let aluno={codAluno:alunoSessao.codAluno};if(vm.pessoaRespNaoEhPessoaAlunoSessao&&vm.naoEhRespFinanLogado)Notification.success("Dados salvos com sucesso."),deferr.resolve(),AonlineUtils.showLoading(!1);else{if($scope.cadastroRespForm.$invalid){var auxInvalid=$scope.cadastroRespForm.$error.required,nomeCampo="";if(!0,void 0!==auxInvalid)auxInvalid=auxInvalid[0].$name,campoAba.forEach(function(aba,i){aba.campos.forEach(function(campo,j){if(campo.campo===auxInvalid)return aba.aba,nomeCampo=campo.nomeCampo,void!0})}),auxInvalid&&(angular.element(document.getElementsByName(auxInvalid)).addClass("ng-invalid","ng-invalid-required"),angular.element(document.getElementsByName(auxInvalid)).addClass("ng-touched"),Notification.error('Por favor, preencha o campo "'+$translate.instant(nomeCampo)+'".'));else{var auxInvalidLength=$scope.cadastroRespForm.$error.maxlength;if(void 0!==auxInvalidLength){if(void 0!==(auxInvalidLength=$scope.cadastroRespForm.$error.maxlength[0].$name)&&(campoAba.forEach(function(aba,i){aba.campos.forEach(function(campo,j){if(campo.campo===auxInvalidLength)return aba.aba,nomeCampo=campo.nomeCampo,void!0})}),auxInvalidLength)){var tamanhoMaximo=angular.element(document.getElementsByName(auxInvalidLength))[0].maxLength;Notification.error('O campo "'+$translate.instant(nomeCampo)+'" está acima do tamanho permitido. Tamanho máximo: '+$translate.instant(tamanhoMaximo))}}else{var auxInvalidPhoneNumber=$scope.cadastroRespForm.$error.brPhoneNumber;void 0!==auxInvalidPhoneNumber&&(auxInvalidPhoneNumber=$scope.cadastroRespForm.$error.brPhoneNumber[0].$name,campoAba.forEach(function(aba,i){aba.campos.forEach(function(campo,j){if(campo.campo===auxInvalidPhoneNumber)return aba.aba,nomeCampo=campo.nomeCampo,void!0})}),auxInvalidPhoneNumber&&Notification.error('O campo "'+$translate.instant(nomeCampo)+'" não corresponde a um telefone no formato brasileiro.'))}}return AonlineUtils.showLoading(!1),deferr.promise}MatriculaService.alterarResponsavelFinanceiro(aluno,vm.objFormatado).then(result=>{Notification.success("Dados salvos com sucesso."),deferr.resolve(),AonlineUtils.showLoading(!1)},err=>{AonlineUtils.showLoading(!1)})}return deferr.promise}}}if($scope.vm&&$scope.vm.parentScope){let configMatricula=$scope.vm.parentScope.vm.configMatricula.config;vm.instrucoes=configMatricula.instrucoes;let idioma=$translate.use();"pt_br"!==idioma?(vm.instrucoes=configMatricula[`respfinan_instr_${idioma}`]?configMatricula[`respfinan_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],vm.instrucoes||(vm.instrucoes=configMatricula.respfinan_instr?configMatricula.respfinan_instr:configMatricula.instrucoes)):vm.instrucoes=configMatricula.respfinan_instr?configMatricula.respfinan_instr:configMatricula.instrucoes}function limparListaMunicipios(tipoEndereco){switch(tipoEndereco){case"R":$scope.LISTA_MUNICIPIOS_END_RES=[];break;case"C":$scope.LISTA_MUNICIPIOS_END_COM=[];break;case"N":$scope.LISTA_MUNICIPIOS_NASCIMENTO=[]}}function removeAcento(text){return text?text=(text=(text=(text=(text=(text=(text=text.toLowerCase()).replace(new RegExp("[ÁÀÂÃ]","gi"),"a")).replace(new RegExp("[ÉÈÊ]","gi"),"e")).replace(new RegExp("[ÍÌÎ]","gi"),"i")).replace(new RegExp("[ÓÒÔÕ]","gi"),"o")).replace(new RegExp("[ÚÙÛ]","gi"),"u")).replace(new RegExp("[Ç]","gi"),"c"):""}function preencherCamposEndereco(tipoEndereco){"R"==tipoEndereco?($scope.LISTA_ESTADOS_END_RES=angular.copy($scope.listaEstados.dados),$scope.LISTA_MUNICIPIOS_END_RES=angular.copy($scope.listaMunicipios),$scope.LISTA_BAIRROS_END_RES=angular.copy($scope.listaBairros),vm.dadosResponsavel.bairroResponsavelFinanceiro=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,vm.dadosResponsavel.codMunicipioResponsavelFinanceiro=$scope.endereco.srbCidade,vm.dadosResponsavel.complementoResponsavelFinanceiro=$scope.endereco.txbComplemento,vm.dadosResponsavel.logradouroResponsavelFinanceiro=$scope.endereco.txbLogradouro,vm.dadosResponsavel.numeroEndResponsavelFinanceiro=$scope.endereco.txbNumero):"C"==tipoEndereco&&($scope.LISTA_ESTADOS_END_COM=angular.copy($scope.listaEstados.dados),$scope.LISTA_MUNICIPIOS_END_COM=angular.copy($scope.listaMunicipios),$scope.LISTA_BAIRROS_END_COM=angular.copy($scope.listaBairros),vm.dadosResponsavel["enderecoComercial.bairro"]=$scope.endereco.nomeBairro?$scope.endereco.nomeBairro.toUpperCase():$scope.endereco.nomeBairro,vm.dadosResponsavel["enderecoComercial.codMunicipio"]=$scope.endereco.srbCidade,vm.dadosResponsavel["enderecoComercial.complemento"]=$scope.endereco.txbComplemento,vm.dadosResponsavel["enderecoComercial.logradouro"]=$scope.endereco.txbLogradouro,vm.dadosResponsavel["enderecoComercial.numero"]=$scope.endereco.txbNumero),$scope.loadCidade(tipoEndereco)}function convertDate_US(dParam){return dParam?moment(dParam).format("YYYY-MM-DD hh:mm:ss.sss"):dParam}AonlineUtils.showLoading(!0),MatriculaService.obterResponsaveisFinanceirosMatricula(alunoSessao.codAluno).then(async function(result){if(result.length)vm.listaRespFinan=angular.copy(result),vm.respSelecionado=vm.listaRespFinan[0],await vm.obterDadosResponsavelFinanceiro();else{AonlineUtils.showLoading(!1),$ionicPopup.alert({title:"Aviso",template:"Erro ao buscar informações do responsável financeiro."}).then(function(res){$state.go("home.avisos")})}},function(err){AonlineUtils.showLoading(!1)}),vm.obterDadosResponsavelFinanceiro=async function(){if(AonlineUtils.showLoading(!0),vm.respSelecionado){let params={codAluno:alunoSessao.codAluno,codResponsavelFinanceiro:vm.respSelecionado.codResponsavelFinanceiro};await MatriculaService.obterDadosPessoaisResponsavelFinanceiro(params).then(result=>{vm.dadosResponsavel=angular.copy(result),vm.pessoaRespNaoEhPessoaAlunoSessao=alunoSessao.id!=vm.dadosResponsavel.codPessoa,vm.naoEhRespFinanLogado=alunoSessao.usuarioLogado.id!=vm.dadosResponsavel.codPessoa,vm.dadosResponsavel.dataNascimento=moment(vm.dadosResponsavel.dataNascimento)._d,vm.dadosResponsavel["rg.dataExpedicao"]=moment(vm.dadosResponsavel["rg.dataExpedicao"])._d,vm.dadosResponsavel["rg.dataExpedicao"]=moment(vm.dadosResponsavel["rg.dataExpedicao"]).isValid()?moment(vm.dadosResponsavel["rg.dataExpedicao"])._d:"",$scope.carregarCombos(),$scope.LISTA_ESTADOS_UF_RG=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_UF_RG=result.dados}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),null!=vm.dadosResponsavel["rg.uf"]&&$scope.LISTA_ESTADOS_UF_RG.filter(item=>item.UF==vm.dadosResponsavel["rg.uf"]),null!=vm.dadosResponsavel["rg.numero"]||vm.naoEhRespFinanLogado||vm.pessoaRespNaoEhPessoaAlunoSessao?$scope.disabledRgResp=!0:$scope.disabledRgResp=!1},err=>{AonlineUtils.showLoading(!1)})}},$scope.alunoEndereco={},$scope.habilitaInputBairro=!0,$scope.validarBrasil=function(tipoEndereco){return"R"==tipoEndereco&&vm.dadosResponsavel&&vm.dadosResponsavel["enderecoResidencial.pais"]?(vm.dadosResponsavel["enderecoResidencial.pais"]=vm.dadosResponsavel["enderecoResidencial.pais"].toUpperCase(),"BRASIL"==vm.dadosResponsavel["enderecoResidencial.pais"]):"C"==tipoEndereco&&vm.dadosResponsavel&&vm.dadosResponsavel["enderecoComercial.pais"]?(vm.dadosResponsavel["enderecoComercial.pais"]=vm.dadosResponsavel["enderecoComercial.pais"].toUpperCase(),"BRASIL"==vm.dadosResponsavel["enderecoComercial.pais"]):"N"==tipoEndereco&&vm.dadosResponsavel&&vm.dadosResponsavel.paisNascimento?(vm.dadosResponsavel.paisNascimento=vm.dadosResponsavel.paisNascimento.toUpperCase(),"BRASIL"==vm.dadosResponsavel.paisNascimento):null==vm.dadosResponsavel["enderecoResidencial.pais"]||""==vm.dadosResponsavel["enderecoResidencial.pais"]?vm.dadosResponsavel["enderecoResidencial.pais"]="BRASIL":(null==vm.dadosResponsavel["enderecoComercial.pais"]||""==vm.dadosResponsavel["enderecoComercial.pais"])&&(vm.dadosResponsavel["enderecoComercial.pais"]="BRASIL")},$scope.carregarCombos=function(){UtilService.obterPais().then(function(result){$scope.paises=result.dados,$scope.loadEstados("R"),$scope.loadEstados("C"),$scope.loadEstados("N")}).catch(function(err){})},UtilService.obterNacionalidade().then(function(result){$scope.nacionalidades=result.dados}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterProfissao().then(function(result){$scope.profissoes=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),UtilService.obterEstadoCivil().then(function(result){$scope.estadoCivil=result}).catch(function(err){Notification.error(err),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.loadEstados=function(tipoEndereco){if(AonlineUtils.showLoading(!0),$scope.validarBrasil(tipoEndereco))angular.element("#cepRes").mask("00000-000"),"R"==tipoEndereco?($scope.firstLoad||(vm.dadosResponsavel.cepResponsavelFinanceiro=""),$scope.LISTA_ESTADOS_END_RES=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_END_RES=result.dados,$scope.loadMunicipios(tipoEndereco)}).catch(function(err){$log.debug(err),AonlineUtils.showLoading(!1)})):"C"==tipoEndereco?($scope.firstLoad||(vm.dadosResponsavel["enderecoComercial.cep"]=""),$scope.LISTA_ESTADOS_END_COM=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_END_COM=result.dados,$scope.loadMunicipios(tipoEndereco)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})):"N"==tipoEndereco&&($scope.LISTA_ESTADOS_NASCIMENTO=[],UtilService.obterUF().then(function(result){$scope.LISTA_ESTADOS_NASCIMENTO=result.dados,$scope.loadMunicipios(tipoEndereco)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}));else{let codPais=$scope.getCodigoPais(tipoEndereco);if($scope.firstLoad||"R"!=tipoEndereco?$scope.firstLoad||"C"!=tipoEndereco||(vm.dadosResponsavel["enderecoComercial.cep"]=""):vm.dadosResponsavel.cepResponsavelFinanceiro="",!codPais)return function(tipoEndereco){switch(tipoEndereco){case"R":$scope.LISTA_ESTADOS_END_RES=[];break;case"C":$scope.LISTA_ESTADOS_END_COM=[];break;case"N":$scope.LISTA_ESTADOS_NASCIMENTO=[]}}(tipoEndereco),void AonlineUtils.showLoading(!1);UtilService.obterEstadosEstrangeiros(codPais).then(function(result){for(var dados=[],i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado:result[i].estado};dados.push(uf)}"R"==tipoEndereco?$scope.LISTA_ESTADOS_END_RES=angular.copy(dados):"C"==tipoEndereco?$scope.LISTA_ESTADOS_END_COM=angular.copy(dados):"N"==tipoEndereco&&($scope.LISTA_ESTADOS_NASCIMENTO=angular.copy(dados)),$scope.loadMunicipios(tipoEndereco)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},$scope.loadMunicipios=function(tipoEndereco){AonlineUtils.showLoading(!0);var selUF=null;switch(tipoEndereco){case"R":selUF=$scope.LISTA_ESTADOS_END_RES.filter(item=>item.nome==vm.dadosResponsavel.nomeUfResidencial);break;case"C":selUF=$scope.LISTA_ESTADOS_END_COM.filter(item=>item.nome==vm.dadosResponsavel.nomeUfComercial);break;case"N":selUF=$scope.LISTA_ESTADOS_NASCIMENTO.filter(item=>item.nome==vm.dadosResponsavel.nomeUfNascimento)}if(null==selUF||Array.isArray(selUF)&&!selUF.length)return limparListaMunicipios(tipoEndereco),void AonlineUtils.showLoading(!1);if($scope.validarBrasil(tipoEndereco)){$scope.firstLoad||"R"!=tipoEndereco?$scope.firstLoad||"C"!=tipoEndereco||(vm.dadosResponsavel["enderecoComercial.bairro"]="",vm.dadosResponsavel.nomeCidadeComercial="",vm.dadosResponsavel["enderecoComercial.complemento"]="",vm.dadosResponsavel["enderecoComercial.logradouro"]="",vm.dadosResponsavel["enderecoComercial.numero"]=""):(vm.dadosResponsavel.bairroResponsavelFinanceiro="",vm.dadosResponsavel.nomeCidadeResidencial="",vm.dadosResponsavel.complementoResponsavelFinanceiro="",vm.dadosResponsavel.logradouroResponsavelFinanceiro="",vm.dadosResponsavel.numeroEndResponsavelFinanceiro="");var filtro={codMunicipio:null,nome:null,cep:null,uf:selUF[0].uf};UtilService.obterMunicipios(filtro).then(function(result){var municipios=result;let dados=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome.toUpperCase()};dados.push(municipio)}"R"==tipoEndereco?$scope.LISTA_MUNICIPIOS_END_RES=angular.copy(dados):"C"==tipoEndereco?$scope.LISTA_MUNICIPIOS_END_COM=angular.copy(dados):"N"==tipoEndereco&&($scope.LISTA_MUNICIPIOS_NASCIMENTO=angular.copy(dados)),$scope.loadCidade(tipoEndereco),AonlineUtils.showLoading(!1)}).catch(function(err){$log.debug(err),AonlineUtils.showLoading(!1)})}else{var codPais=$scope.getCodigoPais(tipoEndereco),estado=selUF?selUF[0].uf:null;if(codPais){var municipio={codMunicipioEstrangeiro:null,nome:null,pais:codPais,cep:null,estado:estado,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;limparListaMunicipios(tipoEndereco);let dados=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};dados.push(municipio)}"R"==tipoEndereco?$scope.LISTA_MUNICIPIOS_END_RES=angular.copy(dados):"C"==tipoEndereco?$scope.LISTA_MUNICIPIOS_END_COM=angular.copy(dados):"N"==tipoEndereco&&($scope.LISTA_MUNICIPIOS_NASCIMENTO=angular.copy(dados)),$scope.loadCidade(tipoEndereco),AonlineUtils.showLoading(!1)}).catch(function(err){Notification.error(err),AonlineUtils.showLoading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}else AonlineUtils.showLoading(!1)}},$scope.loadBairros=function(tipoEndereco){if(AonlineUtils.showLoading(!0),$scope.validarBrasil()){var codMunicipio=null!=$scope.alunoEndereco.end_municipio?$scope.alunoEndereco.end_municipio:null;if($scope.alunoEndereco&&$scope.alunoEndereco.bairro&&($scope.alunoEndereco.bairro=$scope.alunoEndereco.bairro.toUpperCase()),$scope.LISTA_BAIRROS_END_RES=[],null==codMunicipio||""===codMunicipio)return void $ionicLoading.hide();UtilService.obterBairros(codMunicipio).then(function(result){$scope.LISTA_BAIRROS_END_RES=result,$scope.loadCodigoBairro()}).catch(function(err){$ionicLoading.hide(),$log.debug(err)})}else $scope.LISTA_BAIRROS_END_RES=[],$ionicLoading.hide()},$scope.loadCidade=function(tipoEndereco){var codCidade=null;if("R"==tipoEndereco){if(codCidade=vm.dadosResponsavel.codMunicipioResponsavelFinanceiro,$scope.firstLoad||(vm.dadosResponsavel.bairroResponsavelFinanceiro="",vm.dadosResponsavel.complementoResponsavelFinanceiro="",vm.dadosResponsavel.logradouroResponsavelFinanceiro="",vm.dadosResponsavel.numeroEndResponsavelFinanceiro=""),codCidade)for(var i=0;i<$scope.LISTA_MUNICIPIOS_END_RES.length;i++)if($scope.LISTA_MUNICIPIOS_END_RES[i].codigo===codCidade)return void(vm.dadosResponsavel.nomeCidadeResidencial=$scope.LISTA_MUNICIPIOS_END_RES[i].nome.toUpperCase())}else if("C"==tipoEndereco){if(codCidade=vm.dadosResponsavel["enderecoComercial.codMunicipio"],$scope.firstLoad||(vm.dadosResponsavel["enderecoComercial.bairro"]="",vm.dadosResponsavel["enderecoComercial.complemento"]="",vm.dadosResponsavel["enderecoComercial.logradouro"]="",vm.dadosResponsavel["enderecoComercial.numero"]=""),codCidade)for(i=0;i<$scope.LISTA_MUNICIPIOS_END_COM.length;i++)if($scope.LISTA_MUNICIPIOS_END_COM[i].codigo===codCidade)return void(vm.dadosResponsavel.nomeCidadeComercial=$scope.LISTA_MUNICIPIOS_END_COM[i].nome.toUpperCase())}else if("N"==tipoEndereco&&(codCidade=vm.dadosResponsavel.codMunicipioNascimento))for(i=0;i<$scope.LISTA_MUNICIPIOS_NASCIMENTO.length;i++)if($scope.LISTA_MUNICIPIOS_NASCIMENTO[i].codigo===codCidade)return void(vm.dadosResponsavel.nomeCidadeNascimento=$scope.LISTA_MUNICIPIOS_NASCIMENTO[i].nome.toUpperCase());$scope.firstLoad=!1},$scope.loadCodigoBairro=function(){var bairro=$scope.alunoEndereco.bairro;if(bairro&&$scope.LISTA_BAIRROS_END_RES.length>0)for(var i=0;i<$scope.LISTA_BAIRROS_END_RES.length;i++)if(removeAcento($scope.LISTA_BAIRROS_END_RES[i].nome)===removeAcento(bairro))return $scope.alunoEndereco.obj_bairro={},$scope.alunoEndereco.obj_bairro.bairro=$scope.LISTA_BAIRROS_END_RES[i].bairro,$scope.alunoEndereco.obj_bairro.nome=$scope.LISTA_BAIRROS_END_RES[i].nome,void($scope.habilitaInputBairro=!1);$scope.alunoEndereco.obj_bairro={},$scope.alunoEndereco.obj_bairro.nome=$scope.alunoEndereco.bairro?$scope.alunoEndereco.bairro.toUpperCase():"",$scope.habilitaInputBairro=!0},$scope.getCodigoPais=function(tipoEndereco){let nomePais=null;switch(tipoEndereco){case"R":nomePais=vm.dadosResponsavel["enderecoResidencial.pais"];break;case"C":nomePais=vm.dadosResponsavel["enderecoComercial.pais"];break;case"N":nomePais=vm.dadosResponsavel.paisNascimento}if(nomePais&&$scope.paises)for(let i=0;i<$scope.paises.length;i++)if($scope.paises[i].nome.toUpperCase()===nomePais.toUpperCase())return $scope.paises[i].pais},$scope.limparCamposEndereco=function(tipoEndereco){"R"==tipoEndereco?(vm.dadosResponsavel.bairroResponsavelFinanceiro="",vm.dadosResponsavel.codMunicipioResponsavelFinanceiro="",vm.dadosResponsavel.nomeUfResidencial="",vm.dadosResponsavel.nomeCidadeResidencial="",vm.dadosResponsavel.complementoResponsavelFinanceiro="",vm.dadosResponsavel.logradouroResponsavelFinanceiro="",vm.dadosResponsavel.numeroEndResponsavelFinanceiro=""):"C"==tipoEndereco&&(vm.dadosResponsavel["enderecoComercial.bairro"]="",vm.dadosResponsavel["enderecoComercial.codMunicipio"]="",vm.dadosResponsavel.nomeUfComercial="",vm.dadosResponsavel.nomeCidadeComercial="",vm.dadosResponsavel["enderecoComercial.complemento"]="",vm.dadosResponsavel["enderecoComercial.logradouro"]="",vm.dadosResponsavel["enderecoComercial.numero"]="")},$scope.obterEndereco=function(cep,tipoEndereco){void 0!==cep&&""!==cep&&8==cep.length?($scope.limparCamposEndereco(tipoEndereco),$ionicLoading.show(),UtilService.obterEndereco(cep).then(function(result){$scope.endereco=result;try{$scope.validarBrasil(tipoEndereco)?UtilService.obterUF().then(function(result){$scope.listaEstados=result;var filtroMunicipio={codMunicipio:null,nome:null,cep:null,uf:$scope.endereco.ufSigla};if($scope.endereco.ufSigla){for(var i=0;i<$scope.listaEstados.dados.length;i++)$scope.listaEstados.dados[i].uf===$scope.endereco.ufSigla&&"R"==tipoEndereco?vm.dadosResponsavel.nomeUfResidencial=$scope.listaEstados.dados[i].nome.toUpperCase():$scope.listaEstados.dados[i].uf===$scope.endereco.ufSigla&&"C"==tipoEndereco&&(vm.dadosResponsavel.nomeUfComercial=$scope.listaEstados.dados[i].nome.toUpperCase());UtilService.obterMunicipios(filtroMunicipio).then(function(result){$ionicLoading.hide();var municipios=result;$scope.listaMunicipios=[];for(var i=0;i<municipios.length;i++){var municipio={codigo:municipios[i].municipio,nome:municipios[i].nome.toUpperCase()};$scope.listaMunicipios.push(municipio)}null!==$scope.endereco.srbCidade&&void 0!==$scope.endereco.srbCidade?("R"==tipoEndereco?vm.dadosResponsavel.codMunicipioResponsavelFinanceiro=$scope.endereco.srbCidade:"C"==tipoEndereco&&(vm.dadosResponsavel["enderecoComercial.codMunicipio"]=$scope.endereco.srbCidade),UtilService.obterBairros($scope.endereco.srbCidade).then(function(result){$ionicLoading.hide(),$scope.listaBairros=result,$scope.firstLoad=!0,preencherCamposEndereco(tipoEndereco)})):(preencherCamposEndereco(),$scope.listaBairros=[])})}else $ionicLoading.hide()}):UtilService.obterEstadosEstrangeiros($scope.alunoEndereco.end_pais).then(function(result){$scope.listaEstados={},$scope.listaEstados.dados=[];for(var i=0;i<result.length;i++){var uf={uf:result[i].estado,nome:result[i].nomeEstado?result[i].nomeEstado.toUpperCase():result[i].estado};$scope.listaEstados.dados.push(uf)}var municipio={codMunicipioEstrangeiro:null,nome:null,pais:$scope.getCodigoPais($scope.alunoEndereco.end_pais),cep:null,estado:$scope.endereco.ufSigla,nomeEstado:null};UtilService.obterMunicipiosEstrangeiros(municipio).then(function(result){var municipiosEstrangeiros=result;$scope.listaMunicipios=[];for(var i=0;i<municipiosEstrangeiros.length;i++){var municipio={codigo:municipiosEstrangeiros[i].codigo,nome:municipiosEstrangeiros[i].nome+" - "+municipiosEstrangeiros[i].estado};$scope.listaMunicipios.push(municipio)}$scope.listaBairros=[],preencherCamposEndereco()})})}catch(erro){$ionicLoading.hide()}}).catch(function(erro){$ionicLoading.hide(),$scope.limparCamposEndereco(tipoEndereco)})):null==cep&&$scope.limparCamposEndereco(tipoEndereco)}}]),angular.module("custom.controllers").controller("PixComponentController",["$log","$http","$scope","$state","$timeout","$translate","Notification","SessionData","CartaoService","AonlineUtils",function($log,$http,$scope,state,$timeout,$translate,Notification,SessionData,CartaoService,AonlineUtils){var ctrl=this;$scope.$on("startPix",function(event,data){ctrl.dadosCobranca=data,function(data){ctrl.pix={},AonlineUtils.showLoading(!0),CartaoService.gerarPix(data).then(result=>{ctrl.pix=result,AonlineUtils.showLoading(!1)}).catch(error=>{console.log(error),AonlineUtils.showLoading(!1)})}(ctrl.dadosCobranca)}),ctrl.copiarPix=function(){Clipboard.isSupported()?(ctrl.clipboard=new Clipboard("#copy-button"),Notification.success($translate.instant("pix.view.msg.copied"))):Notification.warning($translate.instant("navegador.sem.suporte"))},ctrl.getWindowWidth=function(){return $(window).width()}}]),angular.module("custom.controllers").controller("TelaCustomizadaController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","$ionicLoading","TypeEnum","UtilService","AonlineUtils",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,$ionicLoading,TypeEnum,UtilService,AonlineUtils){var vm=this;AonlineUtils.showLoading(!0);const alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado],pagina="Aceite";function enviarRespostaTermo(resposta){AonlineUtils.showLoading(!0);let dados={aluno:alunoSelecionado.codAluno,pagina:pagina,respostaAluno:resposta};UtilService.aceitarTermoTelaCustomizada(dados).then(result=>{AonlineUtils.showLoading(!1),Notification.info(result.mensagem),$state.go("home.avisos")}).catch(error=>{AonlineUtils.showLoading(!1)})}UtilService.obterInfoTelaCustomizada(pagina).then(result=>{vm.dadosPagina=result,AonlineUtils.showLoading(!1)}).catch(error=>{AonlineUtils.showLoading(!1)}),vm.aceitarTermo=function(){enviarRespostaTermo("Aceito")},vm.recusarTermo=function(){enviarRespostaTermo("Recusado")}}]),angular.module("custom.controllers").controller("Matricula2DisciplinasController",["$log","SessionData","MatriculaService","$ionicLoading","$state","$q","$scope","$ionicHistory","$ionicNavBarDelegate","$translate",Matricula2DisciplinasController]),angular.module("custom.controllers").controller("MatriculaAutorizacaoController",["$scope","$state","$timeout","$translate","Notification","$ionicHistory","SessionData","$q","$log","MatriculaService","UtilService","$ionicLoading","AonlineUtils","Storage",function($scope,$state,$timeout,$translate,Notification,$ionicHistory,SessionData,$q,$log,MatriculaService,UtilService,$ionicLoading,AonlineUtils,Storage){let vm=this,alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado],matriculaController=$scope.vm.parentScope.vm,configMatricula=matriculaController.configMatricula.config;function loading(value){vm.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}vm.realizouConfirmacaoDeAutorizacao=Storage.get("realizouConfirmacaoDeAutorizacao"),matriculaController.cancelButton={enabled:!1};const steps=matriculaController.steps;lastStep=steps[steps.length-1],"home.matricula.autorizacao"!=lastStep.state||vm.realizouConfirmacaoDeAutorizacao?matriculaController.nextButton={caption:"Aluno.Matricula.Wizard.Prosseguir",style:"button-green",enabled:!0,onClick:function(){let deferr=$q.defer();return deferr.resolve(),deferr.promise}}:matriculaController.finalButton={caption:"Aluno.Matricula.Wizard.Aceitar",style:"button-green btn-padrao-redondo w-28",enabled:!0,onClick:function(){let deferr=$q.defer();return deferr.resolve(),deferr.promise}},vm.config={configMatricula:matriculaController.configMatricula.config},vm.instrucoes=configMatricula.instrucoes;let idioma=$translate.use();"pt_br"!==idioma?(vm.instrucoes=configMatricula[`autorizacao_instr_${idioma}`]?configMatricula[`autorizacao_instr_${idioma}`]:configMatricula[`instrucoes_${idioma}`],vm.instrucoes||(vm.instrucoes=configMatricula.autorizacao_instr?configMatricula.autorizacao_instr:configMatricula.instrucoes)):vm.instrucoes=configMatricula.autorizacao_instr?configMatricula.autorizacao_instr:configMatricula.instrucoes;let params={chave:vm.config.configMatricula?vm.config.configMatricula.chave:null,aluno:alunoSelecionado.codAluno,ano:vm.config.configMatricula.ano,periodo:vm.config.configMatricula.periodo};loading(!0),MatriculaService.obterAutorizacaoMatricula(params).then(result=>{loading(!1),result&&($scope.listaAutorizacao=result,angular.forEach($scope.listaAutorizacao,item=>{item.aluno=alunoSelecionado.codAluno,item.ano=vm.config.configMatricula.ano,item.semestre=vm.config.configMatricula.periodo,"S"==item.valor?item.selecionado=!0:item.selecionado=!1}),vm.listaItensSelecionados=angular.copy($scope.listaAutorizacao),Storage.set("listaAutMatricula",JSON.stringify(vm.listaItensSelecionados)))},error=>{loading(!1)}),vm.selecionarAutorizacao=function(autorizacao){autorizacao.selecionado?autorizacao.valor="S":autorizacao.valor="N";let i=vm.listaItensSelecionados.findIndex(item=>item.idAutorizacao==autorizacao.idAutorizacao);i>=0&&(vm.listaItensSelecionados.splice(i,1),vm.listaItensSelecionados.push(autorizacao)),Storage.set("listaAutMatricula",JSON.stringify(vm.listaItensSelecionados))}}]),angular.module("custom.controllers").controller("EstouChegandoController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","EstouChegandoService","$log","DownloadArquivo",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,EstouChegandoService,$log,DownloadArquivo){var estouChegandoCtrl=this;estouChegandoCtrl.id="EstouChegandoController";SessionData.aluno.list[SessionData.aluno.selecionado];alteraValorProgresso(0);const codPessoaLogada=SessionData.aluno.list[0].id;function loading(value){estouChegandoCtrl.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}function alteraValorProgresso(valor){let value=`${valor}%`;angular.element("#info-progresso-atual").css("width",value)}function converteBase64EmImg(base64){var hexString=atob(base64),aBuffer=new ArrayBuffer(hexString.length/2),byteBuffer=new Uint8Array(aBuffer);for(let i=0;i<hexString.length;i+=2)byteBuffer[i/2]=parseInt(hexString.slice(i,i+2),16);var blob=new Blob([byteBuffer],{type:"image/png"});return URL.createObjectURL(blob)}loading(!0),$scope.selecaoAlunos=!0,$scope.confirmacaoAlunos=!1,$scope.statusBusca=!1,EstouChegandoService.listarAlunosPorPessoa().then(function(result){for(let i=0;i<result.length;i++)result[i].urlFotoAluno=converteBase64EmImg(result[i].fotoAluno);$scope.listaAlunosPorPessoa=result,estouChegandoCtrl.loading=!1,loading(!1)}).catch(function(err){Notification.error(err),estouChegandoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}),$scope.telaInicial=function(){$scope.selecaoAlunos=!0,$scope.confirmacaoAlunos=!1,$scope.statusBusca=!1},$scope.selecionaAluno=function(aluno_selecionado){let alunos=$scope.listaAlunosPorPessoa;for(let i=0;i<alunos.length;i++)alunos[i].codAluno==aluno_selecionado&&(alunos[i].selecionado=!alunos[i].selecionado);$scope.listaAlunosPorPessoa=alunos},$scope.concluirSelecaoAlunos=function(){loading(!0);var alunosSelecionados=[];for(let i=0;i<$scope.listaAlunosPorPessoa.length;i++)$scope.listaAlunosPorPessoa[i].selecionado&&alunosSelecionados.push($scope.listaAlunosPorPessoa[i]);if(0==alunosSelecionados.length)Notification.error("Selecione ao menos um aluno(a) para continuar"),loading(!1),$ionicHistory.nextViewOptions({disableBack:!0});else if(alunosSelecionados.length>0){const params=alunosSelecionados[0].codAluno;EstouChegandoService.localizacaoInstituicao(params).then(retorno=>{$scope.selecaoAlunos=!1,$scope.confirmacaoAlunos=!0,estouChegandoCtrl.loading=!1,$scope.instituicaoInformada=retorno,console.log("instituição: ",retorno),$scope.listaAlunosSelecionados=alunosSelecionados,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})}).catch(function(error){Notification.error(error),estouChegandoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},$scope.contactarInstituicao=function(status_atual){loading(!0);var listaAlunos=[];for(let i=0;i<$scope.listaAlunosSelecionados.length;i++)listaAlunos.push($scope.listaAlunosSelecionados[i].codAluno);const params={alunos:listaAlunos,codInstituicao:$scope.instituicaoInformada.unidadeFis,pessoaLogada:codPessoaLogada,status:status_atual};EstouChegandoService.contactarInstituicao(params).then(retorno=>{"SAINDO"!==status_atual&&Notification.success("Instituição notificada."),"CHEGANDO"==status_atual&&alteraValorProgresso(80),"CHEGUEI"==status_atual&&alteraValorProgresso(100),$scope.selecaoAlunos=!1,$scope.confirmacaoAlunos=!1,$scope.statusBusca=!0,estouChegandoCtrl.loading=!1,loading(!1)}).catch(function(error){Notification.error(error),estouChegandoCtrl.loading=!1,loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})},$scope.abrirRotaEmMaps=function(){navigator.geolocation&&(console.log("entrou geolocation"),navigator.geolocation.watchPosition(function(position){console.log("position: ",position),$scope.$apply(function(){$scope.position=position.coords,window.open("https://www.google.com.br/maps/dir/"+position.coords.latitude+","+position.coords.longitude+"/"+$scope.instituicaoInformada.latitude+","+$scope.instituicaoInformada.longitude,"_blank")})},function(error){console.log("err: ",error),window.open("https://www.google.com.br/maps/dir/"+$scope.instituicaoInformada.latitude+","+$scope.instituicaoInformada.longitude,"_blank")}))}}]),angular.module("custom.controllers").controller("AORPaginaRedirectController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","SessionData","$log","$ionicLoading","$window","TypeEnum","UtilService","AonlineUtils","AORPaginaRedirectService",function($scope,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,SessionData,$log,$ionicLoading,$window,TypeEnum,UtilService,AonlineUtils,AORPaginaRedirectService){let vm=this;const alunoSelecionado=SessionData.aluno.list[SessionData.aluno.selecionado];vm.id="AORPaginaRedirectController",vm.debugMode=!1,vm.mensagem="Você está sendo redirecionado...",vm.dadosAORPaginaRedirect=[],vm.carregarDadosPaginaDestino=function(redirecionar){AonlineUtils.showLoading(!0),AORPaginaRedirectService.obterDadosAORPaginaRedirecionamento(alunoSelecionado.codAluno,$state.params.redirectPageId).then(function(result){vm.dadosAORPaginaRedirect=result,AonlineUtils.showLoading(!1),redirecionar&&vm.redirecionarPaginaDestino()}).catch(function(err){AonlineUtils.showLoading(!1),Notification.error(err),vm.mensagem="Não foi possível carregar os dados para redirecionamento.",$timeout(function(){$state.go("home.avisos",{},{reload:!0})},1500)})},vm.redirecionarPaginaDestino=function(){if(!vm.dadosAORPaginaRedirect.urlDestino){let msg="URL de destino não configurada";return vm.mensagem=msg,void Notification.error(msg)}let url=vm.dadosAORPaginaRedirect.urlDestino+"?"+vm.dadosAORPaginaRedirect.nomeParametroUrl+"="+vm.dadosAORPaginaRedirect.token;$timeout(function(){window.open(url)},500);let rotaDeRetorno=vm.dadosAORPaginaRedirect.rotaDeRetorno?vm.dadosAORPaginaRedirect.rotaDeRetorno:"avisos";rotaDeRetorno=(rotaDeRetorno=rotaDeRetorno.startsWith(".")?"home"+rotaDeRetorno:rotaDeRetorno).startsWith("home.")?rotaDeRetorno:"home."+rotaDeRetorno,$timeout(function(){$state.go(rotaDeRetorno,{},{reload:!0})},500)},vm.carregarDadosPaginaDestino(!0)}]),angular.module("custom.controllers").controller("MinhasTarefasController",["$scope","$timeout","$ionicModal","SessionData","MinhasTarefasService","AonlineUtils","$state","Upload","$ionicLoading","Notification","DownloadArquivo","Configs",function($scope,$timeout,$ionicModal,SessionData,MinhasTarefasService,AonlineUtils,$state,Upload,$ionicLoading,Notification,DownloadArquivo,Configs){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;function loading(value){vm.loading=value,value?$ionicLoading.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:1}):$ionicLoading.hide()}vm.isExclusaoComentario=!1,vm.codArquivo,AonlineUtils.showLoading(!0),MinhasTarefasService.listarTarefasAluno(codAluno).then(result=>{vm.tarefas=angular.copy(result),console.log("TAREFAS",vm.tarefas),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$scope.LISTA_STATUS=[{nome:"NOVA",id:1},{nome:"EM ANDAMENTO",id:2},{nome:"CONCLUÍDA",id:3},{nome:"CANCELADA",id:4}],vm.isModal=!1,vm.expandAccordion=function(idTarefa,idEquipePart){$scope.idTarefa=idTarefa,$scope.idEquipePart=idEquipePart,vm.isModal?$timeout(()=>{$("#"+idTarefa).removeClass("in"),$("#btn"+idTarefa).attr("aria-expanded","false")},500):(angular.forEach(vm.tarefas,function(item){item.id!==idTarefa&&$("#"+item.id).hasClass("in")&&($("#"+item.id).removeClass("in"),$("#btn"+item.id).attr("aria-expanded","false"))}),$("#"+idTarefa).hasClass("in")||MinhasTarefasService.listarComentariosTarefa(idTarefa).then(result=>{result.forEach(function(comentario){comentario.pessoa==SessionData.aluno.list[SessionData.aluno.selecionado].id&&(comentario.isPermitidoExcluir=!0)}),$scope.comentariosTarefa=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}))},$scope.incluirComentario=function(){var comentarioTarefa={idCasoTarefa:$scope.idTarefa,idEquipePart:$scope.idEquipePart,comentario:$scope.comentario,dataHora:new Date,nomeParticipante:SessionData.aluno.list[SessionData.aluno.selecionado].nomeAluno};AonlineUtils.showLoading(!0),MinhasTarefasService.incluirComentario(comentarioTarefa).then(result=>{$scope.comentariosTarefa.push({id:result.id,idCasoTarefa:result.id_caso_tarefa,idEquipePart:result.id_equipe_part,dataHora:result.data_hora,comentario:result.comentario,nomeParticipante:SessionData.aluno.list[SessionData.aluno.selecionado].nomeAluno,isPermitidoExcluir:!0}),document.getElementById("comentario").value="",AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})},$ionicModal.fromTemplateUrl("views/logged/npj/modal.confirma.exclusao.comentario.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalConfirmaExclusaoComentario){$scope.modalConfirmaExclusaoComentario=modalConfirmaExclusaoComentario}),$scope.openModal=function(idComentario){$scope.idComentario=idComentario,$scope.modalConfirmaExclusaoComentario.show()},$scope.excluirComentario=function(){AonlineUtils.showLoading(!0),MinhasTarefasService.excluirComentarioTarefa($scope.idComentario).then(result=>{AonlineUtils.showLoading(!1),$scope.modalConfirmaExclusaoComentario.hide(),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})},$scope.buscarComentarios=function(){AonlineUtils.showLoading(!0),MinhasTarefasService.listarComentariosTarefa($scope.idTarefa).then(result=>{$scope.comentariosTarefa=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})},$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.documento.tarefa.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirDocumento){$scope.modalIncluirDocumento=modalIncluirDocumento}),$scope.openModalIncluirDocumento=function(idTarefa){$scope.idTarefa=idTarefa,$scope.modalIncluirDocumento.show()},$scope.uploadDocumento=function(file){$scope.nomeAnexo=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},MinhasTarefasService.uploadDocumentoPessoa(data).then(result=>{$scope.codDocumento=result.codArquivo,$scope.nomeArquivo=result.nomeArquivo,vm.codArquivo=result.codArquivo,$("#btEnviarArquivo").prop("disabled",!1),AonlineUtils.showLoading(!1)}).catch(err=>{Notification.error("Erro ao carregar arquivo: "+err),AonlineUtils.showLoading(!1)})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0})},$scope.incluirDocumento=function(tarefa){if(null!=$scope.codDocumento){var tarefaDTO={id:$scope.idTarefa,codArquivo:$scope.codDocumento,temArquivo:!0,nomeArquivo:$scope.nomeArquivo,id_usuario:SessionData.aluno.list[SessionData.aluno.selecionado].id,status:tarefa.status,ch_estimada:tarefa.chEstimada};loading(!0),MinhasTarefasService.incluirDocumentoPessoa(tarefaDTO).then(result=>{Notification.success("Upload de arquivo realizado com sucesso.")}).catch(err=>{loading(!1),Notification.error("Erro ao carregar arquivo: "+err),$scope.anexoInvalido=!0}),loading(!1),$scope.tarefa={},$scope.modalIncluirDocumento.hide()}else Notification.error("Para concluir a ação, é necessário carregar o documento.")},$scope.downloadDocumento=function(idTarefa){let params={};params.url=Configs.getApiServer()+"/npj/obter-documento-tarefa?id-caso-tarefa="+idTarefa,params.method="GET",DownloadArquivo.downloadArquivo(params)},$scope.downloadModeloDocumento=function(idTarefa){let params={};params.url=Configs.getApiServer()+"/npj/obter-modelo-doc-tarefa?id-caso-tarefa="+idTarefa,params.method="GET",DownloadArquivo.downloadArquivo(params)},$scope.downloadComprovanteTarefa=function(idTarefa,idEquipePart){let params={};params.url=Configs.getApiServer()+"/npj/obter-comprovante-tarefa?id-caso-tarefa="+idTarefa+"&id-equipe-part="+idEquipePart,params.method="GET",DownloadArquivo.downloadArquivo(params)}}]),angular.module("custom.controllers").controller("MeusCasosController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","MeusCasosService","$log","AonlineUtils",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,MeusCasosService,$log,AonlineUtils){switch($rootScope.view="casos",$state.current.name){case"home.npj-meus-casos.casos":default:$state.go("home.npj-meus-casos.casos"),$rootScope.view="casos"}}]),angular.module("custom.controllers").controller("CasosController",["$scope","$ionicModal","SessionData","CasosService","AonlineUtils","Notification",function($scope,$ionicModal,SessionData,CasosService,AonlineUtils,Notification){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.editar.caso.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalEditarCaso){$scope.modalEditarCaso=modalEditarCaso}),$scope.openModalEditarCaso=function(caso){$scope.caso=caso,$scope.caso.dataProcesso=null!=$scope.caso.dataProcesso?new Date($scope.caso.dataProcesso):"",$scope.caso.dataEntrada=null!=$scope.caso.dataEntrada?new Date($scope.caso.dataEntrada):"",$scope.caso.dataResultado=null!=$scope.caso.dataResultado?new Date($scope.caso.dataResultado):"",$scope.caso.dataPrevista=null!=$scope.caso.dataPrevista?new Date($scope.caso.dataPrevista):"",$scope.caso.dataReprovacao=null!=$scope.caso.dataReprovacao?new Date($scope.caso.dataReprovacao):"",$scope.caso.dataAprovacao=null!=$scope.caso.dataAprovacao?new Date($scope.caso.dataAprovacao):"",$scope.modalEditarCaso.show()},$scope.editarCaso=function(){CasosService.editarCaso($scope.caso).then(result=>{AonlineUtils.showLoading(!1),Notification.success("Edição do caso realizado com sucesso.")}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao editar caso: "+err)}),$scope.modalEditarCaso.hide()}}]),angular.module("custom.controllers").controller("RequeridoController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","RequeridoService","CasosService","$log","AonlineUtils",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,RequeridoService,CasosService,$log,AonlineUtils){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.exibirCasos=null,vm.selectCaso=function(idRequerido){vm.exibirCasos=!0,function(idRequerido){AonlineUtils.showLoading(!0),RequeridoService.buscarRequerido(idRequerido).then(result=>{vm.requerido=angular.copy(result),function(cpf){cpf=(cpf=(cpf=(cpf=cpf.replace(/\D/g,"")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d)/,"$1.$2")).replace(/(\d{3})(\d{1,2})$/,"$1-$2"),vm.requerido.cpf=cpf}(vm.requerido.cpf),function(cnpj){vm.requerido.cnpj=cnpj.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d)/,"$1-$2").replace(/(-\d{2})\d+?$/,"$1")}(vm.requerido.cnpj),function(numCelular){vm.requerido.celular=numCelular.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").replace(/(-\d{4})\d+?$/,"$1")}(vm.requerido.celular),function(cep){vm.requerido.cep=cep.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2").replace(/(-\d{3})\d+?$/,"$1")}(vm.requerido.cep),function(numTelefone){numTelefone=(numTelefone=(numTelefone=numTelefone.replace(/\D/g,"")).replace(/^(\d{2})(\d)/g,"($1) $2")).replace(/(\d)(\d{4})$/,"$1-$2"),vm.requerido.telefone=numTelefone}(vm.requerido.telefone),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idRequerido)},vm.cliqueCasos=function(){vm.exibirCasos=!1},AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}]),angular.module("custom.controllers").controller("RequerentesController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","RequerentesService","CasosService","$log","AonlineUtils","DownloadArquivo","Configs",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,RequerentesService,CasosService,$log,AonlineUtils,DownloadArquivo,Configs){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;function mascaraCEP(){vm.requerentes.forEach(function(requerente){requerente.cep=requerente.cep.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2").replace(/(-\d{3})\d+?$/,"$1")})}function mascaraCEP(){vm.requerentes.forEach(function(requerente){requerente.cep=requerente.cep.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2").replace(/(-\d{3})\d+?$/,"$1")})}vm.exibirCasos=null,vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),RequerentesService.buscarRequerentes(idCaso).then(result=>{vm.requerentes=angular.copy(result),vm.requerentes.forEach(function(requerente){requerente.cpf=requerente.cpf.replace(/\D/g,""),requerente.cpf=requerente.cpf.replace(/(\d{3})(\d)/,"$1.$2"),requerente.cpf=requerente.cpf.replace(/(\d{3})(\d)/,"$1.$2"),requerente.cpf=requerente.cpf.replace(/(\d{3})(\d{1,2})$/,"$1-$2")}),mascaraCEP(),vm.requerentes.forEach(function(requerente){requerente.celular=requerente.celular.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").replace(/(-\d{4})\d+?$/,"$1")}),mascaraCEP(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),vm.isModal=!1,vm.expandAccordion=function(idCasoRequerente){vm.isModal?$timeout(()=>{$("#"+idCasoRequerente).removeClass("in"),$("#btn"+idCasoRequerente).attr("aria-expanded","false")},500):(angular.forEach(vm.tarefas,function(item){item.id!==idCasoRequerente&&$("#"+item.id).hasClass("in")&&($("#"+item.id).removeClass("in"),$("#btn"+item.id).attr("aria-expanded","false"))}),$("#"+idCasoRequerente).hasClass("in")||RequerentesService.buscarDocumentosRequerentes(idCasoRequerente).then(result=>{vm.documentos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}))},$scope.downloadDocumentoRequerente=function(requerente){let params={};params.url=Configs.getApiServer()+"/npj/obter-documento-requerente?id-caso-requerente-doc="+requerente.id,params.method="GET",DownloadArquivo.downloadArquivo(params)}}]),angular.module("custom.controllers").controller("AtendimentosController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","AtendimentosService","CasosService","$log","AonlineUtils",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,AtendimentosService,CasosService,$log,AonlineUtils){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),AtendimentosService.buscarAtendimentos(idCaso).then(result=>{vm.atendimentos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.atendimento.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirAtendimento){$scope.modalIncluirAtendimento=modalIncluirAtendimento}),$scope.openModalIncluirAtendimento=function(casos){$scope.idCaso=casos[0].id,$scope.idEquipe=casos[0].idEquipe,console.log("$scope.idEquipe",$scope.idEquipe),$scope.modalIncluirAtendimento.show()},$scope.salvarAtendimento=function(atendimento){var atendimentoDTO={id_caso:$scope.idCaso,id_equipe:$scope.idEquipe,data:atendimento.data,horario:atendimento.data,motivo:atendimento.motivo,comentarios:atendimento.comentarios,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name};AtendimentosService.incluirAtendimento(atendimentoDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirAtendimento.hide(),Notification.success("Atendimento adicionado realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar atendimento: "+err)})}}]),angular.module("custom.controllers").controller("TarefasController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","TarefasService","CasosService","$log","AonlineUtils","Notification","Upload",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,TarefasService,CasosService,$log,AonlineUtils,Notification,Upload){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),TarefasService.buscarTarefas(idCaso).then(result=>{vm.tarefas=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,vm.codArquivo,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$scope.LISTA_STATUS=[{nome:"NOVA",id:1},{nome:"EM ANDAMENTO",id:2},{nome:"CONCLUÍDA",id:3},{nome:"CANCELADA",id:4}],$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.tarefa.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirTarefa){$scope.modalIncluirTarefa=modalIncluirTarefa}),$scope.openModalIncluirTarefa=function(tarefas){$scope.idCaso=tarefas[0].id_caso,$scope.idEquipePart=tarefas[0].id_equipe_part,$scope.obterModelosDoc(),$scope.modalIncluirTarefa.show()},$scope.obterModelosDoc=function(){$scope.tarefaNova=null,$scope.MODELOS_DOC=[],TarefasService.obterModelosDoc().then(result=>{result.forEach(function(modelo){$scope.MODELOS_DOC.push({nome:modelo.descricao,id:modelo.id})})})},$scope.uploadDocumento=function(file){$scope.nomeAnexo=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},TarefasService.uploadDocumentoPessoa(data).then(result=>{vm.codArquivo=result.codArquivo,$("#btEnviarArquivo").prop("disabled",!1),AonlineUtils.showLoading(!1)}).catch(err=>{Notification.error("Erro ao carregar arquivo: "+err),AonlineUtils.showLoading(!1)})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0})},$scope.salvarTarefa=function(tarefaNova){var idModeloDoc=null;$scope.MODELOS_DOC.forEach(function(modelo){modelo.nome.toLowerCase()===tarefaNova.modeloDoc.toLowerCase()&&(idModeloDoc=modelo.id)});var tarefaDTO={tarefa:tarefaNova.codigo,data_inicio:tarefaNova.dataInicio,data_final:tarefaNova.dataFinal,descricao:tarefaNova.descricao,status:tarefaNova.status,codArquivo:vm.codArquivo,id_caso:$scope.idCaso,id_modelo_doc:idModeloDoc,id_equipe_part:$scope.idEquipePart,ch_estimada:tarefaNova.chEstimada,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name};TarefasService.incluirTarefa(tarefaDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirTarefa.hide(),Notification.success("Tarefa adicionada realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar tarefa: "+err)})}}]),angular.module("custom.controllers").controller("AnexosController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","AnexosService","CasosService","$log","AonlineUtils","Upload","$ionicLoading","DownloadArquivo",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,AnexosService,CasosService,$log,AonlineUtils,Upload,$ionicLoading,DownloadArquivo){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),AnexosService.buscarAnexos(idCaso).then(result=>{vm.anexos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.anexo.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirAnexo){$scope.modalIncluirAnexo=modalIncluirAnexo}),$scope.openModalIncluirAnexo=function(anexos){$scope.idCaso=anexos[0].id_caso,$scope.modalIncluirAnexo.show()},$scope.uploadDocumento=function(file){$scope.codDocumento=void 0,$scope.nomeAnexo=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},AnexosService.uploadDocumento(data).then(function(result){$scope.codDocumento=result.codArquivo,$("#btEnviarArquivo").prop("disabled",!1)}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0}),loading(!1)},$scope.salvarAnexo=function(anexo){var anexoDTO={id_caso:$scope.idCaso,codArquivo:$scope.codDocumento,descricao:anexo.descricao,data_entrega:anexo.data_entrega,entregue_por:anexo.entregue_por,recebido_por:anexo.recebido_por,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name};AnexosService.incluirAnexo(anexoDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirAnexo.hide(),Notification.success("Anexo adicionado realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar anexo: "+err)})},$scope.baixarDocumentoAnexo=function(idAnexo){let params={};params.url=Configs.getApiServer()+"/npj/obter-anexo-processo?id-caso-anexo="+idAnexo,params.method="GET",DownloadArquivo.downloadArquivo(params)}}]),angular.module("custom.controllers").controller("AndamentosController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","AndamentosService","CasosService","$log","AonlineUtils",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,AndamentosService,CasosService,$log,AonlineUtils){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),AndamentosService.buscarAndamentos(idCaso).then(result=>{vm.andamentos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.andamento.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirAndamento){$scope.modalIncluirAndamento=modalIncluirAndamento}),$scope.openModalIncluirAndamento=function(andamentos){$scope.idCaso=andamentos[0].id_caso,$scope.modalIncluirAndamento.show()},$scope.salvarAndamento=function(andamento){var andamentoDTO={id_caso:$scope.idCaso,tipo:andamento.tipo,data:andamento.data,descricao:andamento.descricao,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name};AndamentosService.incluirAndamento(andamentoDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirAndamento.hide(),Notification.success("Andamento adicionado realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar andamento: "+err)})}}]),angular.module("custom.controllers").controller("PeticoesController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","PeticoesService","CasosService","$log","AonlineUtils","Upload",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,PeticoesService,CasosService,$log,AonlineUtils,Upload){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),PeticoesService.buscarPeticoes(idCaso).then(result=>{vm.peticoes=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.peticao.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirPeticao){$scope.modalIncluirPeticao=modalIncluirPeticao}),$scope.openModalIncluirPeticao=function(peticoes){$scope.idCaso=peticoes[0].id_caso,$scope.modalIncluirPeticao.show()},$scope.uploadDocumento=function(file){$scope.codDocumento=void 0,$scope.nomeAnexo=file.name,Upload.base64DataUrl(file).then(function(urls){if(null!==urls){var base64Data=urls.split("base64,")[1];data={codArquivoAnterior:$scope.codDocumento,contentType:file.type,fileData:base64Data,filename:file.name},PeticoesService.uploadDocumento(data).then(function(result){$scope.codDocumento=result.codArquivo,$("#btEnviarArquivo").prop("disabled",!1)}).catch(function(err){loading(!1),$ionicHistory.nextViewOptions({disableBack:!0})})}},function(resp){Notification.error("Erro ao carregar arquivo: "+resp.status),$scope.anexoInvalido=!0}),loading(!1)},$scope.salvarPeticao=function(peticao){var peticaoDTO={id_caso:$scope.idCaso,tipo_acao:peticao.tipo_acao,numero:peticao.numero,data:peticao.data,destino:peticao.destino,descricao:peticao.descricao,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name,codArquivo:$scope.codDocumento};PeticoesService.incluirPeticao(peticaoDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirPeticao.hide(),Notification.success("Petição adicionado realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar petição: "+err)})}}]),angular.module("custom.controllers").controller("AgendaController",["$scope","$sce","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","SessionData","Configs","AgendaService","CasosService","$log","AonlineUtils",function($scope,$sce,$http,$rootScope,$state,$timeout,$translate,Notification,$ionicHistory,$ionicModal,$ionicLoading,SessionData,Configs,AgendaService,CasosService,$log,AonlineUtils){var vm=this;const codAluno=SessionData.aluno.list[SessionData.aluno.selecionado].codAluno;vm.selectCaso=function(idCaso){vm.exibirCasos=!0,function(idCaso){AonlineUtils.showLoading(!0),AgendaService.buscarAgendas(idCaso).then(result=>{vm.agendas=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}(idCaso)},vm.cliqueCasos=function(){vm.exibirCasos=!1},vm.exibirCasos=null,AonlineUtils.showLoading(!0),CasosService.listarCasos(codAluno).then(result=>{vm.casos=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$ionicModal.fromTemplateUrl("views/logged/npj/modal.incluir.agenda.html",{scope:$scope,animation:"slide-in-up"}).then(function(modalIncluirAgenda){$scope.modalIncluirAgenda=modalIncluirAgenda}),$scope.openModalIncluirAgenda=function(agendas){$scope.idCaso=agendas[0].id_caso,$scope.modalIncluirAgenda.show()},$scope.salvarAgenda=function(agenda){var agendaDTO={id_caso:$scope.idCaso,compromisso:agenda.compromisso,anotacoes:agenda.anotacoes,data_inicial:agenda.data_inicial,hora_inicial:agenda.hora_inicial,data_final:agenda.data_final,hora_final:agenda.hora_final,local:agenda.local,link:agenda.link,usuario:SessionData.aluno.list[SessionData.aluno.selecionado].user.name};AgendaService.incluirAgenda(agendaDTO).then(result=>{AonlineUtils.showLoading(!1),$scope.modalIncluirAgenda.hide(),Notification.success("Agenda adicionado realizado com sucesso."),$state.reload(),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1),Notification.error("Erro ao adicionar agenda: "+err)})}}]);var app=angular.module("myApp",["ui.calendar"]);app.controller("MeuCalendarioController",["$scope","uiCalendarConfig","$translate","$compile","CalendarioNpjService","AonlineUtils","SessionData","DownloadArquivo","Configs",function($scope,uiCalendarConfig,$translate,$compile,CalendarioNpjService,AonlineUtils,SessionData,DownloadArquivo,Configs){this.id="MeuCalendarioController",$scope.tempestividade={};const codPessoaAluno=SessionData.user.id;function _listarEventos(unidadeFisica,equipe,papel,participante,tipo,numCaso){AonlineUtils.showLoading(!0),CalendarioNpjService.listarEventosAluno(codPessoaAluno,unidadeFisica,equipe,papel,participante,tipo,numCaso).then(result=>{result.forEach(function(evento){"Tarefa"==evento.tipo?$scope.eventoTarefa.events.push({type:evento.tipo,title:evento.titulo,start:evento.dataCalendario,end:evento.dataCalendario,allDay:!1}):"Agenda"==evento.tipo?$scope.eventoAgenda.events.push({type:evento.tipo,title:evento.titulo,start:evento.dataCalendario,end:evento.dataCalendario,allDay:!1}):"Feriado"==evento.tipo&&$scope.eventoFeriado.events.push({type:evento.tipo,title:evento.titulo,start:evento.dataCalendario,end:evento.dataCalendario,allDay:!1})}),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})}$scope.LISTA_EQUIPES=[],$scope.LISTA_PARTICIPANTES_EQUIPE=[],$scope.LISTA_PAPEIS=[{nome:"Aluno",id:1},{nome:"Docente",id:2},{nome:"Advogado",id:3}],$scope.LISTA_TIPOS=[{nome:"Todos",id:1},{nome:"Tarefa",id:2},{nome:"Agenda",id:3},{nome:"Feriado",id:4}],$scope.eventoTarefa={color:"#005eff",textColor:"white",events:[]},$scope.eventoAgenda={color:"#FFA500",textColor:"white",events:[]},$scope.eventoFeriado={color:"#008000",textColor:"white",events:[]},AonlineUtils.showLoading(!0),CalendarioNpjService.listarEquipes().then(result=>{$scope.LISTA_EQUIPES=result,AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),AonlineUtils.showLoading(!0),CalendarioNpjService.listarParticipantesEquipe().then(result=>{$scope.LISTA_PARTICIPANTES_EQUIPE=result,AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)}),$scope.tarefaNova=null,$scope.MODELOS_DOC=[],CalendarioNpjService.obterModelosDoc().then(result=>{result.forEach(function(modelo){$scope.MODELOS_DOC.push({nome:modelo.descricao,id:modelo.id})})}),$scope.eventsF=function(){_listarEventos()},$scope.eventosDia=function(clickedMoment){$scope.eventosDia=[],exibeEventosDia=!0;var dataInicio=moment(clickedMoment).add(1,"day");$scope.tempestividade.data=dataInicio._d,AonlineUtils.showLoading(!0),CalendarioNpjService.listarEventosDia(codPessoaAluno,dataInicio._d).then(result=>{$scope.eventosDia=angular.copy(result),AonlineUtils.showLoading(!1)}).catch(err=>{AonlineUtils.showLoading(!1)})},$scope.filtrarCalendario=function(eventosForm){$scope.eventoTarefa.events.length=0,$scope.eventoAgenda.events.length=0,$scope.eventoFeriado.events.length=0,$scope.eventosDia.length=0,_listarEventos(eventosForm.unidadeFisica.$modelValue,eventosForm.equipe.$modelValue,eventosForm.papel.$modelValue,eventosForm.participante.$modelValue,eventosForm.tipo.$modelValue,eventosForm.numCaso.$modelValue)},$scope.uiConfig={calendar:{height:700,editable:!0,displayEventTime:!0,theme:!0,header:{left:"",center:"title",right:"prev,today,next"},lang:$translate.instant("Home.view.language"),dayClick:$scope.eventosDia}},$scope.eventSources=[$scope.eventoTarefa,$scope.eventoAgenda,$scope.eventoFeriado,$scope.eventsF],$scope.downloadModeloTempestividade=function(tempestividade){var idModeloDoc=null;$scope.MODELOS_DOC.forEach(function(modelo){modelo.nome.toLowerCase()===tempestividade.modelo.toLowerCase()&&(idModeloDoc=modelo.id)});let params={};params.url=Configs.getApiServer()+"/npj/obter-comprovante-tempestividade?id-modelo="+idModeloDoc+"&data="+tempestividade.data+"&descricao="+tempestividade.descricao,params.method="GET",DownloadArquivo.downloadArquivo(params)}}]);